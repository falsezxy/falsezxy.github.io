<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Mysql相关知识 | Felix的个人博客</title><meta name="author" content="Felix"><meta name="copyright" content="Felix"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MySQL相关知识一、数据库基础概念什么是数据库数据库是按照数据结构来组织、存储和管理数据的仓库。MySQL 是一个关系型数据库管理系统（RDBMS），采用表格形式存储数据，表与表之间通过键值关系相连。  MySQL的缺陷，并发能力弱  MySQL 的核心层次123456789MySQL实例  ↓数据库（Database）- 多个数据库可以存在于同一MySQL实例  ↓数据表（Table）- 每个">
<meta property="og:type" content="article">
<meta property="og:title" content="Mysql相关知识">
<meta property="og:url" content="http://example.com/2025/11/20/Mysql%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/index.html">
<meta property="og:site_name" content="Felix的个人博客">
<meta property="og:description" content="MySQL相关知识一、数据库基础概念什么是数据库数据库是按照数据结构来组织、存储和管理数据的仓库。MySQL 是一个关系型数据库管理系统（RDBMS），采用表格形式存储数据，表与表之间通过键值关系相连。  MySQL的缺陷，并发能力弱  MySQL 的核心层次123456789MySQL实例  ↓数据库（Database）- 多个数据库可以存在于同一MySQL实例  ↓数据表（Table）- 每个">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/imgs/adater.jpg">
<meta property="article:published_time" content="2025-11-20T03:16:15.000Z">
<meta property="article:modified_time" content="2025-11-20T10:59:18.505Z">
<meta property="article:author" content="Felix">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/imgs/adater.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Mysql相关知识",
  "url": "http://example.com/2025/11/20/Mysql%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/",
  "image": "http://example.com/imgs/adater.jpg",
  "datePublished": "2025-11-20T03:16:15.000Z",
  "dateModified": "2025-11-20T10:59:18.505Z",
  "author": [
    {
      "@type": "Person",
      "name": "Felix",
      "url": "http://example.com"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2025/11/20/Mysql%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Mysql相关知识',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 8.0.0"></head><body><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/imgs/background_header.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Felix的个人博客</span></a><a class="nav-page-title" href="/"><span class="site-name">Mysql相关知识</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">Mysql相关知识</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-11-20T03:16:15.000Z" title="Created 2025-11-20 11:16:15">2025-11-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-11-20T10:59:18.505Z" title="Updated 2025-11-20 18:59:18">2025-11-20</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="MySQL相关知识"><a href="#MySQL相关知识" class="headerlink" title="MySQL相关知识"></a>MySQL相关知识</h1><h2 id="一、数据库基础概念"><a href="#一、数据库基础概念" class="headerlink" title="一、数据库基础概念"></a>一、数据库基础概念</h2><h3 id="什么是数据库"><a href="#什么是数据库" class="headerlink" title="什么是数据库"></a>什么是数据库</h3><p>数据库是按照数据结构来组织、存储和管理数据的仓库。MySQL 是一个关系型数据库管理系统（RDBMS），采用表格形式存储数据，表与表之间通过键值关系相连。</p>
<blockquote>
<p>MySQL的缺陷，并发能力弱</p>
</blockquote>
<h3 id="MySQL-的核心层次"><a href="#MySQL-的核心层次" class="headerlink" title="MySQL 的核心层次"></a>MySQL 的核心层次</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MySQL实例</span><br><span class="line">  ↓</span><br><span class="line">数据库（Database）- 多个数据库可以存在于同一MySQL实例</span><br><span class="line">  ↓</span><br><span class="line">数据表（Table）- 每个数据库包含多个表</span><br><span class="line">  ↓</span><br><span class="line">行（Row）- 每个表包含多行数据</span><br><span class="line">  ↓</span><br><span class="line">列（Column）- 每行包含多列属性</span><br></pre></td></tr></table></figure>

<h3 id="为什么需要数据库"><a href="#为什么需要数据库" class="headerlink" title="为什么需要数据库"></a>为什么需要数据库</h3><ul>
<li><strong>数据持久化</strong>：数据存储在磁盘上，即使程序关闭也不会丢失</li>
<li><strong>高效查询</strong>：通过索引快速检索数据</li>
<li><strong>数据完整性</strong>：通过约束确保数据的准确性和一致性</li>
<li><strong>并发控制</strong>：支持多个用户同时访问</li>
<li><strong>事务支持</strong>：确保数据操作的原子性和一致性</li>
</ul>
<hr>
<h2 id="二、数据库操作详解"><a href="#二、数据库操作详解" class="headerlink" title="二、数据库操作详解"></a>二、数据库操作详解</h2><h3 id="2-1-数据库的生命周期"><a href="#2-1-数据库的生命周期" class="headerlink" title="2.1 数据库的生命周期"></a>2.1 数据库的生命周期</h3><h4 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE db_name;</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE db_name <span class="keyword">DEFAULT</span> <span class="keyword">CHARACTER SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci;</span><br></pre></td></tr></table></figure>

<p><strong>概念说明：</strong></p>
<ul>
<li><strong>CHARACTER SET（字符集）</strong>：定义数据库存储的字符类型。utf8mb4 支持emoji等4字节字符</li>
<li><strong>COLLATE（排序规则）</strong>：定义数据排序和比较的规则。utf8mb4_unicode_ci 表示不区分大小写</li>
</ul>
<p><strong>为什么重要：</strong> 选错字符集会导致乱码或存储失败，建议新项目统一使用 utf8mb4</p>
<h4 id="查看数据库信息"><a href="#查看数据库信息" class="headerlink" title="查看数据库信息"></a>查看数据库信息</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看所有数据库</span></span><br><span class="line"><span class="keyword">SHOW</span> DATABASES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看当前使用的数据库</span></span><br><span class="line"><span class="keyword">SELECT</span> DATABASE();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看数据库创建语句（包括字符集等信息）</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> DATABASE db_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看数据库大小</span></span><br><span class="line"><span class="keyword">SELECT</span> table_schema, </span><br><span class="line">       ROUND(<span class="built_in">SUM</span>(data_length <span class="operator">+</span> index_length)<span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span>, <span class="number">2</span>) <span class="keyword">as</span> size_mb </span><br><span class="line"><span class="keyword">FROM</span> information_schema.tables </span><br><span class="line"><span class="keyword">WHERE</span> table_schema <span class="operator">=</span> <span class="string">&#x27;db_name&#x27;</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> table_schema;</span><br></pre></td></tr></table></figure>

<p><strong>作用：</strong> 了解数据库的配置和占用空间，方便监控和维护</p>
<h4 id="使用数据库"><a href="#使用数据库" class="headerlink" title="使用数据库"></a>使用数据库</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USE db_name;</span><br></pre></td></tr></table></figure>

<p><strong>概念说明：</strong> 切换到指定数据库后，后续 SQL 语句都在该库中执行</p>
<h4 id="修改数据库"><a href="#修改数据库" class="headerlink" title="修改数据库"></a>修改数据库</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> DATABASE db_name <span class="keyword">DEFAULT</span> <span class="keyword">CHARACTER SET</span> utf8mb4;</span><br><span class="line"><span class="keyword">ALTER</span> DATABASE db_name <span class="keyword">COLLATE</span> utf8mb4_general_ci;</span><br></pre></td></tr></table></figure>

<p><strong>为什么需要修改：</strong> </p>
<ul>
<li>初期选错字符集需要调整</li>
<li>系统升级时可能需要更改排序规则</li>
</ul>
<p><strong>注意：</strong> 修改字符集不会自动转换已存在的数据，只对新数据生效</p>
<h4 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> DATABASE db_name;</span><br><span class="line"><span class="keyword">DROP</span> DATABASE IF <span class="keyword">EXISTS</span> db_name;  <span class="comment">-- 存在才删除，避免错误</span></span><br></pre></td></tr></table></figure>

<p><strong>危险性：</strong> 数据库删除后无法恢复（除非有备份），需谨慎操作</p>
<hr>
<h2 id="三、数据表操作详解"><a href="#三、数据表操作详解" class="headerlink" title="三、数据表操作详解"></a>三、数据表操作详解</h2><h3 id="3-1-表的结构设计"><a href="#3-1-表的结构设计" class="headerlink" title="3.1 表的结构设计"></a>3.1 表的结构设计</h3><h4 id="创建表的核心元素"><a href="#创建表的核心元素" class="headerlink" title="创建表的核心元素"></a>创建表的核心元素</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">  <span class="comment">-- 1. 主键：唯一标识一行数据，不能重复或为空</span></span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;用户ID&#x27;</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">-- 2. 非空约束：该列必须有值</span></span><br><span class="line">  username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span> COMMENT <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">-- 3. 默认值：插入时如果不指定则使用默认值</span></span><br><span class="line">  status ENUM(<span class="string">&#x27;active&#x27;</span>, <span class="string">&#x27;inactive&#x27;</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;active&#x27;</span> COMMENT <span class="string">&#x27;用户状态&#x27;</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">-- 4. 时间戳：记录创建和修改时间</span></span><br><span class="line">  created_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  updated_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">-- 5. 索引：加速查询</span></span><br><span class="line">  KEY idx_username (username)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br></pre></td></tr></table></figure>

<p><strong>核心概念解析：</strong></p>
<table>
<thead>
<tr>
<th>概念</th>
<th>作用</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><strong>主键（Primary Key）</strong></td>
<td>唯一标识每一行，加快查询速度</td>
<td>id INT PRIMARY KEY AUTO_INCREMENT</td>
</tr>
<tr>
<td><strong>非空约束（NOT NULL）</strong></td>
<td>确保该列必须有值</td>
<td>username VARCHAR(50) NOT NULL</td>
</tr>
<tr>
<td><strong>唯一约束（UNIQUE）</strong></td>
<td>确保列值不重复</td>
<td>email VARCHAR(100) UNIQUE</td>
</tr>
<tr>
<td><strong>默认值（DEFAULT）</strong></td>
<td>不指定值时自动填充</td>
<td>status DEFAULT ‘active’</td>
</tr>
<tr>
<td><strong>自增（AUTO_INCREMENT）</strong></td>
<td>自动生成递增的整数值</td>
<td>id AUTO_INCREMENT</td>
</tr>
<tr>
<td><strong>外键（FOREIGN KEY）</strong></td>
<td>维护表间关系的完整性</td>
<td>见下方示例</td>
</tr>
</tbody></table>
<h4 id="完整表设计示例（包含关系）"><a href="#完整表设计示例（包含关系）" class="headerlink" title="完整表设计示例（包含关系）"></a>完整表设计示例（包含关系）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 用户表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">  email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  created_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 订单表，通过外键关联用户表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  user_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">  order_no <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">  amount <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>),</span><br><span class="line">  created_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  <span class="comment">-- 外键：确保 user_id 必须是 users 表中存在的 id</span></span><br><span class="line">  <span class="keyword">FOREIGN KEY</span> (user_id) <span class="keyword">REFERENCES</span> users(id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br></pre></td></tr></table></figure>

<p><strong>外键的作用：</strong></p>
<ul>
<li>防止数据不一致（不能插入不存在的用户ID）</li>
<li><code>ON DELETE CASCADE</code>：当用户被删除时，其订单也自动删除</li>
<li><code>ON DELETE RESTRICT</code>：禁止删除有订单的用户</li>
</ul>
<h3 id="3-2-查看表结构"><a href="#3-2-查看表结构" class="headerlink" title="3.2 查看表结构"></a>3.2 查看表结构</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看表结构（最常用）</span></span><br><span class="line"><span class="keyword">DESC</span> table_name;</span><br><span class="line"><span class="keyword">DESCRIBE</span> table_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看创建表的完整 SQL 语句</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE TABLE</span> table_name\G  <span class="comment">-- \G 让输出竖排显示</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看表的详细信息（包括行数、大小等）</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLE</span> STATUS <span class="keyword">FROM</span> db_name <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="string">&#x27;table_name&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看所有表</span></span><br><span class="line"><span class="keyword">SHOW</span> TABLES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看表的列信息</span></span><br><span class="line"><span class="keyword">SHOW</span> COLUMNS <span class="keyword">FROM</span> table_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看表占用的空间</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  table_name,</span><br><span class="line">  ROUND(((data_length <span class="operator">+</span> index_length) <span class="operator">/</span> <span class="number">1024</span> <span class="operator">/</span> <span class="number">1024</span>), <span class="number">2</span>) <span class="keyword">as</span> size_mb</span><br><span class="line"><span class="keyword">FROM</span> information_schema.tables</span><br><span class="line"><span class="keyword">WHERE</span> table_schema <span class="operator">=</span> DATABASE()</span><br><span class="line"><span class="keyword">AND</span> table_name <span class="operator">=</span> <span class="string">&#x27;table_name&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>作用：</strong> 快速了解表的结构，便于后续开发和维护</p>
<h3 id="3-3-修改表结构"><a href="#3-3-修改表结构" class="headerlink" title="3.3 修改表结构"></a>3.3 修改表结构</h3><h4 id="添加列"><a href="#添加列" class="headerlink" title="添加列"></a>添加列</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 基本添加（在最后添加）</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> table_name <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> new_col <span class="type">VARCHAR</span>(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在指定列后添加</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> table_name <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> new_col <span class="type">VARCHAR</span>(<span class="number">100</span>) AFTER email;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在最前面添加</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> table_name <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> new_col <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">FIRST</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加多列</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> table_name </span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">COLUMN</span> col1 <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">COLUMN</span> col2 <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p><strong>为什么需要添加列：</strong> 业务需求变更，需要记录新的属性信息</p>
<h4 id="修改列"><a href="#修改列" class="headerlink" title="修改列"></a>修改列</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 修改列的数据类型或约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> table_name MODIFY <span class="keyword">COLUMN</span> col_name <span class="type">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改列名和类型</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> table_name CHANGE old_col_name new_col_name <span class="type">INT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加默认值</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> table_name <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> col_name <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除默认值</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> table_name <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> col_name <span class="keyword">DROP</span> <span class="keyword">DEFAULT</span>;</span><br></pre></td></tr></table></figure>

<p><strong>为什么需要修改：</strong> </p>
<ul>
<li>业务需求变化，字段长度不够</li>
<li>发现业务逻辑错误，需要调整约束</li>
</ul>
<h4 id="删除列"><a href="#删除列" class="headerlink" title="删除列"></a>删除列</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> table_name <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> col_name;</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong> 删除列会丢失该列的所有数据，需要谨慎</p>
<h4 id="添加索引"><a href="#添加索引" class="headerlink" title="添加索引"></a>添加索引</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 普通索引：加速查询</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> table_name <span class="keyword">ADD</span> INDEX idx_name (email);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 唯一索引：不仅加速，还保证唯一性</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> table_name <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> INDEX idx_email (email);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 复合索引：多列组合查询时有效</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> table_name <span class="keyword">ADD</span> INDEX idx_name_age (name, age);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 全文索引：用于全文搜索</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> articles <span class="keyword">ADD</span> FULLTEXT INDEX ft_content (content);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 主键索引</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> table_name <span class="keyword">ADD</span> <span class="keyword">PRIMARY KEY</span> (id);</span><br></pre></td></tr></table></figure>

<p><strong>索引的作用：</strong></p>
<ul>
<li><strong>加速查询</strong>：减少数据库需要扫描的行数</li>
<li><strong>提高排序效率</strong>：ORDER BY 可以利用索引快速排序</li>
<li><strong>加快JOIN操作</strong>：通过索引快速关联表</li>
</ul>
<p><strong>为什么不全加索引：</strong> </p>
<ul>
<li>索引占用磁盘空间</li>
<li>插入&#x2F;更新&#x2F;删除时需要维护索引，降低写入速度</li>
<li>索引过多会增加查询优化器的压力</li>
</ul>
<h4 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除普通索引</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> table_name <span class="keyword">DROP</span> INDEX idx_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除主键索引</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> table_name <span class="keyword">DROP</span> <span class="keyword">PRIMARY KEY</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除唯一索引</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> table_name <span class="keyword">DROP</span> INDEX idx_email;</span><br></pre></td></tr></table></figure>

<h4 id="重命名表"><a href="#重命名表" class="headerlink" title="重命名表"></a>重命名表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> old_table_name RENAME <span class="keyword">TO</span> new_table_name;</span><br><span class="line">RENAME <span class="keyword">TABLE</span> old_name <span class="keyword">TO</span> new_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 多表重命名</span></span><br><span class="line">RENAME <span class="keyword">TABLE</span> old1 <span class="keyword">TO</span> new1, old2 <span class="keyword">TO</span> new2;</span><br></pre></td></tr></table></figure>

<h4 id="修改表的字符集"><a href="#修改表的字符集" class="headerlink" title="修改表的字符集"></a>修改表的字符集</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 只修改默认字符集，已有数据不转换</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> table_name <span class="keyword">DEFAULT</span> <span class="keyword">CHARACTER SET</span> utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 转换表及所有列的字符集（耗时较长）</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> table_name <span class="keyword">CONVERT</span> <span class="keyword">TO</span> <span class="keyword">CHARACTER SET</span> utf8mb4;</span><br></pre></td></tr></table></figure>

<p><strong>为什么需要转换：</strong> 解决乱码问题，或为了系统升级</p>
<h3 id="3-4-删除表"><a href="#3-4-删除表" class="headerlink" title="3.4 删除表"></a>3.4 删除表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 立即删除表结构和数据</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> table_name;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> table_name;  <span class="comment">-- 存在才删除</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 清空表数据，但保留表结构（更快）</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> table_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除表数据（较慢，但可回滚）</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure>

<p><strong>三种方式对比：</strong></p>
<table>
<thead>
<tr>
<th>方式</th>
<th>速度</th>
<th>是否可恢复</th>
<th>是否重置自增ID</th>
<th>场景</th>
</tr>
</thead>
<tbody><tr>
<td>DROP</td>
<td>快</td>
<td>否</td>
<td>是</td>
<td>完全删除表</td>
</tr>
<tr>
<td>TRUNCATE</td>
<td>很快</td>
<td>否（除非用binlog）</td>
<td>是</td>
<td>清空表但保留结构</td>
</tr>
<tr>
<td>DELETE</td>
<td>慢</td>
<td>是（事务内）</td>
<td>否</td>
<td>删除部分数据</td>
</tr>
</tbody></table>
<hr>
<h2 id="四、数据行操作详解（CRUD）"><a href="#四、数据行操作详解（CRUD）" class="headerlink" title="四、数据行操作详解（CRUD）"></a>四、数据行操作详解（CRUD）</h2><h3 id="4-1-创建（Create）-插入数据"><a href="#4-1-创建（Create）-插入数据" class="headerlink" title="4.1 创建（Create）- 插入数据"></a>4.1 创建（Create）- 插入数据</h3><h4 id="基本插入"><a href="#基本插入" class="headerlink" title="基本插入"></a>基本插入</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 指定列插入（推荐）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (username, email, age) <span class="keyword">VALUES</span> (<span class="string">&#x27;john&#x27;</span>, <span class="string">&#x27;john@example.com&#x27;</span>, <span class="number">25</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 不指定列，按表定义顺序插入</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;john&#x27;</span>, <span class="string">&#x27;john@example.com&#x27;</span>, <span class="number">25</span>, NOW());</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 一次插入多行（批量操作更高效）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (username, email, age) <span class="keyword">VALUES</span> </span><br><span class="line">  (<span class="string">&#x27;john&#x27;</span>, <span class="string">&#x27;john@example.com&#x27;</span>, <span class="number">25</span>),</span><br><span class="line">  (<span class="string">&#x27;jane&#x27;</span>, <span class="string">&#x27;jane@example.com&#x27;</span>, <span class="number">23</span>),</span><br><span class="line">  (<span class="string">&#x27;bob&#x27;</span>, <span class="string">&#x27;bob@example.com&#x27;</span>, <span class="number">28</span>);</span><br></pre></td></tr></table></figure>

<p><strong>为什么指定列更好：</strong> </p>
<ul>
<li>代码可读性强</li>
<li>如果表结构改变，SQL 仍然有效</li>
<li>不易出错</li>
</ul>
<h4 id="从其他表复制数据"><a href="#从其他表复制数据" class="headerlink" title="从其他表复制数据"></a>从其他表复制数据</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 将查询结果插入新表</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> archive_users (username, email, age) </span><br><span class="line"><span class="keyword">SELECT</span> username, email, age <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> created_at <span class="operator">&lt;</span> <span class="string">&#x27;2020-01-01&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>作用：</strong> 数据迁移、数据备份、数据转移</p>
<h4 id="INSERT-执行过程"><a href="#INSERT-执行过程" class="headerlink" title="INSERT 执行过程"></a>INSERT 执行过程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 检查约束：检查 NOT NULL、UNIQUE、PRIMARY KEY 等</span><br><span class="line">2. 触发 BEFORE INSERT 触发器（如果有）</span><br><span class="line">3. 插入数据</span><br><span class="line">4. 更新索引</span><br><span class="line">5. 触发 AFTER INSERT 触发器（如果有）</span><br></pre></td></tr></table></figure>

<h3 id="4-2-读取（Retrieve）-查询数据"><a href="#4-2-读取（Retrieve）-查询数据" class="headerlink" title="4.2 读取（Retrieve）- 查询数据"></a>4.2 读取（Retrieve）- 查询数据</h3><h4 id="基础查询"><a href="#基础查询" class="headerlink" title="基础查询"></a>基础查询</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询所有列</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询指定列（推荐，提高效率）</span></span><br><span class="line"><span class="keyword">SELECT</span> id, username, email <span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询带别名（便于阅读）</span></span><br><span class="line"><span class="keyword">SELECT</span> id <span class="keyword">AS</span> 用户ID, username <span class="keyword">AS</span> 用户名 <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure>

<p>*<em>为什么不用 SELECT <em>：</em></em></p>
<ul>
<li>返回不必要的列，浪费网络带宽和内存</li>
<li>索引可能无法被有效利用</li>
<li>表结构改变可能导致程序出错</li>
</ul>
<h4 id="WHERE-条件查询"><a href="#WHERE-条件查询" class="headerlink" title="WHERE 条件查询"></a>WHERE 条件查询</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 等值查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 比较查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">18</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">&gt;=</span> <span class="number">18</span> <span class="keyword">AND</span> age <span class="operator">&lt;=</span> <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 逻辑查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users </span><br><span class="line"><span class="keyword">WHERE</span> (age <span class="operator">&gt;</span> <span class="number">18</span> <span class="keyword">AND</span> status <span class="operator">=</span> <span class="string">&#x27;active&#x27;</span>) <span class="keyword">OR</span> vip <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 模糊查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="keyword">LIKE</span> <span class="string">&#x27;jo%&#x27;</span>;      <span class="comment">-- 以 jo 开头</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="keyword">LIKE</span> <span class="string">&#x27;%john%&#x27;</span>;   <span class="comment">-- 包含 john</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="keyword">LIKE</span> <span class="string">&#x27;%n&#x27;</span>;       <span class="comment">-- 以 n 结尾</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 范围查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="keyword">IN</span> (<span class="number">18</span>, <span class="number">20</span>, <span class="number">25</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="number">18</span>, <span class="number">20</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="keyword">BETWEEN</span> <span class="number">18</span> <span class="keyword">AND</span> <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 时间范围查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users </span><br><span class="line"><span class="keyword">WHERE</span> created_at <span class="keyword">BETWEEN</span> <span class="string">&#x27;2024-01-01&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2024-12-31&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 空值查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> email <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> email <span class="keyword">IS</span> <span class="keyword">NOT NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 模糊匹配的 LIKE 性能问题</span></span><br><span class="line"><span class="comment">-- 不走索引的情况：LIKE &#x27;%john%&#x27; 或 LIKE &#x27;%john&#x27;</span></span><br><span class="line"><span class="comment">-- 走索引的情况：LIKE &#x27;john%&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>WHERE 执行顺序：</strong> 从左到右执行，性能优化时应该把最容易过滤的条件放前面</p>
<h4 id="排序（ORDER-BY）"><a href="#排序（ORDER-BY）" class="headerlink" title="排序（ORDER BY）"></a>排序（ORDER BY）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 单列排序（升序）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> created_at;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 多列排序（先按 age 降序，再按 name 升序）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> age <span class="keyword">DESC</span>, name <span class="keyword">ASC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 按表达式排序</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">YEAR</span>(created_at) <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- NULL 值排序（NULL 最先）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> email;  <span class="comment">-- NULL 会排在最前面</span></span><br></pre></td></tr></table></figure>

<p><strong>为什么重要：</strong> 排序是最耗资源的操作之一，大数据量时应该利用索引</p>
<h4 id="分页查询（LIMIT）"><a href="#分页查询（LIMIT）" class="headerlink" title="分页查询（LIMIT）"></a>分页查询（LIMIT）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 获取前 10 条</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users LIMIT <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 获取第 20-30 条（跳过20条，取10条）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users LIMIT <span class="number">20</span>, <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 另一种分页写法（推荐）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users LIMIT <span class="number">10</span> <span class="keyword">OFFSET</span> <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 获取最后 5 条数据</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> id <span class="keyword">DESC</span> LIMIT <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<p><strong>分页的性能问题：</strong> OFFSET 很大时性能差，因为 MySQL 仍需要扫描 OFFSET 后面的所有行。解决方案是使用主键范围查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 高性能分页</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">&gt;</span> last_id LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<h4 id="去重（DISTINCT）"><a href="#去重（DISTINCT）" class="headerlink" title="去重（DISTINCT）"></a>去重（DISTINCT）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询所有不同的城市</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> city <span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询不同城市的用户数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> city <span class="keyword">FROM</span> users;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> city) <span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 多列去重</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> city, province <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure>

<p><strong>作用：</strong> 快速了解数据的多样性</p>
<h4 id="聚合函数（聚集数据）"><a href="#聚合函数（聚集数据）" class="headerlink" title="聚合函数（聚集数据）"></a>聚合函数（聚集数据）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- COUNT：计数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> users;                    <span class="comment">-- 总数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(email) <span class="keyword">FROM</span> users;                <span class="comment">-- 非空的 email 数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> city) <span class="keyword">FROM</span> users;        <span class="comment">-- 不同城市数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- SUM：求和</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(salary) <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="string">&#x27;active&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- AVG：平均值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(age) <span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- MAX/MIN：最大值/最小值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span>(age), <span class="built_in">MIN</span>(age) <span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- GROUP_CONCAT：合并字符串</span></span><br><span class="line"><span class="keyword">SELECT</span> GROUP_CONCAT(username) <span class="keyword">FROM</span> users;</span><br><span class="line"><span class="keyword">SELECT</span> GROUP_CONCAT(<span class="keyword">DISTINCT</span> username SEPARATOR <span class="string">&#x27;; &#x27;</span>) <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure>

<p><strong>聚合函数的特点：</strong> 返回单一结果，常配合 GROUP BY 使用</p>
<h4 id="分组（GROUP-BY）"><a href="#分组（GROUP-BY）" class="headerlink" title="分组（GROUP BY）"></a>分组（GROUP BY）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 按城市分组，统计每个城市的用户数</span></span><br><span class="line"><span class="keyword">SELECT</span> city, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> user_count </span><br><span class="line"><span class="keyword">FROM</span> users </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> city;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 按城市分组，计算平均年龄</span></span><br><span class="line"><span class="keyword">SELECT</span> city, <span class="built_in">AVG</span>(age) <span class="keyword">as</span> avg_age </span><br><span class="line"><span class="keyword">FROM</span> users </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> city;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 多列分组</span></span><br><span class="line"><span class="keyword">SELECT</span> city, province, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> count </span><br><span class="line"><span class="keyword">FROM</span> users </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> city, province;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 分组后筛选（HAVING）</span></span><br><span class="line"><span class="keyword">SELECT</span> city, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> count </span><br><span class="line"><span class="keyword">FROM</span> users </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> city </span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">10</span>;  <span class="comment">-- 只显示用户数 &gt; 10 的城市</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- GROUP BY 配合 ORDER BY</span></span><br><span class="line"><span class="keyword">SELECT</span> city, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> count </span><br><span class="line"><span class="keyword">FROM</span> users </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> city </span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">5</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> count <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<p><strong>GROUP BY 的执行顺序：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. WHERE（筛选原始行）</span><br><span class="line">2. GROUP BY（分组）</span><br><span class="line">3. 聚合函数（计算）</span><br><span class="line">4. HAVING（筛选分组结果）</span><br><span class="line">5. ORDER BY（排序）</span><br></pre></td></tr></table></figure>

<p><strong>GROUP BY 的性能问题：</strong> 大数据量时可能产生 Using temporary、Using filesort，需要优化</p>
<h4 id="多表连接"><a href="#多表连接" class="headerlink" title="多表连接"></a>多表连接</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- INNER JOIN（内连接）：只返回两表都有的记录</span></span><br><span class="line"><span class="keyword">SELECT</span> u.id, u.username, o.order_id, o.amount</span><br><span class="line"><span class="keyword">FROM</span> users u</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> orders o <span class="keyword">ON</span> u.id <span class="operator">=</span> o.user_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- LEFT JOIN（左外连接）：返回左表所有记录，右表无则为 NULL</span></span><br><span class="line"><span class="keyword">SELECT</span> u.id, u.username, o.order_id</span><br><span class="line"><span class="keyword">FROM</span> users u</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> orders o <span class="keyword">ON</span> u.id <span class="operator">=</span> o.user_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- RIGHT JOIN（右外连接）：返回右表所有记录，左表无则为 NULL</span></span><br><span class="line"><span class="keyword">SELECT</span> u.id, u.username, o.order_id</span><br><span class="line"><span class="keyword">FROM</span> users u</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> orders o <span class="keyword">ON</span> u.id <span class="operator">=</span> o.user_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- CROSS JOIN（交叉连接）：笛卡尔积，返回两表所有可能的组合</span></span><br><span class="line"><span class="keyword">SELECT</span> u.id, o.id <span class="keyword">FROM</span> users u <span class="keyword">CROSS</span> <span class="keyword">JOIN</span> orders o;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 自连接：表与自身连接</span></span><br><span class="line"><span class="keyword">SELECT</span> e1.name, e2.name </span><br><span class="line"><span class="keyword">FROM</span> employees e1</span><br><span class="line"><span class="keyword">JOIN</span> employees e2 <span class="keyword">ON</span> e1.manager_id <span class="operator">=</span> e2.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 多表连接</span></span><br><span class="line"><span class="keyword">SELECT</span> u.username, o.order_id, p.product_name</span><br><span class="line"><span class="keyword">FROM</span> users u</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> orders o <span class="keyword">ON</span> u.id <span class="operator">=</span> o.user_id</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> products p <span class="keyword">ON</span> o.product_id <span class="operator">=</span> p.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 子查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="keyword">IN</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> user_id <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> amount <span class="operator">&gt;</span> <span class="number">1000</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>连接类型对比：</strong></p>
<table>
<thead>
<tr>
<th>连接类型</th>
<th>作用</th>
<th>场景</th>
</tr>
</thead>
<tbody><tr>
<td>INNER JOIN</td>
<td>只返回两表交集</td>
<td>严格的数据关联</td>
</tr>
<tr>
<td>LEFT JOIN</td>
<td>返回左表全部</td>
<td>保留所有主记录</td>
</tr>
<tr>
<td>RIGHT JOIN</td>
<td>返回右表全部</td>
<td>保留所有从记录</td>
</tr>
<tr>
<td>FULL OUTER JOIN</td>
<td>MySQL 不支持，需用 UNION</td>
<td>获取所有记录</td>
</tr>
</tbody></table>
<p><strong>连接的性能优化：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不推荐：多次子查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="keyword">IN</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> user_id <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> id <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> order_id <span class="keyword">FROM</span> order_items <span class="keyword">WHERE</span> amount <span class="operator">&gt;</span> <span class="number">100</span></span><br><span class="line">  )</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 推荐：用 JOIN 替代</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> u.<span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> users u</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> orders o <span class="keyword">ON</span> u.id <span class="operator">=</span> o.user_id</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> order_items oi <span class="keyword">ON</span> o.id <span class="operator">=</span> oi.order_id</span><br><span class="line"><span class="keyword">WHERE</span> oi.amount <span class="operator">&gt;</span> <span class="number">100</span>;</span><br></pre></td></tr></table></figure>

<h4 id="UNION-查询（合并结果）"><a href="#UNION-查询（合并结果）" class="headerlink" title="UNION 查询（合并结果）"></a>UNION 查询（合并结果）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 合并两个查询结果（自动去重）</span></span><br><span class="line"><span class="keyword">SELECT</span> username <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">18</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> username <span class="keyword">FROM</span> vip_users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 合并且保留重复</span></span><br><span class="line"><span class="keyword">SELECT</span> username <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">18</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> username <span class="keyword">FROM</span> vip_users;</span><br></pre></td></tr></table></figure>

<p><strong>作用：</strong> 将不同表或不同查询的结果合并显示</p>
<h3 id="4-3-修改（Update）-更新数据"><a href="#4-3-修改（Update）-更新数据" class="headerlink" title="4.3 修改（Update）- 更新数据"></a>4.3 修改（Update）- 更新数据</h3><h4 id="基本更新"><a href="#基本更新" class="headerlink" title="基本更新"></a>基本更新</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 更新单条记录</span></span><br><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> age <span class="operator">=</span> <span class="number">25</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 更新多列</span></span><br><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> age <span class="operator">=</span> <span class="number">25</span>, status <span class="operator">=</span> <span class="string">&#x27;active&#x27;</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 批量更新</span></span><br><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> status <span class="operator">=</span> <span class="string">&#x27;inactive&#x27;</span> <span class="keyword">WHERE</span> created_at <span class="operator">&lt;</span> <span class="string">&#x27;2020-01-01&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用表达式更新</span></span><br><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> age <span class="operator">=</span> age <span class="operator">+</span> <span class="number">1</span> <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="string">&#x27;active&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用函数更新</span></span><br><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> email <span class="operator">=</span> <span class="built_in">LOWER</span>(email);</span><br><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> updated_at <span class="operator">=</span> NOW() <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h4 id="条件更新"><a href="#条件更新" class="headerlink" title="条件更新"></a>条件更新</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- CASE WHEN 条件更新</span></span><br><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> status <span class="operator">=</span> <span class="keyword">CASE</span> </span><br><span class="line">  <span class="keyword">WHEN</span> age <span class="operator">&lt;</span> <span class="number">18</span> <span class="keyword">THEN</span> <span class="string">&#x27;minor&#x27;</span></span><br><span class="line">  <span class="keyword">WHEN</span> age <span class="operator">&gt;=</span> <span class="number">18</span> <span class="keyword">AND</span> age <span class="operator">&lt;</span> <span class="number">60</span> <span class="keyword">THEN</span> <span class="string">&#x27;adult&#x27;</span></span><br><span class="line">  <span class="keyword">ELSE</span> <span class="string">&#x27;senior&#x27;</span></span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 根据其他表的数据更新</span></span><br><span class="line"><span class="keyword">UPDATE</span> users u</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> orders o <span class="keyword">ON</span> u.id <span class="operator">=</span> o.user_id</span><br><span class="line"><span class="keyword">SET</span> u.vip <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">WHERE</span> o.amount <span class="operator">&gt;</span> <span class="number">10000</span>;</span><br></pre></td></tr></table></figure>

<h4 id="UPDATE-的性能注意"><a href="#UPDATE-的性能注意" class="headerlink" title="UPDATE 的性能注意"></a>UPDATE 的性能注意</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不推荐：一次更新大量数据</span></span><br><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> status <span class="operator">=</span> <span class="string">&#x27;inactive&#x27;</span> <span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">100000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 推荐：分批更新</span></span><br><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> status <span class="operator">=</span> <span class="string">&#x27;inactive&#x27;</span> <span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">100000</span> LIMIT <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在 shell 脚本中循环执行以上语句</span></span><br></pre></td></tr></table></figure>

<p><strong>为什么要分批：</strong> </p>
<ul>
<li>避免锁表时间过长</li>
<li>减少内存占用</li>
<li>保证服务可用性</li>
</ul>
<h4 id="UPDATE-的安全注意"><a href="#UPDATE-的安全注意" class="headerlink" title="UPDATE 的安全注意"></a>UPDATE 的安全注意</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 危险：没有 WHERE 条件，会更新所有行</span></span><br><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> status <span class="operator">=</span> <span class="string">&#x27;inactive&#x27;</span>;  <span class="comment">-- ❌ 严禁！</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 安全：明确指定条件</span></span><br><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> status <span class="operator">=</span> <span class="string">&#x27;inactive&#x27;</span> <span class="keyword">WHERE</span> last_login <span class="operator">&lt;</span> DATE_SUB(NOW(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">YEAR</span>);</span><br></pre></td></tr></table></figure>

<h3 id="4-4-删除（Delete）-删除数据"><a href="#4-4-删除（Delete）-删除数据" class="headerlink" title="4.4 删除（Delete）- 删除数据"></a>4.4 删除（Delete）- 删除数据</h3><h4 id="基本删除"><a href="#基本删除" class="headerlink" title="基本删除"></a>基本删除</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除单条记录</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 批量删除</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="string">&#x27;inactive&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 按时间范围删除（如删除一年未登录的用户）</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> last_login <span class="operator">&lt;</span> DATE_SUB(NOW(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">YEAR</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除所有数据（保留表结构）</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure>

<h4 id="DELETE-与-TRUNCATE-对比"><a href="#DELETE-与-TRUNCATE-对比" class="headerlink" title="DELETE 与 TRUNCATE 对比"></a>DELETE 与 TRUNCATE 对比</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- TRUNCATE：快速清空表</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 对比说明：</span></span><br><span class="line"><span class="comment">-- 1. 速度：TRUNCATE 快于 DELETE（TRUNCATE 不逐行删除）</span></span><br><span class="line"><span class="comment">-- 2. 事务：DELETE 支持事务回滚，TRUNCATE 不支持</span></span><br><span class="line"><span class="comment">-- 3. 自增：TRUNCATE 重置自增 ID，DELETE 不重置</span></span><br><span class="line"><span class="comment">-- 4. 触发器：DELETE 会触发 AFTER DELETE 触发器，TRUNCATE 不会</span></span><br><span class="line"><span class="comment">-- 5. 空间：DELETE 不释放表空间，TRUNCATE 释放表空间</span></span><br></pre></td></tr></table></figure>

<h4 id="联级删除"><a href="#联级删除" class="headerlink" title="联级删除"></a>联级删除</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 定义外键时指定 ON DELETE CASCADE</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  user_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">  <span class="keyword">FOREIGN KEY</span> (user_id) <span class="keyword">REFERENCES</span> users(id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除用户时，对应的订单也会自动删除</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h4 id="DELETE-的性能优化"><a href="#DELETE-的性能优化" class="headerlink" title="DELETE 的性能优化"></a>DELETE 的性能优化</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不推荐：大量删除一次执行</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> logs <span class="keyword">WHERE</span> created_at <span class="operator">&lt;</span> <span class="string">&#x27;2024-01-01&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 推荐：分批删除</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> logs <span class="keyword">WHERE</span> created_at <span class="operator">&lt;</span> <span class="string">&#x27;2024-01-01&#x27;</span> LIMIT <span class="number">10000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 或者用分区表，直接删除分区效率更高</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> logs <span class="keyword">DROP</span> <span class="keyword">PARTITION</span> p_2023;</span><br></pre></td></tr></table></figure>

<h4 id="DELETE-的安全注意"><a href="#DELETE-的安全注意" class="headerlink" title="DELETE 的安全注意"></a>DELETE 的安全注意</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 危险：没有 WHERE 条件</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> users;  <span class="comment">-- ❌ 严禁！</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 安全做法：</span></span><br><span class="line"><span class="comment">-- 1. 先备份表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users_backup <span class="keyword">AS</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 再删除</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 或使用逻辑删除（软删除）</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> is_deleted TINYINT <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">-- 删除时只是标记，不真正删除</span></span><br><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> is_deleted <span class="operator">=</span> <span class="number">1</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 查询时排除已删除的数据</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> is_deleted <span class="operator">=</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="五、索引详解"><a href="#五、索引详解" class="headerlink" title="五、索引详解"></a>五、索引详解</h2><h3 id="5-1-什么是索引"><a href="#5-1-什么是索引" class="headerlink" title="5.1 什么是索引"></a>5.1 什么是索引</h3><p>索引是数据库为了加快查询速度而对表的某一列或多列建立的有序数据结构（通常是 B+ 树）。就像书的目录，可以快速定位到对应的内容。</p>
<p><img src="/./imgs/image-20251120185917248.png" alt="image-20251120185917248"></p>
<h3 id="5-1-1-索引的作用（为什么需要索引）"><a href="#5-1-1-索引的作用（为什么需要索引）" class="headerlink" title="5.1.1 索引的作用（为什么需要索引）"></a>5.1.1 索引的作用（为什么需要索引）</h3><p>简单来说八个字：优化查询，提升效率</p>
<h4 id="性能提升"><a href="#性能提升" class="headerlink" title="性能提升"></a>性能提升</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">无索引查询（全表扫描）：</span><br><span class="line">需要逐行检查所有 1,000,000 行 → 平均需要检查 500,000 行</span><br><span class="line"></span><br><span class="line">有索引查询（二分查找）：</span><br><span class="line">通过 B+ 树直接定位 → 只需检查 20-30 行</span><br><span class="line">→ 性能提升 10000+ 倍！</span><br></pre></td></tr></table></figure>

<h4 id="具体作用"><a href="#具体作用" class="headerlink" title="具体作用"></a>具体作用</h4><table>
<thead>
<tr>
<th>作用</th>
<th>说明</th>
<th>性能提升</th>
</tr>
</thead>
<tbody><tr>
<td><strong>加速 WHERE 查询</strong></td>
<td>快速定位符合条件的行</td>
<td>1000+ 倍</td>
</tr>
<tr>
<td><strong>加速 JOIN 操作</strong></td>
<td>快速匹配关联表数据</td>
<td>100+ 倍</td>
</tr>
<tr>
<td><strong>加速 ORDER BY</strong></td>
<td>索引已排好序，无需排序</td>
<td>100+ 倍</td>
</tr>
<tr>
<td><strong>加速 GROUP BY</strong></td>
<td>利用索引快速分组</td>
<td>100+ 倍</td>
</tr>
<tr>
<td><strong>支持覆盖查询</strong></td>
<td>查询只需读索引，不读表</td>
<td>10+ 倍</td>
</tr>
<tr>
<td><strong>约束数据一致性</strong></td>
<td>唯一索引保证数据不重复</td>
<td>N&#x2F;A</td>
</tr>
</tbody></table>
<h4 id="实际例子"><a href="#实际例子" class="headerlink" title="实际例子"></a>实际例子</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 场景 1：电商网站查询用户订单</span></span><br><span class="line"><span class="comment">-- 无索引：扫描 1000 万条订单</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> user_id <span class="operator">=</span> <span class="number">123</span>;  <span class="comment">-- 需要 10 秒</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 有索引（user_id）：直接定位</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> user_id <span class="operator">=</span> <span class="number">123</span>;  <span class="comment">-- 0.01 秒</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 场景 2：日志系统按日期查询</span></span><br><span class="line"><span class="comment">-- 无索引：扫描 10 亿条日志</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> logs <span class="keyword">WHERE</span> created_at <span class="operator">&gt;</span> <span class="string">&#x27;2024-01-01&#x27;</span>;  <span class="comment">-- 需要 5 分钟</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 有索引（created_at）：范围查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> logs <span class="keyword">WHERE</span> created_at <span class="operator">&gt;</span> <span class="string">&#x27;2024-01-01&#x27;</span>;  <span class="comment">-- 0.1 秒</span></span><br></pre></td></tr></table></figure>

<h3 id="5-1-2-索引的副作用（为什么不全加索引）"><a href="#5-1-2-索引的副作用（为什么不全加索引）" class="headerlink" title="5.1.2 索引的副作用（为什么不全加索引）"></a>5.1.2 索引的副作用（为什么不全加索引）</h3><h4 id="1-占用磁盘空间"><a href="#1-占用磁盘空间" class="headerlink" title="1. 占用磁盘空间"></a>1. 占用磁盘空间</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 一个 100GB 的表</span></span><br><span class="line"><span class="comment">-- 如果建 10 个索引，可能需要额外 100GB 空间</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看索引占用的空间</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  table_name,</span><br><span class="line">  index_name,</span><br><span class="line">  ROUND(stat_value <span class="operator">*</span> @<span class="variable">@innodb_page_size</span> <span class="operator">/</span> <span class="number">1024</span> <span class="operator">/</span> <span class="number">1024</span>, <span class="number">2</span>) <span class="keyword">as</span> size_mb</span><br><span class="line"><span class="keyword">FROM</span> mysql.innodb_index_stats</span><br><span class="line"><span class="keyword">WHERE</span> table_name <span class="operator">=</span> <span class="string">&#x27;orders&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> stat_value <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<p><strong>问题：</strong> 存储成本高，备份和恢复速度慢</p>
<h4 id="2-降低写入性能"><a href="#2-降低写入性能" class="headerlink" title="2. 降低写入性能"></a>2. 降低写入性能</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">写入一条数据的过程：</span><br><span class="line">1. 数据写入表 → O(1)</span><br><span class="line">2. 更新索引 1 → O(log n)</span><br><span class="line">3. 更新索引 2 → O(log n)</span><br><span class="line">4. 更新索引 3 → O(log n)</span><br><span class="line">...</span><br><span class="line">总时间 = O(1) + O(log n) * 索引个数</span><br><span class="line"></span><br><span class="line">结果：索引越多，写入越慢</span><br></pre></td></tr></table></figure>

<h4 id="实际例子-1"><a href="#实际例子-1" class="headerlink" title="实际例子"></a>实际例子</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 插入 100 万条数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 无索引</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> products <span class="keyword">VALUES</span> (...);  <span class="comment">-- 需要 1 分钟</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 有 5 个索引</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> products <span class="keyword">VALUES</span> (...);  <span class="comment">-- 需要 5-10 分钟</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 原因：每次插入都要维护 5 个索引</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 解决方案：批量插入时禁用索引</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> products DISABLE KEYS;</span><br><span class="line"><span class="keyword">INSERT INTO</span> products <span class="keyword">VALUES</span> (...);</span><br><span class="line"><span class="keyword">ALTER TABLE</span> products ENABLE KEYS;  <span class="comment">-- 批量重建索引，更快</span></span><br></pre></td></tr></table></figure>

<h4 id="3-增加维护成本"><a href="#3-增加维护成本" class="headerlink" title="3. 增加维护成本"></a>3. 增加维护成本</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 索引可能产生碎片</span></span><br><span class="line"><span class="comment">-- 需要定期重建</span></span><br><span class="line">OPTIMIZE <span class="keyword">TABLE</span> products;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除记录后索引变稀疏</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> logs <span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">1000000</span>;</span><br><span class="line"><span class="comment">-- 索引中有很多&quot;空位&quot;，浪费空间</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 更新字段时需要维护对应索引</span></span><br><span class="line"><span class="keyword">UPDATE</span> products <span class="keyword">SET</span> price <span class="operator">=</span> price <span class="operator">*</span> <span class="number">1.1</span>;</span><br><span class="line"><span class="comment">-- 如果 price 有索引，需要重建索引</span></span><br></pre></td></tr></table></figure>

<h4 id="4-查询优化器困惑"><a href="#4-查询优化器困惑" class="headerlink" title="4. 查询优化器困惑"></a>4. 查询优化器困惑</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 索引太多时，优化器选择不当</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ❌ 坏：有 20 个索引，优化器可能选错</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx1 <span class="keyword">ON</span> users (city);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx2 <span class="keyword">ON</span> users (age);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx3 <span class="keyword">ON</span> users (gender);</span><br><span class="line">... （<span class="number">17</span> 个其他索引）</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> city <span class="operator">=</span> <span class="string">&#x27;Beijing&#x27;</span>;</span><br><span class="line"><span class="comment">-- 优化器可能选择 idx15 而不是 idx1，导致性能差</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ✓ 好：精心选择必要的索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_city <span class="keyword">ON</span> users (city);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_city_age <span class="keyword">ON</span> users (city, age);</span><br><span class="line"><span class="comment">-- 优化器更容易做出正确选择</span></span><br></pre></td></tr></table></figure>

<h4 id="5-索引失效的坑"><a href="#5-索引失效的坑" class="headerlink" title="5. 索引失效的坑"></a>5. 索引失效的坑</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 有索引但不被使用（浪费空间和维护成本）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ❌ 索引失效：函数处理</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> <span class="keyword">YEAR</span>(created_at) <span class="operator">=</span> <span class="number">2024</span>;</span><br><span class="line"><span class="comment">-- 即使 created_at 有索引也用不上</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ❌ 索引失效：隐式转换</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_id <span class="keyword">ON</span> users (id);  <span class="comment">-- INT 类型</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="string">&#x27;123&#x27;</span>;  <span class="comment">-- 字符串</span></span><br><span class="line"><span class="comment">-- 字符串转 INT，索引失效</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ❌ 索引失效：模糊查询</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_name <span class="keyword">ON</span> users (name);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;%john%&#x27;</span>;</span><br><span class="line"><span class="comment">-- % 在最前面，索引失效</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ❌ 索引失效：复合索引最左原则</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_city_age <span class="keyword">ON</span> users (city, age);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">25</span>;  <span class="comment">-- 跳过了 city</span></span><br><span class="line"><span class="comment">-- 索引失效</span></span><br></pre></td></tr></table></figure>

<h4 id="索引副作用总结表"><a href="#索引副作用总结表" class="headerlink" title="索引副作用总结表"></a>索引副作用总结表</h4><table>
<thead>
<tr>
<th>副作用</th>
<th>影响</th>
<th>严重程度</th>
</tr>
</thead>
<tbody><tr>
<td>占用磁盘空间</td>
<td>存储成本↑，备份慢</td>
<td>中</td>
</tr>
<tr>
<td>降低写入性能</td>
<td>INSERT&#x2F;UPDATE&#x2F;DELETE 慢</td>
<td>高</td>
</tr>
<tr>
<td>维护成本高</td>
<td>需要定期重建和整理</td>
<td>中</td>
</tr>
<tr>
<td>优化器困惑</td>
<td>可能选择不当索引</td>
<td>低</td>
</tr>
<tr>
<td>容易失效</td>
<td>索引存在但不被使用</td>
<td>高</td>
</tr>
</tbody></table>
<h3 id="5-1-3-创建索引的依据（什么时候建索引）"><a href="#5-1-3-创建索引的依据（什么时候建索引）" class="headerlink" title="5.1.3 创建索引的依据（什么时候建索引）"></a>5.1.3 创建索引的依据（什么时候建索引）</h3><p><img src="/./imgs/image-20251120111505286.png" alt="image-20251120111505286"></p>
<h4 id="建索引的必要条件（都要满足）"><a href="#建索引的必要条件（都要满足）" class="headerlink" title="建索引的必要条件（都要满足）"></a>建索引的必要条件（都要满足）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">条件 1：列被频繁用于查询条件</span><br><span class="line">条件 2：列的区分度高（重复值少）</span><br><span class="line">条件 3：表的数据量足够大</span><br><span class="line">条件 4：不是频繁更新的列</span><br><span class="line">条件 5：查询受益远大于写入成本</span><br></pre></td></tr></table></figure>

<h4 id="详细决策树"><a href="#详细决策树" class="headerlink" title="详细决策树"></a>详细决策树</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">问题 1：这个列多久被用于 WHERE 条件？</span><br><span class="line">  ├─ 几乎不用 → 不建索引</span><br><span class="line">  ├─ 偶尔用（&lt; 10%的查询）→ 考虑不建</span><br><span class="line">  ├─ 经常用（10%-50% 的查询）→ 应该建</span><br><span class="line">  └─ 非常频繁（&gt; 50% 的查询）→ 必须建</span><br><span class="line"></span><br><span class="line">问题 2：这个列有多少重复值？</span><br><span class="line">  ├─ 重复很多（如性别 M/F）→ 区分度差，不建</span><br><span class="line">  ├─ 重复较多（如城市 100 种）→ 区分度一般，可建</span><br><span class="line">  ├─ 重复较少（如用户 ID）→ 区分度好，应建</span><br><span class="line">  └─ 完全不重复（唯一）→ 必须建</span><br><span class="line"></span><br><span class="line">问题 3：表的数据量多大？</span><br><span class="line">  ├─ &lt; 10,000 行 → 全表扫描已足够快，不建</span><br><span class="line">  ├─ 10,000 - 1,000,000 行 → 建索引有益</span><br><span class="line">  └─ &gt; 1,000,000 行 → 必须建索引</span><br><span class="line"></span><br><span class="line">问题 4：这个列更新有多频繁？</span><br><span class="line">  ├─ 频繁更新（&gt; 50%）→ 不建索引</span><br><span class="line">  ├─ 偶尔更新 → 可建</span><br><span class="line">  └─ 几乎不改 → 应建</span><br><span class="line"></span><br><span class="line">问题 5：查询收益是否值得维护成本？</span><br><span class="line">  ├─ 查询快 100 倍，写入慢 2 倍 → 划算，建</span><br><span class="line">  ├─ 查询快 10 倍，写入慢 5 倍 → 考虑建</span><br><span class="line">  └─ 查询快 5 倍，写入慢 8 倍 → 不划算，不建</span><br></pre></td></tr></table></figure>

<h4 id="实践案例分析"><a href="#实践案例分析" class="headerlink" title="实践案例分析"></a>实践案例分析</h4><h5 id="案例-1：电商网站的-orders-表（1000-万行）"><a href="#案例-1：电商网站的-orders-表（1000-万行）" class="headerlink" title="案例 1：电商网站的 orders 表（1000 万行）"></a>案例 1：电商网站的 orders 表（1000 万行）</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 字段分析</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,                    <span class="comment">-- 主键有索引 ✓</span></span><br><span class="line">  user_id <span class="type">INT</span>,                           <span class="comment">-- 几乎每次查询都用 → 建索引</span></span><br><span class="line">  order_no <span class="type">VARCHAR</span>(<span class="number">50</span>),                  <span class="comment">-- 唯一值，经常查询 → 建索引</span></span><br><span class="line">  created_at DATETIME,                   <span class="comment">-- 范围查询很多 → 建索引</span></span><br><span class="line">  updated_at DATETIME,                   <span class="comment">-- 不怎么查询 → 不建</span></span><br><span class="line">  status <span class="type">VARCHAR</span>(<span class="number">20</span>),                    <span class="comment">-- 查询多，但值只有 5 种 → 区分度差，不建</span></span><br><span class="line">  amount <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>),                  <span class="comment">-- 查询多，范围查询 → 建索引</span></span><br><span class="line">  payment_method <span class="type">VARCHAR</span>(<span class="number">20</span>),            <span class="comment">-- 值只有 3 种 → 区分度差，不建</span></span><br><span class="line">  notes TEXT                             <span class="comment">-- 不用于条件查询 → 不建</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正确的索引方案</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_user_id <span class="keyword">ON</span> orders (user_id);                <span class="comment">-- 查询频率高，区分度好</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_order_no <span class="keyword">ON</span> orders (order_no);              <span class="comment">-- 唯一查询</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_created_at <span class="keyword">ON</span> orders (created_at);          <span class="comment">-- 范围查询多</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_user_id_created_at <span class="keyword">ON</span> orders (user_id, created_at);  <span class="comment">-- 复合索引</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ❌ 错误的索引</span></span><br><span class="line"><span class="comment">-- CREATE INDEX idx_status ON orders (status);               -- 值只有 5 种，区分度太差</span></span><br><span class="line"><span class="comment">-- CREATE INDEX idx_payment_method ON orders (payment_method);  -- 值只有 3 种</span></span><br></pre></td></tr></table></figure>

<h5 id="案例-2：用户日志表（100-亿行）"><a href="#案例-2：用户日志表（100-亿行）" class="headerlink" title="案例 2：用户日志表（100 亿行）"></a>案例 2：用户日志表（100 亿行）</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> user_logs (</span><br><span class="line">  id <span class="type">BIGINT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">  user_id <span class="type">INT</span>,                <span class="comment">-- 经常查询，区分度很好 → 建索引</span></span><br><span class="line">  action <span class="type">VARCHAR</span>(<span class="number">50</span>),         <span class="comment">-- 查询多，但只有 20 种值 → 不建</span></span><br><span class="line">  created_at DATETIME,        <span class="comment">-- 按时间范围查询很多 → 建索引</span></span><br><span class="line">  ip_address <span class="type">VARCHAR</span>(<span class="number">50</span>),     <span class="comment">-- 很少查询 → 不建</span></span><br><span class="line">  user_agent TEXT             <span class="comment">-- 不用于查询 → 不建</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正确的索引方案</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_user_id <span class="keyword">ON</span> user_logs (user_id);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_created_at <span class="keyword">ON</span> user_logs (created_at);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_user_id_created_at <span class="keyword">ON</span> user_logs (user_id, created_at);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 注：即使是 100 亿行也不要在 action 建索引</span></span><br><span class="line"><span class="comment">-- 虽然扫描多，但区分度太差（只有 20 种值）</span></span><br><span class="line"><span class="comment">-- 全表扫描和索引扫描性能差不多</span></span><br></pre></td></tr></table></figure>

<h5 id="案例-3：商品表（10-万行）"><a href="#案例-3：商品表（10-万行）" class="headerlink" title="案例 3：商品表（10 万行）"></a>案例 3：商品表（10 万行）</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> products (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">  name <span class="type">VARCHAR</span>(<span class="number">255</span>),          <span class="comment">-- 搜索频率高 → 建全文索引</span></span><br><span class="line">  category_id <span class="type">INT</span>,            <span class="comment">-- 查询频率中等 → 建索引</span></span><br><span class="line">  price <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>),        <span class="comment">-- 范围查询多 → 建索引</span></span><br><span class="line">  inventory <span class="type">INT</span>,              <span class="comment">-- 更新频率高（&gt; 50%）→ 不建索引</span></span><br><span class="line">  created_at DATETIME,        <span class="comment">-- 很少查询 → 不建</span></span><br><span class="line">  description TEXT            <span class="comment">-- 全文搜索 → 建全文索引</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正确的索引方案</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_category_id <span class="keyword">ON</span> products (category_id);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_price <span class="keyword">ON</span> products (price);</span><br><span class="line"><span class="keyword">CREATE</span> FULLTEXT INDEX ft_name <span class="keyword">ON</span> products (name);</span><br><span class="line"><span class="keyword">CREATE</span> FULLTEXT INDEX ft_description <span class="keyword">ON</span> products (description);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ❌ 错误：在 inventory 建索引</span></span><br><span class="line"><span class="comment">-- CREATE INDEX idx_inventory ON products (inventory);</span></span><br><span class="line"><span class="comment">-- 因为 inventory 频繁更新，每次更新都要维护索引</span></span><br></pre></td></tr></table></figure>

<h4 id="索引建立决策速查表"><a href="#索引建立决策速查表" class="headerlink" title="索引建立决策速查表"></a>索引建立决策速查表</h4><table>
<thead>
<tr>
<th>列属性</th>
<th>是否建索引</th>
<th>原因</th>
</tr>
</thead>
<tbody><tr>
<td>主键</td>
<td>✓ 必建</td>
<td>唯一识别，必须快速查询</td>
</tr>
<tr>
<td>外键</td>
<td>✓ 建</td>
<td>用于 JOIN 操作</td>
</tr>
<tr>
<td>WHERE 条件（频繁）</td>
<td>✓ 建</td>
<td>加速查询</td>
</tr>
<tr>
<td>WHERE 条件（少用）</td>
<td>✗ 不建</td>
<td>维护成本大于收益</td>
</tr>
<tr>
<td>ORDER BY&#x2F;GROUP BY</td>
<td>✓ 建</td>
<td>避免排序操作</td>
</tr>
<tr>
<td>唯一列</td>
<td>✓ 建</td>
<td>保证数据一致性</td>
</tr>
<tr>
<td>区分度高</td>
<td>✓ 建</td>
<td>索引效果好</td>
</tr>
<tr>
<td>区分度低（&lt; 10 种值）</td>
<td>✗ 不建</td>
<td>索引效果差</td>
</tr>
<tr>
<td>频繁更新（&gt; 50%）</td>
<td>✗ 不建</td>
<td>写入成本太高</td>
</tr>
<tr>
<td>数据量少（&lt; 10k）</td>
<td>✗ 不建</td>
<td>全表扫描足够快</td>
</tr>
<tr>
<td>数据量大（&gt; 1M）</td>
<td>✓ 建</td>
<td>查询速度差异明显</td>
</tr>
<tr>
<td>TEXT&#x2F;BLOB</td>
<td>✗ 不建</td>
<td>太大，且不宜索引</td>
</tr>
<tr>
<td>NULL 值多</td>
<td>✗ 不建</td>
<td>索引不含 NULL 值</td>
</tr>
</tbody></table>
<h4 id="索引建立的黄金法则"><a href="#索引建立的黄金法则" class="headerlink" title="索引建立的黄金法则"></a>索引建立的黄金法则</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">黄金法则 1：先满足查询需求，再考虑写入成本</span><br><span class="line">├─ 查询是否真的慢？用 EXPLAIN 分析</span><br><span class="line">├─ 慢在哪里？是全表扫描还是排序？</span><br><span class="line">└─ 建索引能解决问题吗？</span><br><span class="line"></span><br><span class="line">黄金法则 2：宁可少建也不多建</span><br><span class="line">├─ 每增加一个索引，写入就慢一点</span><br><span class="line">├─ 维护成本增加</span><br><span class="line">└─ 优化器选择可能变差</span><br><span class="line"></span><br><span class="line">黄金法则 3：优先建复合索引，减少索引个数</span><br><span class="line">├─ 一个复合索引 (a, b, c) 可以替代多个单列索引</span><br><span class="line">├─ 节省空间</span><br><span class="line">└─ 降低维护成本</span><br><span class="line"></span><br><span class="line">黄金法则 4：定期审视索引，删除未使用的</span><br><span class="line">├─ 每季度检查一次</span><br><span class="line">├─ 删除无用索引</span><br><span class="line">└─ 监控索引效果</span><br><span class="line"></span><br><span class="line">黄金法则 5：重写查询比建索引更优先</span><br><span class="line">├─ 能否改进 SQL 逻辑？</span><br><span class="line">├─ 能否用 JOIN 替代子查询？</span><br><span class="line">├─ 能否减少结果集？</span><br><span class="line">└─ 这些方案往往比建索引更有效</span><br></pre></td></tr></table></figure>

<h3 id="5-2-索引的工作原理"><a href="#5-2-索引的工作原理" class="headerlink" title="5.2 索引的工作原理"></a>5.2 索引的工作原理</h3><h4 id="B-树结构"><a href="#B-树结构" class="headerlink" title="B+ 树结构"></a>B+ 树结构</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">全表扫描（无索引）：从第 1 行开始逐行检查</span><br><span class="line">id | name  | email            查询用时</span><br><span class="line">---+-------+---------         --------</span><br><span class="line">1  | john  | john@... ← 检查</span><br><span class="line">2  | jane  | jane@... ← 检查  O(n)</span><br><span class="line">3  | bob   | bob@...  ← 检查  需要检查</span><br><span class="line">...                           所有行</span><br><span class="line"></span><br><span class="line">有索引时：B+ 树快速定位</span><br><span class="line">B+ Tree 索引结构（以 email 为例）：</span><br><span class="line"></span><br><span class="line">          [m-z]</span><br><span class="line">         /     \</span><br><span class="line">    [a-l]     [n-z]</span><br><span class="line">    / | \     / | \</span><br><span class="line">  a-c d-f ...n-p q-z</span><br><span class="line"></span><br><span class="line">查询 &#x27;john@...&#x27; 时：</span><br><span class="line">1. 从根节点 → 选择 [m-z] 分支</span><br><span class="line">2. 从 [m-z] 节点 → 选择 [n-z] 分支  </span><br><span class="line">3. 直接找到 john@... ← 找到</span><br><span class="line"></span><br><span class="line">用时：O(log n)，只需检查 20-30 行</span><br></pre></td></tr></table></figure>

<p><strong>对比：</strong></p>
<ul>
<li>全表扫描 100 万行数据：需要检查 50 万行（平均）</li>
<li>索引查询 100 万行数据：只需检查 20 行</li>
<li>性能提升：25000 倍！</li>
</ul>
<h3 id="5-3-索引的类型"><a href="#5-3-索引的类型" class="headerlink" title="5.3 索引的类型"></a>5.3 索引的类型</h3><h4 id="主键索引（PRIMARY-KEY）"><a href="#主键索引（PRIMARY-KEY）" class="headerlink" title="主键索引（PRIMARY KEY）"></a>主键索引（PRIMARY KEY）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 或</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD</span> <span class="keyword">PRIMARY KEY</span> (id);</span><br></pre></td></tr></table></figure>

<p><strong>特点：</strong> 唯一且不为空，自动创建索引，每表只能一个</p>
<h4 id="唯一索引（UNIQUE）"><a href="#唯一索引（UNIQUE）" class="headerlink" title="唯一索引（UNIQUE）"></a>唯一索引（UNIQUE）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">  email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">UNIQUE</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 或</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> INDEX idx_email (email);</span><br></pre></td></tr></table></figure>

<p><strong>作用：</strong> 不仅加速查询，还保证数据唯一性</p>
<h4 id="普通索引（INDEX）"><a href="#普通索引（INDEX）" class="headerlink" title="普通索引（INDEX）"></a>普通索引（INDEX）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD</span> INDEX idx_username (username);</span><br></pre></td></tr></table></figure>

<p><strong>作用：</strong> 加速查询，对数据没有约束</p>
<h4 id="复合索引（多列索引）"><a href="#复合索引（多列索引）" class="headerlink" title="复合索引（多列索引）"></a>复合索引（多列索引）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD</span> INDEX idx_city_age (city, age);</span><br></pre></td></tr></table></figure>

<p><strong>特点：</strong> 遵循”最左匹配原则”</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 能用到索引的查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> city <span class="operator">=</span> <span class="string">&#x27;Beijing&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> city <span class="operator">=</span> <span class="string">&#x27;Beijing&#x27;</span> <span class="keyword">AND</span> age <span class="operator">=</span> <span class="number">25</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 不能用到索引的查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">25</span>;  <span class="comment">-- 跳过了最左列</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">25</span> <span class="keyword">AND</span> city <span class="operator">=</span> <span class="string">&#x27;Beijing&#x27;</span>;  <span class="comment">-- 顺序不对</span></span><br></pre></td></tr></table></figure>

<h4 id="全文索引（FULLTEXT）"><a href="#全文索引（FULLTEXT）" class="headerlink" title="全文索引（FULLTEXT）"></a>全文索引（FULLTEXT）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> articles <span class="keyword">ADD</span> FULLTEXT INDEX ft_content (content);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用全文索引</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> articles <span class="keyword">WHERE</span> <span class="keyword">MATCH</span>(content) AGAINST(<span class="string">&#x27;mysql&#x27;</span> <span class="keyword">IN</span> <span class="type">BOOLEAN</span> MODE);</span><br></pre></td></tr></table></figure>

<p><strong>作用：</strong> 用于全文搜索，支持模糊匹配，比 LIKE 高效得多</p>
<h4 id="前缀索引"><a href="#前缀索引" class="headerlink" title="前缀索引"></a>前缀索引</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 只对列的前 10 个字符建索引，节省空间</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD</span> INDEX idx_email_prefix (email(<span class="number">10</span>));</span><br></pre></td></tr></table></figure>

<p><strong>作用：</strong> 减少索引占用的磁盘空间，适合长字符串列</p>
<h3 id="5-4-查看和删除索引"><a href="#5-4-查看和删除索引" class="headerlink" title="5.4 查看和删除索引"></a>5.4 查看和删除索引</h3><h4 id="查看索引"><a href="#查看索引" class="headerlink" title="查看索引"></a>查看索引</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看表的所有索引</span></span><br><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> users;</span><br><span class="line"><span class="keyword">SHOW</span> KEYS <span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 输出包含的信息</span></span><br><span class="line"><span class="comment">-- Seq_in_index：列在索引中的位置（复合索引时有用）</span></span><br><span class="line"><span class="comment">-- Non_unique：0 表示唯一，1 表示可重复</span></span><br><span class="line"><span class="comment">-- Cardinality：索引值的唯一数量，值高说明索引效果好</span></span><br></pre></td></tr></table></figure>

<h4 id="删除索引-1"><a href="#删除索引-1" class="headerlink" title="删除索引"></a>删除索引</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除普通索引</span></span><br><span class="line"><span class="keyword">DROP</span> INDEX idx_username <span class="keyword">ON</span> users;</span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">DROP</span> INDEX idx_username;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除主键索引</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">DROP</span> <span class="keyword">PRIMARY KEY</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除唯一索引</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">DROP</span> INDEX idx_email;</span><br></pre></td></tr></table></figure>

<h3 id="5-5-索引的性能分析"><a href="#5-5-索引的性能分析" class="headerlink" title="5.5 索引的性能分析"></a>5.5 索引的性能分析</h3><h4 id="EXPLAIN-查询分析"><a href="#EXPLAIN-查询分析" class="headerlink" title="EXPLAIN 查询分析"></a>EXPLAIN 查询分析</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 分析查询是否使用了索引</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> email <span class="operator">=</span> <span class="string">&#x27;test@example.com&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 输出说明：</span></span><br><span class="line"><span class="comment">-- type: ALL（全表扫描，最差）→ range（范围扫描）→ ref（非唯一匹配）→ eq_ref（唯一匹配）→ const（常数）</span></span><br><span class="line"><span class="comment">-- key: 使用的索引名（NULL 表示未使用索引）</span></span><br><span class="line"><span class="comment">-- rows: 扫描的行数（越少越好）</span></span><br><span class="line"><span class="comment">-- Extra: 额外信息（Using where 表示需要过滤，Using index 表示只读索引无需回表）</span></span><br></pre></td></tr></table></figure>

<h4 id="常见的查询优化案例"><a href="#常见的查询优化案例" class="headerlink" title="常见的查询优化案例"></a>常见的查询优化案例</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ❌ 坏：函数导致索引失效</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> <span class="keyword">YEAR</span>(created_at) <span class="operator">=</span> <span class="number">2024</span>;</span><br><span class="line"><span class="comment">-- ✓ 好：用范围查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> created_at <span class="operator">&gt;=</span> <span class="string">&#x27;2024-01-01&#x27;</span> <span class="keyword">AND</span> created_at <span class="operator">&lt;</span> <span class="string">&#x27;2025-01-01&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ❌ 坏：隐式转换导致索引失效</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="string">&#x27;123&#x27;</span>;  <span class="comment">-- id 是 INT，字符串会转换</span></span><br><span class="line"><span class="comment">-- ✓ 好：类型匹配</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">123</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ❌ 坏：模糊查询的前缀匹配</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="keyword">LIKE</span> <span class="string">&#x27;%john%&#x27;</span>;</span><br><span class="line"><span class="comment">-- ✓ 好：用前缀匹配（如果有前缀索引）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="keyword">LIKE</span> <span class="string">&#x27;john%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ❌ 坏：OR 导致索引失效</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">OR</span> name <span class="operator">=</span> <span class="string">&#x27;john&#x27;</span>;</span><br><span class="line"><span class="comment">-- ✓ 好：用 UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;john&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ❌ 坏：复合索引未遵循最左匹配</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx <span class="keyword">ON</span> users (city, age);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">25</span>;  <span class="comment">-- 跳过了 city</span></span><br><span class="line"><span class="comment">-- ✓ 好：遵循最左匹配</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> city <span class="operator">=</span> <span class="string">&#x27;Beijing&#x27;</span> <span class="keyword">AND</span> age <span class="operator">=</span> <span class="number">25</span>;</span><br></pre></td></tr></table></figure>

<h3 id="5-6-索引的维护"><a href="#5-6-索引的维护" class="headerlink" title="5.6 索引的维护"></a>5.6 索引的维护</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 分析表（更新统计信息）</span></span><br><span class="line">ANALYZE <span class="keyword">TABLE</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 检查表的数据是否损坏</span></span><br><span class="line"><span class="keyword">CHECK</span> <span class="keyword">TABLE</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 优化表（整理碎片，可能需要表锁）</span></span><br><span class="line">OPTIMIZE <span class="keyword">TABLE</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 重建索引（删除后重新创建，比较耗时）</span></span><br><span class="line">REPAIR <span class="keyword">TABLE</span> users;</span><br></pre></td></tr></table></figure>

<p><strong>为什么要维护索引：</strong></p>
<ul>
<li>随着删除操作，索引可能产生碎片</li>
<li>统计信息过时，优化器选择不当</li>
<li>定期维护保持数据库性能</li>
</ul>
<h3 id="5-7-什么情况下需要索引"><a href="#5-7-什么情况下需要索引" class="headerlink" title="5.7 什么情况下需要索引"></a>5.7 什么情况下需要索引</h3><p>✓ <strong>应该建索引：</strong></p>
<ul>
<li>WHERE 条件中频繁出现的列</li>
<li>JOIN 条件中的列</li>
<li>ORDER BY 和 GROUP BY 的列</li>
<li>选择度高的列（重复值少）</li>
</ul>
<p>✗ <strong>不应该建索引：</strong></p>
<ul>
<li>更新频繁的列</li>
<li>区分度低的列（如性别只有 M&#x2F;F）</li>
<li>数据量少的表</li>
<li>包含大量 NULL 的列</li>
</ul>
<hr>
<h2 id="六、数据类型详解"><a href="#六、数据类型详解" class="headerlink" title="六、数据类型详解"></a>六、数据类型详解</h2><h3 id="6-1-整数类型"><a href="#6-1-整数类型" class="headerlink" title="6.1 整数类型"></a>6.1 整数类型</h3><table>
<thead>
<tr>
<th>类型</th>
<th>字节数</th>
<th>范围</th>
<th>场景</th>
</tr>
</thead>
<tbody><tr>
<td>TINYINT</td>
<td>1</td>
<td>-128 ~ 127</td>
<td>布尔值、小范围整数</td>
</tr>
<tr>
<td>SMALLINT</td>
<td>2</td>
<td>-32768 ~ 32767</td>
<td>ID、计数器</td>
</tr>
<tr>
<td>INT</td>
<td>4</td>
<td>-2B ~ 2B</td>
<td>常用主键、用户ID</td>
</tr>
<tr>
<td>BIGINT</td>
<td>8</td>
<td>-9222B ~ 9222B</td>
<td>大数据、时间戳</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 无符号整数（只有正数，范围翻倍）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> products (</span><br><span class="line">  id <span class="type">INT</span> UNSIGNED <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,  <span class="comment">-- 0 ~ 4B</span></span><br><span class="line">  quantity TINYINT UNSIGNED <span class="keyword">DEFAULT</span> <span class="number">0</span>           <span class="comment">-- 0 ~ 255</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>选择建议：</strong> 够用就好，不要盲目用 BIGINT，浪费空间</p>
<h3 id="6-2-浮点数类型"><a href="#6-2-浮点数类型" class="headerlink" title="6.2 浮点数类型"></a>6.2 浮点数类型</h3><table>
<thead>
<tr>
<th>类型</th>
<th>精度</th>
<th>场景</th>
</tr>
</thead>
<tbody><tr>
<td>FLOAT</td>
<td>单精度</td>
<td>不需要精确的浮点运算</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>双精度</td>
<td>需要较高精度</td>
</tr>
<tr>
<td>DECIMAL(m,n)</td>
<td>精确小数</td>
<td>金融数据、必须精确</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 金融系统必须用 DECIMAL</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">  <span class="comment">-- DECIMAL(10,2) 表示共10位数字，2位小数</span></span><br><span class="line">  amount <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">NOT NULL</span>  <span class="comment">-- 最大 99999999.99</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 不推荐（浮点数精度问题）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">  amount <span class="type">FLOAT</span>  <span class="comment">-- 可能导致 9.99 + 0.01 != 10</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>为什么 DECIMAL 重要：</strong> 浮点数在计算机中无法精确表示，DECIMAL 是精确的</p>
<h3 id="6-3-字符串类型"><a href="#6-3-字符串类型" class="headerlink" title="6.3 字符串类型"></a>6.3 字符串类型</h3><table>
<thead>
<tr>
<th>类型</th>
<th>特点</th>
<th>场景</th>
</tr>
</thead>
<tbody><tr>
<td>CHAR(n)</td>
<td>定长，不足补空格</td>
<td>固定长度（如性别、国家代码）</td>
</tr>
<tr>
<td>VARCHAR(n)</td>
<td>变长，节省空间</td>
<td>用户名、邮箱、地址</td>
</tr>
<tr>
<td>TEXT</td>
<td>大文本</td>
<td>文章内容、备注</td>
</tr>
<tr>
<td>LONGTEXT</td>
<td>更大文本</td>
<td>日志、文档</td>
</tr>
<tr>
<td>BLOB</td>
<td>二进制数据</td>
<td>图片、文件</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">  username <span class="type">VARCHAR</span>(<span class="number">50</span>),        <span class="comment">-- 变长，最长50字符</span></span><br><span class="line">  description TEXT,            <span class="comment">-- 长文本</span></span><br><span class="line">  avatar <span class="type">BLOB</span>                  <span class="comment">-- 二进制文件</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- VARCHAR 的长度限制</span></span><br><span class="line"><span class="comment">-- MySQL 中一行最多 65535 字节</span></span><br><span class="line"><span class="comment">-- 所以 VARCHAR(65535) 不现实，通常用 VARCHAR(255) 或 VARCHAR(1000)</span></span><br></pre></td></tr></table></figure>

<p><strong>选择建议：</strong></p>
<ul>
<li>尽量用 VARCHAR，节省空间</li>
<li>TEXT&#x2F;BLOB 类型不建议选为索引列或 ORDER BY</li>
<li>字符串长度预估要合理</li>
</ul>
<h3 id="6-4-日期时间类型"><a href="#6-4-日期时间类型" class="headerlink" title="6.4 日期时间类型"></a>6.4 日期时间类型</h3><table>
<thead>
<tr>
<th>类型</th>
<th>格式</th>
<th>范围</th>
<th>场景</th>
</tr>
</thead>
<tbody><tr>
<td>DATE</td>
<td>YYYY-MM-DD</td>
<td>1000-01 ~ 9999-12</td>
<td>只需要日期</td>
</tr>
<tr>
<td>TIME</td>
<td>HH:MM:SS</td>
<td>-838:59:59 ~ 838:59:59</td>
<td>只需要时间</td>
</tr>
<tr>
<td>DATETIME</td>
<td>YYYY-MM-DD HH:MM:SS</td>
<td>1000-01-01 ~ 9999-12-31</td>
<td>日期和时间</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>YYYY-MM-DD HH:MM:SS</td>
<td>1970-01-01 ~ 2038-01-19</td>
<td>记录操作时间</td>
</tr>
<tr>
<td>YEAR</td>
<td>YYYY</td>
<td>1901 ~ 2155</td>
<td>只需要年份</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> logs (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">-- DATETIME：存储时区无关的时间，推荐用于业务时间</span></span><br><span class="line">  created_at DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">-- TIMESTAMP：自动更新，存储的是 UTC 时间</span></span><br><span class="line">  updated_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">-- 时间戳（秒）：用整数表示，紧凑且高效</span></span><br><span class="line">  ts <span class="type">INT</span>  <span class="comment">-- 用 FROM_UNIXTIME() 和 UNIX_TIMESTAMP() 转换</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>DATETIME vs TIMESTAMP：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- TIMESTAMP 自动更新</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> test (</span><br><span class="line">  id <span class="type">INT</span>,</span><br><span class="line">  updated_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入新行</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> test <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="keyword">DEFAULT</span>);</span><br><span class="line"><span class="keyword">SELECT</span> updated_at <span class="keyword">FROM</span> test;  <span class="comment">-- 显示当前时间</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 更新行（不更新 updated_at 字段）</span></span><br><span class="line"><span class="keyword">UPDATE</span> test <span class="keyword">SET</span> id <span class="operator">=</span> <span class="number">2</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">SELECT</span> updated_at <span class="keyword">FROM</span> test;  <span class="comment">-- 自动更新为当前时间</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- DATETIME 不会自动更新</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> test2 (</span><br><span class="line">  id <span class="type">INT</span>,</span><br><span class="line">  created_at DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">UPDATE</span> test2 <span class="keyword">SET</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">SELECT</span> created_at <span class="keyword">FROM</span> test2;  <span class="comment">-- created_at 保持不变</span></span><br></pre></td></tr></table></figure>

<h3 id="6-5-其他类型"><a href="#6-5-其他类型" class="headerlink" title="6.5 其他类型"></a>6.5 其他类型</h3><h4 id="ENUM（枚举）"><a href="#ENUM（枚举）" class="headerlink" title="ENUM（枚举）"></a>ENUM（枚举）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">  status ENUM(<span class="string">&#x27;active&#x27;</span>, <span class="string">&#x27;inactive&#x27;</span>, <span class="string">&#x27;banned&#x27;</span>)  <span class="comment">-- 只能是这三个值之一</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 内部用数字存储（节省空间）</span></span><br><span class="line"><span class="comment">-- &#x27;active&#x27; = 1, &#x27;inactive&#x27; = 2, &#x27;banned&#x27; = 3</span></span><br><span class="line"><span class="keyword">SELECT</span> status <span class="operator">+</span> <span class="number">0</span> <span class="keyword">FROM</span> users;  <span class="comment">-- 返回数字</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 新增枚举值需要修改表结构</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users MODIFY status ENUM(<span class="string">&#x27;active&#x27;</span>, <span class="string">&#x27;inactive&#x27;</span>, <span class="string">&#x27;banned&#x27;</span>, <span class="string">&#x27;suspended&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>优点和缺点：</strong></p>
<ul>
<li>✓ 节省空间（只需 1-2 字节）</li>
<li>✓ 强制数据一致性</li>
<li>✗ 新增值需要修改表结构</li>
<li>✗ 可读性不如用字符串</li>
</ul>
<h4 id="BOOLEAN"><a href="#BOOLEAN" class="headerlink" title="BOOLEAN"></a>BOOLEAN</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> features (</span><br><span class="line">  is_enabled <span class="type">BOOLEAN</span> <span class="keyword">DEFAULT</span> <span class="literal">TRUE</span>  <span class="comment">-- 等同于 TINYINT(1)</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> features <span class="keyword">WHERE</span> is_enabled <span class="operator">=</span> <span class="literal">TRUE</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> features <span class="keyword">WHERE</span> is_enabled <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 同上</span></span><br></pre></td></tr></table></figure>

<h4 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> configs (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">  settings JSON</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入 JSON</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> configs <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;&#123;&quot;theme&quot;: &quot;dark&quot;, &quot;language&quot;: &quot;zh&quot;&#125;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询 JSON</span></span><br><span class="line"><span class="keyword">SELECT</span> JSON_EXTRACT(settings, <span class="string">&#x27;$.theme&#x27;</span>) <span class="keyword">FROM</span> configs;</span><br><span class="line"><span class="keyword">SELECT</span> settings<span class="operator">-</span><span class="operator">&gt;</span><span class="string">&#x27;$.theme&#x27;</span> <span class="keyword">FROM</span> configs;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 更新 JSON</span></span><br><span class="line"><span class="keyword">UPDATE</span> configs <span class="keyword">SET</span> settings <span class="operator">=</span> JSON_SET(settings, <span class="string">&#x27;$.theme&#x27;</span>, <span class="string">&#x27;light&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询 JSON 中的数组</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">JSON_ARRAYAGG</span>(username) <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure>

<p><strong>作用：</strong> 存储灵活的结构化数据，但查询不如关系表高效</p>
<hr>
<h2 id="七、约束详解"><a href="#七、约束详解" class="headerlink" title="七、约束详解"></a>七、约束详解</h2><h3 id="7-1-常见约束类型"><a href="#7-1-常见约束类型" class="headerlink" title="7.1 常见约束类型"></a>7.1 常见约束类型</h3><h4 id="NOT-NULL（非空约束）"><a href="#NOT-NULL（非空约束）" class="headerlink" title="NOT NULL（非空约束）"></a>NOT NULL（非空约束）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">NOT NULL</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  email <span class="type">VARCHAR</span>(<span class="number">100</span>)  <span class="comment">-- 可以为空</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 移除非空约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users MODIFY email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<p><strong>为什么重要：</strong> 防止数据不完整，避免查询逻辑出错</p>
<h4 id="UNIQUE（唯一约束）"><a href="#UNIQUE（唯一约束）" class="headerlink" title="UNIQUE（唯一约束）"></a>UNIQUE（唯一约束）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">  username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">-- 多列唯一约束</span></span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY uk_name_email (first_name, last_name)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 唯一约束允许多个 NULL</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (username) <span class="keyword">VALUES</span> (<span class="keyword">NULL</span>);  <span class="comment">-- ✓ 允许</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (username) <span class="keyword">VALUES</span> (<span class="keyword">NULL</span>);  <span class="comment">-- ✓ 也允许</span></span><br></pre></td></tr></table></figure>

<p><strong>应用场景：</strong> 邮箱、用户名、ID 号等需要唯一的字段</p>
<h4 id="DEFAULT（默认值）"><a href="#DEFAULT（默认值）" class="headerlink" title="DEFAULT（默认值）"></a>DEFAULT（默认值）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> posts (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  title <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  status <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;draft&#x27;</span>,</span><br><span class="line">  created_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  is_published <span class="type">BOOLEAN</span> <span class="keyword">DEFAULT</span> <span class="literal">FALSE</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入时不指定 status，则用默认值</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> posts (title) <span class="keyword">VALUES</span> (<span class="string">&#x27;Hello World&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> posts;  <span class="comment">-- status 为 &#x27;draft&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 显式设置为 NULL（必须有 NOT NULL 约束才能覆盖）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> posts (title, status) <span class="keyword">VALUES</span> (<span class="string">&#x27;Hello&#x27;</span>, <span class="keyword">NULL</span>);  <span class="comment">-- 错误，status NOT NULL</span></span><br></pre></td></tr></table></figure>

<h4 id="CHECK（检查约束）"><a href="#CHECK（检查约束）" class="headerlink" title="CHECK（检查约束）"></a>CHECK（检查约束）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> products (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  name <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">  price <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>),</span><br><span class="line">  </span><br><span class="line">  <span class="comment">-- 价格必须 &gt; 0</span></span><br><span class="line">  <span class="keyword">CHECK</span> (price <span class="operator">&gt;</span> <span class="number">0</span>),</span><br><span class="line">  </span><br><span class="line">  <span class="comment">-- 多条件检查</span></span><br><span class="line">  <span class="keyword">CHECK</span> (stock <span class="operator">&gt;=</span> <span class="number">0</span> <span class="keyword">AND</span> stock <span class="operator">&lt;=</span> <span class="number">10000</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 违反约束的插入会失败</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> products <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;Book&#x27;</span>, <span class="number">-10</span>);  <span class="comment">-- 错误</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> products <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;Book&#x27;</span>, <span class="number">10</span>);   <span class="comment">-- ✓ 成功</span></span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong> 某些 MySQL 版本的 CHECK 约束可能不强制执行，需要在应用层把关</p>
<h4 id="主键约束（PRIMARY-KEY）"><a href="#主键约束（PRIMARY-KEY）" class="headerlink" title="主键约束（PRIMARY KEY）"></a>主键约束（PRIMARY KEY）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">  <span class="comment">-- 单列主键</span></span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  username <span class="type">VARCHAR</span>(<span class="number">50</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 多列主键（复合主键）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> student_courses (</span><br><span class="line">  student_id <span class="type">INT</span>,</span><br><span class="line">  course_id <span class="type">INT</span>,</span><br><span class="line">  score <span class="type">INT</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (student_id, course_id)  <span class="comment">-- 联合主键</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 复合主键的作用：确保学生-课程组合唯一</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> student_courses <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">1</span>, <span class="number">100</span>);  <span class="comment">-- ✓</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> student_courses <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">1</span>, <span class="number">95</span>);   <span class="comment">-- ❌ 违反主键约束</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> student_courses <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">2</span>, <span class="number">100</span>);  <span class="comment">-- ✓ 允许</span></span><br></pre></td></tr></table></figure>

<h4 id="外键约束（FOREIGN-KEY）"><a href="#外键约束（FOREIGN-KEY）" class="headerlink" title="外键约束（FOREIGN KEY）"></a>外键约束（FOREIGN KEY）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 部门表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> departments (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 员工表（通过外键关联部门表）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  dept_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">-- 定义外键约束</span></span><br><span class="line">  <span class="keyword">FOREIGN KEY</span> (dept_id) <span class="keyword">REFERENCES</span> departments(id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 错误：dept_id 不存在于 departments 表中</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;John&#x27;</span>, <span class="number">999</span>);  <span class="comment">-- ❌ 外键约束失败</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正确：先插入部门</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> departments <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;Engineering&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> employees <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;John&#x27;</span>, <span class="number">1</span>);    <span class="comment">-- ✓ 成功</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 外键的级联操作</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">  dept_id <span class="type">INT</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">FOREIGN KEY</span> (dept_id) <span class="keyword">REFERENCES</span> departments(id)</span><br><span class="line">    <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE        <span class="comment">-- 删除部门时，该部门的员工也被删除</span></span><br><span class="line">    <span class="keyword">ON</span> <span class="keyword">UPDATE</span> CASCADE        <span class="comment">-- 更新部门 ID 时，员工的 dept_id 也更新</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 或使用 RESTRICT（默认）：禁止删除有员工的部门</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">  dept_id <span class="type">INT</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">FOREIGN KEY</span> (dept_id) <span class="keyword">REFERENCES</span> departments(id)</span><br><span class="line">    <span class="keyword">ON</span> <span class="keyword">DELETE</span> RESTRICT       <span class="comment">-- 禁止删除</span></span><br><span class="line">    <span class="keyword">ON</span> <span class="keyword">UPDATE</span> RESTRICT</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- SET NULL：删除时设为 NULL</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">  dept_id <span class="type">INT</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">FOREIGN KEY</span> (dept_id) <span class="keyword">REFERENCES</span> departments(id)</span><br><span class="line">    <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">SET</span> <span class="keyword">NULL</span>       <span class="comment">-- 删除部门时，员工的 dept_id 设为 NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>外键的级联操作对比：</strong></p>
<table>
<thead>
<tr>
<th>操作</th>
<th>说明</th>
<th>场景</th>
</tr>
</thead>
<tbody><tr>
<td>CASCADE</td>
<td>级联删除&#x2F;更新</td>
<td>删除部门时同时删除员工</td>
</tr>
<tr>
<td>RESTRICT</td>
<td>拒绝操作</td>
<td>不允许删除有订单的用户</td>
</tr>
<tr>
<td>SET NULL</td>
<td>设为空</td>
<td>删除部门时员工保留但部门 ID 为空</td>
</tr>
<tr>
<td>NO ACTION</td>
<td>同 RESTRICT</td>
<td>拒绝操作</td>
</tr>
</tbody></table>
<p><strong>为什么要用外键：</strong> 维护数据一致性，防止孤立数据</p>
<hr>
<h2 id="八、事务详解"><a href="#八、事务详解" class="headerlink" title="八、事务详解"></a>八、事务详解</h2><h3 id="8-1-什么是事务"><a href="#8-1-什么是事务" class="headerlink" title="8.1 什么是事务"></a>8.1 什么是事务</h3><p>事务是一组 SQL 语句的集合，这些语句要么全部执行成功，要么全部回滚失败。事务保证数据的一致性和完整性。</p>
<h3 id="8-2-事务的-ACID-特性"><a href="#8-2-事务的-ACID-特性" class="headerlink" title="8.2 事务的 ACID 特性"></a>8.2 事务的 ACID 特性</h3><table>
<thead>
<tr>
<th>特性</th>
<th>说明</th>
<th>例子</th>
</tr>
</thead>
<tbody><tr>
<td><strong>原子性（Atomicity）</strong></td>
<td>要么全部执行，要么全部不执行</td>
<td>转账：A 减少 100 且 B 增加 100，不能只减不增</td>
</tr>
<tr>
<td><strong>一致性（Consistency）</strong></td>
<td>从一个一致状态到另一个一致状态</td>
<td>转账前后，总金额不变</td>
</tr>
<tr>
<td><strong>隔离性（Isolation）</strong></td>
<td>事务之间不互相干扰</td>
<td>并发转账时，两个事务看不到彼此的中间状态</td>
</tr>
<tr>
<td><strong>持久性（Durability）</strong></td>
<td>提交后数据永久保存</td>
<td>即使宕机也不会丢失</td>
</tr>
</tbody></table>
<h3 id="8-3-事务的基本操作"><a href="#8-3-事务的基本操作" class="headerlink" title="8.3 事务的基本操作"></a>8.3 事务的基本操作</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 开启事务</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="comment">-- 或</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行 SQL 语句</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果都成功，提交事务</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果出错，回滚事务</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br></pre></td></tr></table></figure>

<h4 id="实际例子：银行转账"><a href="#实际例子：银行转账" class="headerlink" title="实际例子：银行转账"></a>实际例子：银行转账</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 从账户 A 扣 100 元</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 检查是否成功</span></span><br><span class="line">IF ROW_COUNT() <span class="operator">=</span> <span class="number">0</span> <span class="keyword">THEN</span></span><br><span class="line">  <span class="keyword">ROLLBACK</span>;</span><br><span class="line"><span class="keyword">END</span> IF;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 向账户 B 加 100 元</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 都成功就提交</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果中间任何步骤失败，整个事务回滚</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br></pre></td></tr></table></figure>

<h3 id="8-4-自动提交控制"><a href="#8-4-自动提交控制" class="headerlink" title="8.4 自动提交控制"></a>8.4 自动提交控制</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看自动提交状态</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@autocommit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关闭自动提交（每条 SQL 后需要手动 COMMIT）</span></span><br><span class="line"><span class="keyword">SET</span> AUTOCOMMIT <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 开启自动提交（默认，每条 SQL 立即生效）</span></span><br><span class="line"><span class="keyword">SET</span> AUTOCOMMIT <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 当前会话有效</span></span><br><span class="line"><span class="comment">-- 只对当前连接有效，其他连接不影响</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改全局配置</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> AUTOCOMMIT <span class="operator">=</span> <span class="number">0</span>;  <span class="comment">-- 影响后续所有新连接</span></span><br></pre></td></tr></table></figure>

<h3 id="8-5-事务的隔离级别"><a href="#8-5-事务的隔离级别" class="headerlink" title="8.5 事务的隔离级别"></a>8.5 事务的隔离级别</h3><p>并发执行事务时会产生的问题：</p>
<table>
<thead>
<tr>
<th>问题</th>
<th>说明</th>
<th>解决</th>
</tr>
</thead>
<tbody><tr>
<td><strong>脏读（Dirty Read）</strong></td>
<td>读到未提交的数据</td>
<td>提高隔离级别</td>
</tr>
<tr>
<td><strong>不可重复读（Non-repeatable Read）</strong></td>
<td>同一事务中多次读到不同值</td>
<td>提高隔离级别</td>
</tr>
<tr>
<td><strong>幻读（Phantom Read）</strong></td>
<td>同一查询返回的行数不同</td>
<td>提高隔离级别</td>
</tr>
</tbody></table>
<h4 id="四种隔离级别"><a href="#四种隔离级别" class="headerlink" title="四种隔离级别"></a>四种隔离级别</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看当前隔离级别</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@transaction_isolation</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置隔离级别（仅当前会话）</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;</span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置全局隔离级别</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</span><br></pre></td></tr></table></figure>

<p><strong>四种级别对比：</strong></p>
<table>
<thead>
<tr>
<th>级别</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
<th>性能</th>
</tr>
</thead>
<tbody><tr>
<td>READ UNCOMMITTED</td>
<td>✓ 有</td>
<td>✓ 有</td>
<td>✓ 有</td>
<td>最快</td>
</tr>
<tr>
<td>READ COMMITTED</td>
<td>✗ 无</td>
<td>✓ 有</td>
<td>✓ 有</td>
<td>中</td>
</tr>
<tr>
<td>REPEATABLE READ</td>
<td>✗ 无</td>
<td>✗ 无</td>
<td>✓ 有</td>
<td>中</td>
</tr>
<tr>
<td>SERIALIZABLE</td>
<td>✗ 无</td>
<td>✗ 无</td>
<td>✗ 无</td>
<td>最慢</td>
</tr>
</tbody></table>
<p><strong>MySQL 默认隔离级别：</strong> REPEATABLE READ</p>
<h3 id="8-6-保存点（Savepoint）"><a href="#8-6-保存点（Savepoint）" class="headerlink" title="8.6 保存点（Savepoint）"></a>8.6 保存点（Savepoint）</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> accounts <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;Alice&#x27;</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建保存点</span></span><br><span class="line"><span class="keyword">SAVEPOINT</span> sp1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> accounts <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;Bob&#x27;</span>, <span class="number">500</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果出错，可以只回滚到 sp1</span></span><br><span class="line"><span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> <span class="keyword">SAVEPOINT</span> sp1;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 继续其他操作</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> accounts <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="string">&#x27;Charlie&#x27;</span>, <span class="number">300</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 最终提交</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<p><strong>作用：</strong> 在事务中实现部分回滚，增加事务灵活性</p>
<hr>
<h2 id="九、视图详解"><a href="#九、视图详解" class="headerlink" title="九、视图详解"></a>九、视图详解</h2><h3 id="9-1-什么是视图"><a href="#9-1-什么是视图" class="headerlink" title="9.1 什么是视图"></a>9.1 什么是视图</h3><p>视图是一个虚拟表，是一条 SELECT 查询语句存储的结果集。用户查询视图就像查询真实表一样，但视图本身不存储数据。</p>
<h3 id="9-2-创建和使用视图"><a href="#9-2-创建和使用视图" class="headerlink" title="9.2 创建和使用视图"></a>9.2 创建和使用视图</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建视图</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> active_users <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> id, username, email </span><br><span class="line"><span class="keyword">FROM</span> users </span><br><span class="line"><span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="string">&#x27;active&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询视图（就像查询表一样）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> active_users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建复杂视图（多表 JOIN）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> user_orders <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  u.id, </span><br><span class="line">  u.username, </span><br><span class="line">  <span class="built_in">COUNT</span>(o.id) <span class="keyword">as</span> order_count,</span><br><span class="line">  <span class="built_in">SUM</span>(o.amount) <span class="keyword">as</span> total_amount</span><br><span class="line"><span class="keyword">FROM</span> users u</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> orders o <span class="keyword">ON</span> u.id <span class="operator">=</span> o.user_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> u.id, u.username;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> user_orders <span class="keyword">WHERE</span> total_amount <span class="operator">&gt;</span> <span class="number">1000</span>;</span><br></pre></td></tr></table></figure>

<h3 id="9-3-修改和删除视图"><a href="#9-3-修改和删除视图" class="headerlink" title="9.3 修改和删除视图"></a>9.3 修改和删除视图</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 修改视图（重新定义）</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">VIEW</span> active_users <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> id, username, email, created_at</span><br><span class="line"><span class="keyword">FROM</span> users </span><br><span class="line"><span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="string">&#x27;active&#x27;</span> <span class="keyword">AND</span> created_at <span class="operator">&gt;</span> <span class="string">&#x27;2024-01-01&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除视图</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> active_users;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> IF <span class="keyword">EXISTS</span> active_users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除多个视图</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> view1, view2, view3;</span><br></pre></td></tr></table></figure>

<h3 id="9-4-视图的作用"><a href="#9-4-视图的作用" class="headerlink" title="9.4 视图的作用"></a>9.4 视图的作用</h3><p>✓ <strong>优点：</strong></p>
<ul>
<li><strong>简化查询</strong>：复杂的 JOIN 通过视图简化</li>
<li><strong>数据安全</strong>：只暴露需要的列，隐藏敏感数据</li>
<li><strong>逻辑一致</strong>：多处使用同样逻辑通过视图保持一致</li>
<li><strong>独立变更</strong>：底层表结构改变，通过修改视图适配</li>
</ul>
<p>✗ <strong>缺点：</strong></p>
<ul>
<li><strong>性能</strong>：每次查询都需要执行定义的 SELECT，无法缓存</li>
<li><strong>维护复杂</strong>：过多视图导致维护困难</li>
</ul>
<h3 id="9-5-可更新视图"><a href="#9-5-可更新视图" class="headerlink" title="9.5 可更新视图"></a>9.5 可更新视图</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 简单视图可以通过 INSERT/UPDATE/DELETE</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> simple_view <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> id, username, email <span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 可以更新（会更新底层 users 表）</span></span><br><span class="line"><span class="keyword">UPDATE</span> simple_view <span class="keyword">SET</span> email <span class="operator">=</span> <span class="string">&#x27;new@example.com&#x27;</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 复杂视图（含 GROUP BY、JOIN、聚合函数）不可更新</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> complex_view <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> city, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> count <span class="keyword">FROM</span> users <span class="keyword">GROUP</span> <span class="keyword">BY</span> city;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 不能更新</span></span><br><span class="line"><span class="keyword">UPDATE</span> complex_view <span class="keyword">SET</span> count <span class="operator">=</span> <span class="number">10</span> <span class="keyword">WHERE</span> city <span class="operator">=</span> <span class="string">&#x27;Beijing&#x27;</span>;  <span class="comment">-- ❌ 错误</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="十、性能优化建议"><a href="#十、性能优化建议" class="headerlink" title="十、性能优化建议"></a>十、性能优化建议</h2><h3 id="10-1-查询优化"><a href="#10-1-查询优化" class="headerlink" title="10.1 查询优化"></a>10.1 查询优化</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ❌ 不好：扫描整个表</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ✓ 好：只查询需要的列</span></span><br><span class="line"><span class="keyword">SELECT</span> id, username, email <span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ❌ 不好：LIKE &#x27;%xxx%&#x27; 无法使用索引</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="keyword">LIKE</span> <span class="string">&#x27;%john%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ✓ 好：用前缀匹配</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="keyword">LIKE</span> <span class="string">&#x27;john%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ❌ 不好：OR 导致索引失效</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">OR</span> username <span class="operator">=</span> <span class="string">&#x27;john&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ✓ 好：用 UNION 替代</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;john&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ❌ 不好：在索引列使用函数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> <span class="keyword">YEAR</span>(created_at) <span class="operator">=</span> <span class="number">2024</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ✓ 好：用范围条件</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> created_at <span class="operator">&gt;=</span> <span class="string">&#x27;2024-01-01&#x27;</span> <span class="keyword">AND</span> created_at <span class="operator">&lt;</span> <span class="string">&#x27;2025-01-01&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ❌ 不好：避免 SELECT *，会阻止索引下推</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ✓ 好：指定列</span></span><br><span class="line"><span class="keyword">SELECT</span> id, name, age <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">20</span>;</span><br></pre></td></tr></table></figure>

<h3 id="10-2-索引优化"><a href="#10-2-索引优化" class="headerlink" title="10.2 索引优化"></a>10.2 索引优化</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ✓ 为频繁查询的列建索引</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD</span> INDEX idx_email (email);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ✓ 为 JOIN 条件建索引</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> orders <span class="keyword">ADD</span> INDEX idx_user_id (user_id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ✓ 为排序列建索引</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD</span> INDEX idx_created_at (created_at);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ❌ 不要为区分度低的列建索引（如性别）</span></span><br><span class="line"><span class="comment">-- ❌ 不要为频繁更新的列建索引</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ✓ 使用复合索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_city_age <span class="keyword">ON</span> users (city, age);</span><br><span class="line"><span class="comment">-- 可以用于 WHERE city = &#x27;Beijing&#x27;</span></span><br><span class="line"><span class="comment">-- 可以用于 WHERE city = &#x27;Beijing&#x27; AND age = 25</span></span><br><span class="line"><span class="comment">-- 不能用于 WHERE age = 25（跳过了最左列）</span></span><br></pre></td></tr></table></figure>

<h3 id="10-3-批量操作优化"><a href="#10-3-批量操作优化" class="headerlink" title="10.3 批量操作优化"></a>10.3 批量操作优化</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ❌ 不好：逐行插入</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;john&#x27;</span>, <span class="string">&#x27;john@example.com&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> users <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;jane&#x27;</span>, <span class="string">&#x27;jane@example.com&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> users <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="string">&#x27;bob&#x27;</span>, <span class="string">&#x27;bob@example.com&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ✓ 好：批量插入</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users <span class="keyword">VALUES</span> </span><br><span class="line">  (<span class="number">1</span>, <span class="string">&#x27;john&#x27;</span>, <span class="string">&#x27;john@example.com&#x27;</span>),</span><br><span class="line">  (<span class="number">2</span>, <span class="string">&#x27;jane&#x27;</span>, <span class="string">&#x27;jane@example.com&#x27;</span>),</span><br><span class="line">  (<span class="number">3</span>, <span class="string">&#x27;bob&#x27;</span>, <span class="string">&#x27;bob@example.com&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ✓ 更好：大量数据插入，禁用索引再启用</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users DISABLE KEYS;</span><br><span class="line"><span class="keyword">INSERT INTO</span> users <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> temp_users;</span><br><span class="line"><span class="keyword">ALTER TABLE</span> users ENABLE KEYS;</span><br></pre></td></tr></table></figure>

<h3 id="10-4-分页优化"><a href="#10-4-分页优化" class="headerlink" title="10.4 分页优化"></a>10.4 分页优化</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ❌ 不好：大 OFFSET</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users LIMIT <span class="number">10000</span>, <span class="number">10</span>;  <span class="comment">-- 需要跳过 10000 条</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ✓ 好：用主键范围</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">&gt;</span> last_id LIMIT <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ✓ 好：保存上一页的最后 ID</span></span><br><span class="line"><span class="comment">-- 假设上一页最后一条 ID 是 100</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">100</span> LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<h3 id="10-5-连接优化"><a href="#10-5-连接优化" class="headerlink" title="10.5 连接优化"></a>10.5 连接优化</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ❌ 不好：子查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="keyword">IN</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> user_id <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> amount <span class="operator">&gt;</span> <span class="number">1000</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ✓ 好：用 JOIN</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> u.<span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> users u</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> orders o <span class="keyword">ON</span> u.id <span class="operator">=</span> o.user_id</span><br><span class="line"><span class="keyword">WHERE</span> o.amount <span class="operator">&gt;</span> <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ✓ 好：确保 JOIN 列有索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_user_id <span class="keyword">ON</span> orders (user_id);</span><br></pre></td></tr></table></figure>

<h3 id="10-6-监控和分析"><a href="#10-6-监控和分析" class="headerlink" title="10.6 监控和分析"></a>10.6 监控和分析</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看慢查询日志</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;slow_query_log&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> slow_query_log <span class="operator">=</span> <span class="string">&#x27;ON&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> long_query_time <span class="operator">=</span> <span class="number">2</span>;  <span class="comment">-- 超过 2 秒的查询记录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看当前执行的 SQL</span></span><br><span class="line"><span class="keyword">SHOW</span> PROCESSLIST;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看表的统计信息</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLE</span> STATUS <span class="keyword">FROM</span> db_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 分析表，更新统计信息</span></span><br><span class="line">ANALYZE <span class="keyword">TABLE</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看查询执行计划</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> email <span class="operator">=</span> <span class="string">&#x27;test@example.com&#x27;</span>\G</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="十一、备份和恢复"><a href="#十一、备份和恢复" class="headerlink" title="十一、备份和恢复"></a>十一、备份和恢复</h2><h3 id="11-1-为什么需要备份"><a href="#11-1-为什么需要备份" class="headerlink" title="11.1 为什么需要备份"></a>11.1 为什么需要备份</h3><ul>
<li>数据丢失防护：硬件故障、人为误操作</li>
<li>灾难恢复：快速恢复到故障前的状态</li>
<li>审计追踪：保留历史数据</li>
</ul>
<h3 id="11-2-使用-mysqldump-备份"><a href="#11-2-使用-mysqldump-备份" class="headerlink" title="11.2 使用 mysqldump 备份"></a>11.2 使用 mysqldump 备份</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 备份单个数据库</span></span><br><span class="line">mysqldump -u root -p db_name &gt; backup.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份多个数据库</span></span><br><span class="line">mysqldump -u root -p --databases db1 db2 &gt; backup.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份所有数据库</span></span><br><span class="line">mysqldump -u root -p --all-databases &gt; backup.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份指定表</span></span><br><span class="line">mysqldump -u root -p db_name table1 table2 &gt; backup.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只备份表结构，不备份数据</span></span><br><span class="line">mysqldump -u root -p --no-data db_name &gt; schema.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只备份数据，不备份表结构</span></span><br><span class="line">mysqldump -u root -p --no-create-info db_name &gt; data.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 压缩备份</span></span><br><span class="line">mysqldump -u root -p db_name | gzip &gt; backup.sql.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示备份的进度</span></span><br><span class="line">mysqldump -u root -p db_name --verbose &gt; backup.sql</span><br></pre></td></tr></table></figure>

<h3 id="11-3-恢复数据"><a href="#11-3-恢复数据" class="headerlink" title="11.3 恢复数据"></a>11.3 恢复数据</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 恢复单个数据库</span></span><br><span class="line">mysql -u root -p db_name &lt; backup.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复所有数据库</span></span><br><span class="line">mysql -u root -p &lt; backup.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复压缩文件</span></span><br><span class="line">gunzip &lt; backup.sql.gz | mysql -u root -p db_name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复指定表</span></span><br><span class="line">mysql -u root -p db_name &lt; table_backup.sql</span><br></pre></td></tr></table></figure>

<h3 id="11-4-备份策略"><a href="#11-4-备份策略" class="headerlink" title="11.4 备份策略"></a>11.4 备份策略</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">完全备份（周日）</span><br><span class="line">    ↓</span><br><span class="line">增量备份（周一-周六，只备份变更数据）</span><br><span class="line">    ↓</span><br><span class="line">定期验证备份的有效性</span><br><span class="line">    ↓</span><br><span class="line">异地备份（防止机房故障）</span><br></pre></td></tr></table></figure>

<p><strong>建议备份频率：</strong></p>
<ul>
<li>完全备份：每周一次（周日）</li>
<li>增量备份：每天一次</li>
<li>重要业务数据：每小时一次</li>
</ul>
<hr>
<h2 id="十二、常见问题和解决方案"><a href="#十二、常见问题和解决方案" class="headerlink" title="十二、常见问题和解决方案"></a>十二、常见问题和解决方案</h2><h3 id="12-1-并发问题"><a href="#12-1-并发问题" class="headerlink" title="12.1 并发问题"></a>12.1 并发问题</h3><h4 id="问题：脏读、不可重复读、幻读"><a href="#问题：脏读、不可重复读、幻读" class="headerlink" title="问题：脏读、不可重复读、幻读"></a>问题：脏读、不可重复读、幻读</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 解决方案：提高隔离级别</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 或在 SQL 中使用锁</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;  <span class="comment">-- 排他锁</span></span><br><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<h4 id="问题：死锁"><a href="#问题：死锁" class="headerlink" title="问题：死锁"></a>问题：死锁</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">事务 A 锁住表1，等待表2</span><br><span class="line">事务 B 锁住表2，等待表1</span><br><span class="line">→ 相互等待，产生死锁</span><br></pre></td></tr></table></figure>

<p><strong>解决方案：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1. 保持锁定顺序一致</span></span><br><span class="line"><span class="comment">-- 都先锁表1，再锁表2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 减少事务持时间</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> balance <span class="operator">=</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;  <span class="comment">-- 尽快提交</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 降低隔离级别（权衡考虑）</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4. 使用超时设置</span></span><br><span class="line"><span class="keyword">SET</span> innodb_lock_wait_timeout <span class="operator">=</span> <span class="number">50</span>;  <span class="comment">-- 等待 50 秒后超时</span></span><br></pre></td></tr></table></figure>

<h3 id="12-2-性能问题"><a href="#12-2-性能问题" class="headerlink" title="12.2 性能问题"></a>12.2 性能问题</h3><h4 id="问题：查询很慢"><a href="#问题：查询很慢" class="headerlink" title="问题：查询很慢"></a>问题：查询很慢</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1. 分析查询计划</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> email <span class="operator">=</span> <span class="string">&#x27;test@example.com&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 检查是否使用了索引（key 字段是否为 NULL）</span></span><br><span class="line"><span class="comment">-- 如果为 NULL，添加索引</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD</span> INDEX idx_email (email);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 检查 rows 字段（扫描行数是否过多）</span></span><br><span class="line"><span class="comment">-- 优化 WHERE 条件，减少扫描范围</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4. 检查 Extra 字段</span></span><br><span class="line"><span class="comment">-- &quot;Using temporary&quot; 表示使用了临时表（GROUP BY、JOIN 时常见）</span></span><br><span class="line"><span class="comment">-- &quot;Using filesort&quot; 表示使用了文件排序（应该加索引）</span></span><br></pre></td></tr></table></figure>

<h4 id="问题：插入很慢"><a href="#问题：插入很慢" class="headerlink" title="问题：插入很慢"></a>问题：插入很慢</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 原因：为每条数据更新索引</span></span><br><span class="line"><span class="comment">-- 解决：批量操作</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ❌ 不好</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users <span class="keyword">VALUES</span> (...);</span><br><span class="line"><span class="keyword">INSERT INTO</span> users <span class="keyword">VALUES</span> (...);</span><br><span class="line"><span class="keyword">INSERT INTO</span> users <span class="keyword">VALUES</span> (...);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ✓ 好</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users <span class="keyword">VALUES</span> (...), (...), (...);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ✓ 更好</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users DISABLE KEYS;</span><br><span class="line"><span class="keyword">INSERT INTO</span> users <span class="keyword">VALUES</span> (...), (...), (...);</span><br><span class="line"><span class="keyword">ALTER TABLE</span> users ENABLE KEYS;</span><br></pre></td></tr></table></figure>

<h4 id="问题：表很大，查询很慢"><a href="#问题：表很大，查询很慢" class="headerlink" title="问题：表很大，查询很慢"></a>问题：表很大，查询很慢</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 解决方案 1：分区表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">  id <span class="type">INT</span>,</span><br><span class="line">  user_id <span class="type">INT</span>,</span><br><span class="line">  created_at <span class="type">DATE</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (id, created_at)</span><br><span class="line">) <span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="keyword">RANGE</span> (<span class="keyword">YEAR</span>(created_at)) (</span><br><span class="line">  <span class="keyword">PARTITION</span> p_2023 <span class="keyword">VALUES</span> LESS THAN (<span class="number">2024</span>),</span><br><span class="line">  <span class="keyword">PARTITION</span> p_2024 <span class="keyword">VALUES</span> LESS THAN (<span class="number">2025</span>),</span><br><span class="line">  <span class="keyword">PARTITION</span> p_2025 <span class="keyword">VALUES</span> LESS THAN (<span class="number">2026</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 解决方案 2：分库分表（通过应用层实现）</span></span><br><span class="line"><span class="comment">-- 如按 user_id % 10 路由到不同表</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 解决方案 3：归档旧数据</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> created_at <span class="operator">&lt;</span> <span class="string">&#x27;2023-01-01&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="12-3-数据一致性问题"><a href="#12-3-数据一致性问题" class="headerlink" title="12.3 数据一致性问题"></a>12.3 数据一致性问题</h3><h4 id="问题：产生孤立数据（订单的用户被删除）"><a href="#问题：产生孤立数据（订单的用户被删除）" class="headerlink" title="问题：产生孤立数据（订单的用户被删除）"></a>问题：产生孤立数据（订单的用户被删除）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 解决方案：使用外键约束</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  user_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">  <span class="keyword">FOREIGN KEY</span> (user_id) <span class="keyword">REFERENCES</span> users(id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 或使用应用层检查</span></span><br><span class="line"><span class="comment">-- 删除用户前，先删除其订单</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> user_id <span class="operator">=</span> ?;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> ?;</span><br></pre></td></tr></table></figure>

<h4 id="问题：数据不完整（字段为空）"><a href="#问题：数据不完整（字段为空）" class="headerlink" title="问题：数据不完整（字段为空）"></a>问题：数据不完整（字段为空）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 解决方案：使用非空约束</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">NOT NULL</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 定期检查</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> email <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<h3 id="12-4-存储空间问题"><a href="#12-4-存储空间问题" class="headerlink" title="12.4 存储空间问题"></a>12.4 存储空间问题</h3><h4 id="问题：表占用空间太大"><a href="#问题：表占用空间太大" class="headerlink" title="问题：表占用空间太大"></a>问题：表占用空间太大</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1. 分析表占用的空间</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  table_name,</span><br><span class="line">  ROUND(((data_length <span class="operator">+</span> index_length) <span class="operator">/</span> <span class="number">1024</span> <span class="operator">/</span> <span class="number">1024</span>), <span class="number">2</span>) <span class="keyword">as</span> size_mb</span><br><span class="line"><span class="keyword">FROM</span> information_schema.tables</span><br><span class="line"><span class="keyword">WHERE</span> table_schema <span class="operator">=</span> <span class="string">&#x27;db_name&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> size_mb <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 删除不需要的数据</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> logs <span class="keyword">WHERE</span> created_at <span class="operator">&lt;</span> <span class="string">&#x27;2023-01-01&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 归档旧数据到历史表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> logs_archive <span class="keyword">LIKE</span> logs;</span><br><span class="line"><span class="keyword">INSERT INTO</span> logs_archive <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> logs <span class="keyword">WHERE</span> created_at <span class="operator">&lt;</span> <span class="string">&#x27;2023-01-01&#x27;</span>;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> logs <span class="keyword">WHERE</span> created_at <span class="operator">&lt;</span> <span class="string">&#x27;2023-01-01&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4. 重建表，释放空间</span></span><br><span class="line">OPTIMIZE <span class="keyword">TABLE</span> logs;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 5. 删除不必要的索引</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> logs <span class="keyword">DROP</span> INDEX idx_old_index;</span><br></pre></td></tr></table></figure>

<h4 id="问题：某个列占用空间太大"><a href="#问题：某个列占用空间太大" class="headerlink" title="问题：某个列占用空间太大"></a>问题：某个列占用空间太大</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 原因：VARCHAR 定义过大，或 TEXT/BLOB 过多</span></span><br><span class="line"><span class="comment">-- 解决：调整数据类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ❌ 不好</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> articles (</span><br><span class="line">  title <span class="type">VARCHAR</span>(<span class="number">10000</span>),  <span class="comment">-- 太大</span></span><br><span class="line">  content LONGTEXT       <span class="comment">-- 没有必要</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ✓ 好</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> articles (</span><br><span class="line">  title <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  content TEXT</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 或者把大字段拆出来</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> articles (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">  title <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  content_id <span class="type">INT</span>,</span><br><span class="line">  <span class="keyword">FOREIGN KEY</span> (content_id) <span class="keyword">REFERENCES</span> article_contents(id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE TABLE</span> article_contents (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">  content LONGTEXT</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="12-5-乱码问题"><a href="#12-5-乱码问题" class="headerlink" title="12.5 乱码问题"></a>12.5 乱码问题</h3><h4 id="问题：存入和查出的数据乱码"><a href="#问题：存入和查出的数据乱码" class="headerlink" title="问题：存入和查出的数据乱码"></a>问题：存入和查出的数据乱码</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 原因：字符集配置不一致</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 解决方案 1：创建数据库时指定</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE db_name <span class="keyword">DEFAULT</span> <span class="keyword">CHARACTER SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 解决方案 2：创建表时指定</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">  ...</span><br><span class="line">) <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 解决方案 3：修改现有数据库</span></span><br><span class="line"><span class="keyword">ALTER</span> DATABASE db_name <span class="keyword">DEFAULT</span> <span class="keyword">CHARACTER SET</span> utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 解决方案 4：修改现有表</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">CONVERT</span> <span class="keyword">TO</span> <span class="keyword">CHARACTER SET</span> utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 解决方案 5：连接时指定</span></span><br><span class="line">mysql <span class="operator">-</span>u root <span class="operator">-</span>p <span class="comment">--default-character-set=utf8mb4</span></span><br></pre></td></tr></table></figure>

<p><strong>为什么选择 utf8mb4：</strong></p>
<ul>
<li>utf8：只支持 3 字节字符，无法存储 emoji</li>
<li>utf8mb4：支持 4 字节字符，完全兼容 emoji</li>
</ul>
<hr>
<h2 id="十三、高级特性"><a href="#十三、高级特性" class="headerlink" title="十三、高级特性"></a>十三、高级特性</h2><h3 id="13-1-触发器（Trigger）"><a href="#13-1-触发器（Trigger）" class="headerlink" title="13.1 触发器（Trigger）"></a>13.1 触发器（Trigger）</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建触发器：插入新用户时，自动创建相关记录</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> after_user_insert</span><br><span class="line">AFTER <span class="keyword">INSERT</span> <span class="keyword">ON</span> users</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">INSERT INTO</span> user_profiles (user_id) <span class="keyword">VALUES</span> (NEW.id);</span><br><span class="line">  <span class="keyword">INSERT INTO</span> user_settings (user_id) <span class="keyword">VALUES</span> (NEW.id);</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建触发器：删除用户时的级联操作</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> before_user_delete</span><br><span class="line">BEFORE <span class="keyword">DELETE</span> <span class="keyword">ON</span> users</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">DELETE</span> <span class="keyword">FROM</span> user_profiles <span class="keyword">WHERE</span> user_id <span class="operator">=</span> OLD.id;</span><br><span class="line">  <span class="keyword">DELETE</span> <span class="keyword">FROM</span> user_settings <span class="keyword">WHERE</span> user_id <span class="operator">=</span> OLD.id;</span><br><span class="line">  <span class="keyword">DELETE</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> user_id <span class="operator">=</span> OLD.id;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建触发器：修改时自动更新时间戳</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> after_user_update</span><br><span class="line">AFTER <span class="keyword">UPDATE</span> <span class="keyword">ON</span> users</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">UPDATE</span> logs <span class="keyword">SET</span> last_updated <span class="operator">=</span> NOW() </span><br><span class="line">  <span class="keyword">WHERE</span> user_id <span class="operator">=</span> NEW.id;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看所有触发器</span></span><br><span class="line"><span class="keyword">SHOW</span> TRIGGERS;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看特定数据库的触发器</span></span><br><span class="line"><span class="keyword">SHOW</span> TRIGGERS <span class="keyword">FROM</span> db_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除触发器</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> after_user_insert;</span><br></pre></td></tr></table></figure>

<p><strong>触发器的作用：</strong></p>
<ul>
<li>自动维护数据一致性</li>
<li>记录数据变更日志</li>
<li>级联更新相关数据</li>
</ul>
<p><strong>使用触发器的注意：</strong></p>
<ul>
<li>✓ 简单业务逻辑可以用触发器</li>
<li>✗ 复杂逻辑不推荐用触发器，改在应用层处理</li>
<li>✗ 性能问题：触发器增加写入的时间成本</li>
</ul>
<h3 id="13-2-存储过程（Stored-Procedure）"><a href="#13-2-存储过程（Stored-Procedure）" class="headerlink" title="13.2 存储过程（Stored Procedure）"></a>13.2 存储过程（Stored Procedure）</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建简单存储过程</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> get_user_orders(<span class="keyword">IN</span> user_id <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> user_id <span class="operator">=</span> user_id;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 调用存储过程</span></span><br><span class="line"><span class="keyword">CALL</span> get_user_orders(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建带输出参数的存储过程</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> count_user_orders(<span class="keyword">IN</span> user_id <span class="type">INT</span>, <span class="keyword">OUT</span> order_count <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">INTO</span> order_count <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> user_id <span class="operator">=</span> user_id;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 调用并获取输出</span></span><br><span class="line"><span class="keyword">CALL</span> count_user_orders(<span class="number">1</span>, <span class="variable">@count</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@count</span>;  <span class="comment">-- 显示订单数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建复杂存储过程（含条件判断和循环）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> batch_update_status()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">DECLARE</span> done <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="literal">FALSE</span>;</span><br><span class="line">  <span class="keyword">DECLARE</span> user_id <span class="type">INT</span>;</span><br><span class="line">  <span class="keyword">DECLARE</span> cur <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> <span class="keyword">SELECT</span> id <span class="keyword">FROM</span> users;</span><br><span class="line">  <span class="keyword">DECLARE</span> CONTINUE HANDLER <span class="keyword">FOR</span> <span class="keyword">NOT</span> FOUND <span class="keyword">SET</span> done <span class="operator">=</span> <span class="literal">TRUE</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">OPEN</span> cur;</span><br><span class="line">  loop_label: LOOP</span><br><span class="line">    <span class="keyword">FETCH</span> cur <span class="keyword">INTO</span> user_id;</span><br><span class="line">    IF done <span class="keyword">THEN</span></span><br><span class="line">      LEAVE loop_label;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">UPDATE</span> user_profiles <span class="keyword">SET</span> status <span class="operator">=</span> <span class="string">&#x27;updated&#x27;</span> <span class="keyword">WHERE</span> user_id <span class="operator">=</span> user_id;</span><br><span class="line">  <span class="keyword">END</span> LOOP;</span><br><span class="line">  <span class="keyword">CLOSE</span> cur;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看所有存储过程</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">PROCEDURE</span> STATUS;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看存储过程的定义</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> get_user_orders;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除存储过程</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> get_user_orders;</span><br></pre></td></tr></table></figure>

<p><strong>存储过程的作用：</strong></p>
<ul>
<li>减少客户端和数据库的通信次数</li>
<li>实现复杂的数据处理逻辑</li>
<li>提供对数据库的统一访问接口</li>
</ul>
<p><strong>使用建议：</strong></p>
<ul>
<li>✓ 批量数据处理使用存储过程</li>
<li>✗ 不要过度使用，难以维护和测试</li>
</ul>
<hr>
<h2 id="十四、灾难恢复"><a href="#十四、灾难恢复" class="headerlink" title="十四、灾难恢复"></a>十四、灾难恢复</h2><h3 id="14-1-数据恢复场景"><a href="#14-1-数据恢复场景" class="headerlink" title="14.1 数据恢复场景"></a>14.1 数据恢复场景</h3><h4 id="场景-1：误删数据"><a href="#场景-1：误删数据" class="headerlink" title="场景 1：误删数据"></a>场景 1：误删数据</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 如果在事务内，可以立即回滚</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="string">&#x27;inactive&#x27;</span>;</span><br><span class="line"><span class="comment">-- 发现错误</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;  <span class="comment">-- 数据恢复</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果已经提交，需要从备份恢复</span></span><br><span class="line"><span class="comment">-- 1. 停止 MySQL 写入</span></span><br><span class="line"><span class="comment">-- 2. 从备份文件恢复</span></span><br><span class="line"><span class="comment">-- 3. 使用 binlog 恢复到误删前的时间点</span></span><br></pre></td></tr></table></figure>

<h4 id="场景-2：表损坏"><a href="#场景-2：表损坏" class="headerlink" title="场景 2：表损坏"></a>场景 2：表损坏</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 检查表</span></span><br><span class="line"><span class="keyword">CHECK</span> <span class="keyword">TABLE</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修复表</span></span><br><span class="line">REPAIR <span class="keyword">TABLE</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 或者重建表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users_new <span class="keyword">LIKE</span> users;</span><br><span class="line"><span class="keyword">INSERT INTO</span> users_new <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> users;</span><br><span class="line">RENAME <span class="keyword">TABLE</span> users_new <span class="keyword">TO</span> users;</span><br></pre></td></tr></table></figure>

<h4 id="场景-3：硬件故障导致数据库不可用"><a href="#场景-3：硬件故障导致数据库不可用" class="headerlink" title="场景 3：硬件故障导致数据库不可用"></a>场景 3：硬件故障导致数据库不可用</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 准备新的硬件和 MySQL 环境</span><br><span class="line">2. 恢复最近的完全备份</span><br><span class="line">3. 应用增量备份和 binlog</span><br><span class="line">4. 验证数据完整性</span><br><span class="line">5. 切换应用连接</span><br></pre></td></tr></table></figure>

<h3 id="14-2-使用-binlog-实现-point-in-time-恢复"><a href="#14-2-使用-binlog-实现-point-in-time-恢复" class="headerlink" title="14.2 使用 binlog 实现 point-in-time 恢复"></a>14.2 使用 binlog 实现 point-in-time 恢复</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 binlog 文件</span></span><br><span class="line">SHOW BINARY LOGS;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 binlog 内容</span></span><br><span class="line">SHOW BINLOG EVENTS IN <span class="string">&#x27;mysql-bin.000001&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成恢复 SQL</span></span><br><span class="line">mysqlbinlog mysql-bin.000001 &gt; binlog.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复到指定时间点</span></span><br><span class="line">mysqlbinlog mysql-bin.000001 \</span><br><span class="line">  --start-datetime=<span class="string">&#x27;2024-01-01 10:00:00&#x27;</span> \</span><br><span class="line">  --stop-datetime=<span class="string">&#x27;2024-01-01 11:00:00&#x27;</span> \</span><br><span class="line">  | mysql -u root -p db_name</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="十五、常用系统命令"><a href="#十五、常用系统命令" class="headerlink" title="十五、常用系统命令"></a>十五、常用系统命令</h2><h3 id="15-1-查看系统变量"><a href="#15-1-查看系统变量" class="headerlink" title="15.1 查看系统变量"></a>15.1 查看系统变量</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看所有系统变量</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看特定变量</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%max_connections%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看动态变量值</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@max_connections</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改会话变量（仅当前连接）</span></span><br><span class="line"><span class="keyword">SET</span> SESSION max_connections <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改全局变量（影响后续所有连接）</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> max_connections <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 常见重要变量</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;character_set%&#x27;</span>;      <span class="comment">-- 字符集配置</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;slow_query_log%&#x27;</span>;     <span class="comment">-- 慢查询日志</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;max_connections%&#x27;</span>;    <span class="comment">-- 最大连接数</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;innodb_buffer_pool_size%&#x27;</span>;  <span class="comment">-- InnoDB 缓冲池</span></span><br></pre></td></tr></table></figure>

<h3 id="15-2-连接管理"><a href="#15-2-连接管理" class="headerlink" title="15.2 连接管理"></a>15.2 连接管理</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看当前连接</span></span><br><span class="line"><span class="keyword">SHOW</span> PROCESSLIST;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看完整的 SQL 语句（超过 100 字符的部分会被截断）</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">FULL</span> PROCESSLIST;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 杀死指定连接</span></span><br><span class="line">KILL <span class="number">123</span>;  <span class="comment">-- 123 是连接 ID</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看连接统计</span></span><br><span class="line"><span class="keyword">SHOW</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Threads%&#x27;</span>;</span><br><span class="line"><span class="comment">-- Threads_connected：当前连接数</span></span><br><span class="line"><span class="comment">-- Threads_created：创建过的连接数</span></span><br><span class="line"><span class="comment">-- Threads_running：正在运行的连接数</span></span><br></pre></td></tr></table></figure>

<h3 id="15-3-数据库大小统计"><a href="#15-3-数据库大小统计" class="headerlink" title="15.3 数据库大小统计"></a>15.3 数据库大小统计</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看数据库大小</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  table_schema <span class="keyword">AS</span> database_name,</span><br><span class="line">  ROUND(<span class="built_in">SUM</span>(data_length <span class="operator">+</span> index_length) <span class="operator">/</span> <span class="number">1024</span> <span class="operator">/</span> <span class="number">1024</span>, <span class="number">2</span>) <span class="keyword">AS</span> size_mb</span><br><span class="line"><span class="keyword">FROM</span> information_schema.tables</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> table_schema</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> size_mb <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看表大小</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  table_name,</span><br><span class="line">  ROUND((data_length <span class="operator">+</span> index_length) <span class="operator">/</span> <span class="number">1024</span> <span class="operator">/</span> <span class="number">1024</span>, <span class="number">2</span>) <span class="keyword">AS</span> size_mb</span><br><span class="line"><span class="keyword">FROM</span> information_schema.tables</span><br><span class="line"><span class="keyword">WHERE</span> table_schema <span class="operator">=</span> <span class="string">&#x27;db_name&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> size_mb <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看表的行数</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  table_name,</span><br><span class="line">  table_rows</span><br><span class="line"><span class="keyword">FROM</span> information_schema.tables</span><br><span class="line"><span class="keyword">WHERE</span> table_schema <span class="operator">=</span> <span class="string">&#x27;db_name&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> table_rows <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h3 id="15-4-性能监控"><a href="#15-4-性能监控" class="headerlink" title="15.4 性能监控"></a>15.4 性能监控</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看慢查询统计</span></span><br><span class="line"><span class="keyword">SHOW</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Slow%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看查询缓存统计（MySQL 5.7 后已弃用）</span></span><br><span class="line"><span class="keyword">SHOW</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Qcache%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看 InnoDB 性能指标</span></span><br><span class="line"><span class="keyword">SHOW</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Innodb%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看所有状态变量</span></span><br><span class="line"><span class="keyword">SHOW</span> STATUS;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="十六、常用函数速查"><a href="#十六、常用函数速查" class="headerlink" title="十六、常用函数速查"></a>十六、常用函数速查</h2><h3 id="16-1-字符串函数"><a href="#16-1-字符串函数" class="headerlink" title="16.1 字符串函数"></a>16.1 字符串函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>作用</th>
<th>例子</th>
</tr>
</thead>
<tbody><tr>
<td>LENGTH()</td>
<td>字符串长度</td>
<td>LENGTH(‘hello’) &#x3D; 5</td>
</tr>
<tr>
<td>CONCAT()</td>
<td>字符串拼接</td>
<td>CONCAT(‘a’, ‘b’) &#x3D; ‘ab’</td>
</tr>
<tr>
<td>UPPER()&#x2F;LOWER()</td>
<td>大小写转换</td>
<td>UPPER(‘hello’) &#x3D; ‘HELLO’</td>
</tr>
<tr>
<td>SUBSTRING()</td>
<td>截取字符串</td>
<td>SUBSTRING(‘hello’, 1, 3) &#x3D; ‘hel’</td>
</tr>
<tr>
<td>REPLACE()</td>
<td>字符串替换</td>
<td>REPLACE(‘hello’, ‘l’, ‘x’) &#x3D; ‘hexxo’</td>
</tr>
<tr>
<td>TRIM()</td>
<td>移除空格</td>
<td>TRIM(‘  hello  ‘) &#x3D; ‘hello’</td>
</tr>
<tr>
<td>INSTR()</td>
<td>查找位置</td>
<td>INSTR(‘hello’, ‘l’) &#x3D; 3</td>
</tr>
</tbody></table>
<h3 id="16-2-数学函数"><a href="#16-2-数学函数" class="headerlink" title="16.2 数学函数"></a>16.2 数学函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>作用</th>
<th>例子</th>
</tr>
</thead>
<tbody><tr>
<td>ABS()</td>
<td>绝对值</td>
<td>ABS(-5) &#x3D; 5</td>
</tr>
<tr>
<td>CEIL()&#x2F;ROUND()</td>
<td>向上&#x2F;四舍五入</td>
<td>CEIL(3.2) &#x3D; 4, ROUND(3.5) &#x3D; 4</td>
</tr>
<tr>
<td>FLOOR()</td>
<td>向下取整</td>
<td>FLOOR(3.9) &#x3D; 3</td>
</tr>
<tr>
<td>MOD()</td>
<td>取模</td>
<td>MOD(10, 3) &#x3D; 1</td>
</tr>
<tr>
<td>POWER()</td>
<td>幂</td>
<td>POWER(2, 3) &#x3D; 8</td>
</tr>
<tr>
<td>RAND()</td>
<td>随机数</td>
<td>RAND() &#x3D; 0.5…</td>
</tr>
</tbody></table>
<h3 id="16-3-日期函数"><a href="#16-3-日期函数" class="headerlink" title="16.3 日期函数"></a>16.3 日期函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>作用</th>
<th>例子</th>
</tr>
</thead>
<tbody><tr>
<td>NOW()</td>
<td>当前时间</td>
<td>NOW() &#x3D; ‘2024-01-15 10:30:45’</td>
</tr>
<tr>
<td>CURDATE()</td>
<td>当前日期</td>
<td>CURDATE() &#x3D; ‘2024-01-15’</td>
</tr>
<tr>
<td>CURTIME()</td>
<td>当前时间</td>
<td>CURTIME() &#x3D; ‘10:30:45’</td>
</tr>
<tr>
<td>DATE_FORMAT()</td>
<td>格式化日期</td>
<td>DATE_FORMAT(NOW(), ‘%Y-%m-%d’) &#x3D; ‘2024-01-15’</td>
</tr>
<tr>
<td>DATE_ADD()</td>
<td>日期加减</td>
<td>DATE_ADD(NOW(), INTERVAL 1 DAY)</td>
</tr>
<tr>
<td>DATEDIFF()</td>
<td>日期差</td>
<td>DATEDIFF(‘2024-01-15’, ‘2024-01-10’) &#x3D; 5</td>
</tr>
<tr>
<td>UNIX_TIMESTAMP()</td>
<td>转时间戳</td>
<td>UNIX_TIMESTAMP(‘2024-01-15’)</td>
</tr>
<tr>
<td>FROM_UNIXTIME()</td>
<td>从时间戳转</td>
<td>FROM_UNIXTIME(1705276845)</td>
</tr>
</tbody></table>
<h3 id="16-4-条件函数"><a href="#16-4-条件函数" class="headerlink" title="16.4 条件函数"></a>16.4 条件函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- CASE WHEN</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  id,</span><br><span class="line">  <span class="keyword">CASE</span> </span><br><span class="line">    <span class="keyword">WHEN</span> age <span class="operator">&lt;</span> <span class="number">18</span> <span class="keyword">THEN</span> <span class="string">&#x27;minor&#x27;</span></span><br><span class="line">    <span class="keyword">WHEN</span> age <span class="operator">&gt;=</span> <span class="number">18</span> <span class="keyword">THEN</span> <span class="string">&#x27;adult&#x27;</span></span><br><span class="line">    <span class="keyword">ELSE</span> <span class="string">&#x27;unknown&#x27;</span></span><br><span class="line">  <span class="keyword">END</span> <span class="keyword">AS</span> age_group</span><br><span class="line"><span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- IF 函数</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  id,</span><br><span class="line">  IF(age <span class="operator">&gt;=</span> <span class="number">18</span>, <span class="string">&#x27;adult&#x27;</span>, <span class="string">&#x27;minor&#x27;</span>) <span class="keyword">AS</span> age_group</span><br><span class="line"><span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- IFNULL / COALESCE</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  id,</span><br><span class="line">  IFNULL(nickname, username) <span class="keyword">AS</span> display_name</span><br><span class="line"><span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  id,</span><br><span class="line">  <span class="built_in">COALESCE</span>(nickname, description, <span class="string">&#x27;No bio&#x27;</span>) <span class="keyword">AS</span> bio</span><br><span class="line"><span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="十七、快速索引"><a href="#十七、快速索引" class="headerlink" title="十七、快速索引"></a>十七、快速索引</h2><h3 id="常见操作速查表"><a href="#常见操作速查表" class="headerlink" title="常见操作速查表"></a>常见操作速查表</h3><table>
<thead>
<tr>
<th>操作</th>
<th>命令</th>
<th>页码</th>
</tr>
</thead>
<tbody><tr>
<td>创建数据库</td>
<td>CREATE DATABASE</td>
<td>数据库操作</td>
</tr>
<tr>
<td>创建表</td>
<td>CREATE TABLE</td>
<td>数据表操作</td>
</tr>
<tr>
<td>插入数据</td>
<td>INSERT INTO</td>
<td>数据行操作</td>
</tr>
<tr>
<td>查询数据</td>
<td>SELECT</td>
<td>数据行操作</td>
</tr>
<tr>
<td>修改数据</td>
<td>UPDATE</td>
<td>数据行操作</td>
</tr>
<tr>
<td>删除数据</td>
<td>DELETE FROM</td>
<td>数据行操作</td>
</tr>
<tr>
<td>创建索引</td>
<td>CREATE INDEX</td>
<td>索引详解</td>
</tr>
<tr>
<td>查询优化</td>
<td>EXPLAIN</td>
<td>性能优化</td>
</tr>
<tr>
<td>备份数据库</td>
<td>mysqldump</td>
<td>备份和恢复</td>
</tr>
<tr>
<td>恢复数据库</td>
<td>mysql</td>
<td>备份和恢复</td>
</tr>
</tbody></table>
<h3 id="常见问题速查表"><a href="#常见问题速查表" class="headerlink" title="常见问题速查表"></a>常见问题速查表</h3><table>
<thead>
<tr>
<th>问题</th>
<th>原因</th>
<th>解决方案</th>
</tr>
</thead>
<tbody><tr>
<td>数据乱码</td>
<td>字符集不匹配</td>
<td>修改字符集为 utf8mb4</td>
</tr>
<tr>
<td>查询慢</td>
<td>未使用索引</td>
<td>分析执行计划，添加索引</td>
</tr>
<tr>
<td>插入慢</td>
<td>逐行插入</td>
<td>批量插入</td>
</tr>
<tr>
<td>锁表</td>
<td>长事务或死锁</td>
<td>缩短事务时间，检查死锁</td>
</tr>
<tr>
<td>磁盘满</td>
<td>数据过多</td>
<td>删除或归档老数据</td>
</tr>
<tr>
<td>误删数据</td>
<td>人为操作</td>
<td>从备份恢复或使用 binlog</td>
</tr>
</tbody></table>
<h3 id="最佳实践清单"><a href="#最佳实践清单" class="headerlink" title="最佳实践清单"></a>最佳实践清单</h3><ul>
<li><input disabled="" type="checkbox"> 所有表都有主键</li>
<li><input disabled="" type="checkbox"> 日期时间使用 DATETIME 或 TIMESTAMP</li>
<li><input disabled="" type="checkbox"> 字符集统一使用 utf8mb4</li>
<li><input disabled="" type="checkbox"> 为经常查询的列建索引</li>
<li><input disabled="" type="checkbox"> 定期备份数据库</li>
<li><input disabled="" type="checkbox"> 使用外键约束保证数据一致性</li>
<li><input disabled="" type="checkbox"> 重要操作使用事务</li>
<li><input disabled="" type="checkbox"> 大数据量查询使用分页</li>
<li><input disabled="" type="checkbox"> 定期分析慢查询日志</li>
<li><input disabled="" type="checkbox"> 避免在索引列使用函数</li>
<li><input disabled="" type="checkbox"> 逐行操作改为批量操作</li>
<li><input disabled="" type="checkbox"> 关键业务使用读写分离和主从复制</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://example.com">Felix</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://example.com/2025/11/20/Mysql%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/">http://example.com/2025/11/20/Mysql%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/imgs/adater.jpg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/11/20/Mysql%E5%BF%AB%E9%80%9F%E6%89%8B%E5%86%8C/" title="Mysql快速手册"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Mysql快速手册</div></div><div class="info-2"><div class="info-item-1">MySQL 快速手册基础连接123mysql -u root -p                    # 本地连接mysql -h 192.168.1.1 -u root -p    # 远程连接mysql -u root -p database_name      # 指定数据库  数据库操作12345SHOW DATABASES;                  # 查看所有数据库CREATE DATABASE db_name;         # 创建数据库USE db_name;                     # 选择数据库DROP DATABASE db_name;           # 删除数据库ALTER DATABASE db_name CHARACTER SET utf8mb4;  # 修改字符集  表操作1234SHOW TABLES;                     # 查看所有表DESC table_name;                 # 查看表结构SHOW CREATE TABLE table_name;    # 查看...</div></div></div></a><a class="pagination-related" href="/2025/11/19/Mysql%E6%95%B0%E6%8D%AE%E5%BA%93MHA%E9%AB%98%E5%8F%AF%E7%94%A8/" title="Mysql数据库MHA高可用"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Mysql数据库MHA高可用</div></div><div class="info-2"><div class="info-item-1">MySQL MHA 高可用一、MHA 是什么？MHA（Master High Availability）是一款开源的MySQL自动故障转移解决方案。它能够在主库发生故障时，自动将从库提升为主库，保证数据库服务的连续性。 核心功能：  自动故障转移：主库宕机时自动切换到从库 最小化数据丢失：智能选择最接近主库的从库作为新主库 VIP管理：自动漂移虚拟IP，应用无需修改连接地址 监控告警：持续监控主从状态，及时发现异常   二、为什么要做 MHA？问题场景：  数据库单点故障导致服务中断 主库宕机时，手动切换耗时，期间服务不可用 多个从库时，难以快速判断哪个应该成为新主库  MHA 的价值： ✅ 高可用：冗余设计，避免单点故障 ✅ 自动化：无需人工干预，秒级故障转移 ✅ 数据保护：优先选择数据最完整的从库 ✅ 对业务透明：通过VIP切换，应用连接无需改动  高可用：冗余、容灾、备份、故障转移 高可用为了干嘛？避免单点故障带来的问题   三、配置流程简述   步骤 说明    1. 基础配置 关闭防火墙，安装MySQL 5.7   2. 一主两从 配置主从复制（Master-Slave...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/imgs/adater.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Felix</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">31</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/falsezxy"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">MySQL相关知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">一、数据库基础概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.1.1.</span> <span class="toc-text">什么是数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL-%E7%9A%84%E6%A0%B8%E5%BF%83%E5%B1%82%E6%AC%A1"><span class="toc-number">1.1.2.</span> <span class="toc-text">MySQL 的核心层次</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.1.3.</span> <span class="toc-text">为什么需要数据库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.2.</span> <span class="toc-text">二、数据库操作详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 数据库的生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">创建数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%A1%E6%81%AF"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">查看数据库信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">使用数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.2.1.4.</span> <span class="toc-text">修改数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.2.1.5.</span> <span class="toc-text">删除数据库</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%95%B0%E6%8D%AE%E8%A1%A8%E6%93%8D%E4%BD%9C%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.3.</span> <span class="toc-text">三、数据表操作详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E8%A1%A8%E7%9A%84%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 表的结构设计</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8%E7%9A%84%E6%A0%B8%E5%BF%83%E5%85%83%E7%B4%A0"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">创建表的核心元素</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E8%A1%A8%E8%AE%BE%E8%AE%A1%E7%A4%BA%E4%BE%8B%EF%BC%88%E5%8C%85%E5%90%AB%E5%85%B3%E7%B3%BB%EF%BC%89"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">完整表设计示例（包含关系）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E6%9F%A5%E7%9C%8B%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 查看表结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E4%BF%AE%E6%94%B9%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.3 修改表结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%88%97"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">添加列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%88%97"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">修改列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%88%97"><span class="toc-number">1.3.3.3.</span> <span class="toc-text">删除列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E7%B4%A2%E5%BC%95"><span class="toc-number">1.3.3.4.</span> <span class="toc-text">添加索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-number">1.3.3.5.</span> <span class="toc-text">删除索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E5%91%BD%E5%90%8D%E8%A1%A8"><span class="toc-number">1.3.3.6.</span> <span class="toc-text">重命名表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8%E7%9A%84%E5%AD%97%E7%AC%A6%E9%9B%86"><span class="toc-number">1.3.3.7.</span> <span class="toc-text">修改表的字符集</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="toc-number">1.3.4.</span> <span class="toc-text">3.4 删除表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%95%B0%E6%8D%AE%E8%A1%8C%E6%93%8D%E4%BD%9C%E8%AF%A6%E8%A7%A3%EF%BC%88CRUD%EF%BC%89"><span class="toc-number">1.4.</span> <span class="toc-text">四、数据行操作详解（CRUD）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%88%9B%E5%BB%BA%EF%BC%88Create%EF%BC%89-%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 创建（Create）- 插入数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%8F%92%E5%85%A5"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">基本插入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8E%E5%85%B6%E4%BB%96%E8%A1%A8%E5%A4%8D%E5%88%B6%E6%95%B0%E6%8D%AE"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">从其他表复制数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#INSERT-%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">INSERT 执行过程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E8%AF%BB%E5%8F%96%EF%BC%88Retrieve%EF%BC%89-%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 读取（Retrieve）- 查询数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">基础查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#WHERE-%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">WHERE 条件查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%EF%BC%88ORDER-BY%EF%BC%89"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">排序（ORDER BY）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%EF%BC%88LIMIT%EF%BC%89"><span class="toc-number">1.4.2.4.</span> <span class="toc-text">分页查询（LIMIT）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%BB%E9%87%8D%EF%BC%88DISTINCT%EF%BC%89"><span class="toc-number">1.4.2.5.</span> <span class="toc-text">去重（DISTINCT）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0%EF%BC%88%E8%81%9A%E9%9B%86%E6%95%B0%E6%8D%AE%EF%BC%89"><span class="toc-number">1.4.2.6.</span> <span class="toc-text">聚合函数（聚集数据）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E7%BB%84%EF%BC%88GROUP-BY%EF%BC%89"><span class="toc-number">1.4.2.7.</span> <span class="toc-text">分组（GROUP BY）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.4.2.8.</span> <span class="toc-text">多表连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UNION-%E6%9F%A5%E8%AF%A2%EF%BC%88%E5%90%88%E5%B9%B6%E7%BB%93%E6%9E%9C%EF%BC%89"><span class="toc-number">1.4.2.9.</span> <span class="toc-text">UNION 查询（合并结果）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E4%BF%AE%E6%94%B9%EF%BC%88Update%EF%BC%89-%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="toc-number">1.4.3.</span> <span class="toc-text">4.3 修改（Update）- 更新数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%9B%B4%E6%96%B0"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">基本更新</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%9B%B4%E6%96%B0"><span class="toc-number">1.4.3.2.</span> <span class="toc-text">条件更新</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UPDATE-%E7%9A%84%E6%80%A7%E8%83%BD%E6%B3%A8%E6%84%8F"><span class="toc-number">1.4.3.3.</span> <span class="toc-text">UPDATE 的性能注意</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UPDATE-%E7%9A%84%E5%AE%89%E5%85%A8%E6%B3%A8%E6%84%8F"><span class="toc-number">1.4.3.4.</span> <span class="toc-text">UPDATE 的安全注意</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E5%88%A0%E9%99%A4%EF%BC%88Delete%EF%BC%89-%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">1.4.4.</span> <span class="toc-text">4.4 删除（Delete）- 删除数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%88%A0%E9%99%A4"><span class="toc-number">1.4.4.1.</span> <span class="toc-text">基本删除</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DELETE-%E4%B8%8E-TRUNCATE-%E5%AF%B9%E6%AF%94"><span class="toc-number">1.4.4.2.</span> <span class="toc-text">DELETE 与 TRUNCATE 对比</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%94%E7%BA%A7%E5%88%A0%E9%99%A4"><span class="toc-number">1.4.4.3.</span> <span class="toc-text">联级删除</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DELETE-%E7%9A%84%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">1.4.4.4.</span> <span class="toc-text">DELETE 的性能优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DELETE-%E7%9A%84%E5%AE%89%E5%85%A8%E6%B3%A8%E6%84%8F"><span class="toc-number">1.4.4.5.</span> <span class="toc-text">DELETE 的安全注意</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.5.</span> <span class="toc-text">五、索引详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E4%BB%80%E4%B9%88%E6%98%AF%E7%B4%A2%E5%BC%95"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1 什么是索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-1-%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BD%9C%E7%94%A8%EF%BC%88%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E7%B4%A2%E5%BC%95%EF%BC%89"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.1.1 索引的作用（为什么需要索引）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E6%8F%90%E5%8D%87"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">性能提升</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E4%BD%9C%E7%94%A8"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">具体作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E4%BE%8B%E5%AD%90"><span class="toc-number">1.5.2.3.</span> <span class="toc-text">实际例子</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-2-%E7%B4%A2%E5%BC%95%E7%9A%84%E5%89%AF%E4%BD%9C%E7%94%A8%EF%BC%88%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E5%85%A8%E5%8A%A0%E7%B4%A2%E5%BC%95%EF%BC%89"><span class="toc-number">1.5.3.</span> <span class="toc-text">5.1.2 索引的副作用（为什么不全加索引）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%8D%A0%E7%94%A8%E7%A3%81%E7%9B%98%E7%A9%BA%E9%97%B4"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">1. 占用磁盘空间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%99%8D%E4%BD%8E%E5%86%99%E5%85%A5%E6%80%A7%E8%83%BD"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">2. 降低写入性能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E4%BE%8B%E5%AD%90-1"><span class="toc-number">1.5.3.3.</span> <span class="toc-text">实际例子</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%A2%9E%E5%8A%A0%E7%BB%B4%E6%8A%A4%E6%88%90%E6%9C%AC"><span class="toc-number">1.5.3.4.</span> <span class="toc-text">3. 增加维护成本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E5%99%A8%E5%9B%B0%E6%83%91"><span class="toc-number">1.5.3.5.</span> <span class="toc-text">4. 查询优化器困惑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E7%9A%84%E5%9D%91"><span class="toc-number">1.5.3.6.</span> <span class="toc-text">5. 索引失效的坑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%89%AF%E4%BD%9C%E7%94%A8%E6%80%BB%E7%BB%93%E8%A1%A8"><span class="toc-number">1.5.3.7.</span> <span class="toc-text">索引副作用总结表</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-3-%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BE%9D%E6%8D%AE%EF%BC%88%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E5%BB%BA%E7%B4%A2%E5%BC%95%EF%BC%89"><span class="toc-number">1.5.4.</span> <span class="toc-text">5.1.3 创建索引的依据（什么时候建索引）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BB%BA%E7%B4%A2%E5%BC%95%E7%9A%84%E5%BF%85%E8%A6%81%E6%9D%A1%E4%BB%B6%EF%BC%88%E9%83%BD%E8%A6%81%E6%BB%A1%E8%B6%B3%EF%BC%89"><span class="toc-number">1.5.4.1.</span> <span class="toc-text">建索引的必要条件（都要满足）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E5%86%B3%E7%AD%96%E6%A0%91"><span class="toc-number">1.5.4.2.</span> <span class="toc-text">详细决策树</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90"><span class="toc-number">1.5.4.3.</span> <span class="toc-text">实践案例分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-1%EF%BC%9A%E7%94%B5%E5%95%86%E7%BD%91%E7%AB%99%E7%9A%84-orders-%E8%A1%A8%EF%BC%881000-%E4%B8%87%E8%A1%8C%EF%BC%89"><span class="toc-number">1.5.4.3.1.</span> <span class="toc-text">案例 1：电商网站的 orders 表（1000 万行）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-2%EF%BC%9A%E7%94%A8%E6%88%B7%E6%97%A5%E5%BF%97%E8%A1%A8%EF%BC%88100-%E4%BA%BF%E8%A1%8C%EF%BC%89"><span class="toc-number">1.5.4.3.2.</span> <span class="toc-text">案例 2：用户日志表（100 亿行）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-3%EF%BC%9A%E5%95%86%E5%93%81%E8%A1%A8%EF%BC%8810-%E4%B8%87%E8%A1%8C%EF%BC%89"><span class="toc-number">1.5.4.3.3.</span> <span class="toc-text">案例 3：商品表（10 万行）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%BB%BA%E7%AB%8B%E5%86%B3%E7%AD%96%E9%80%9F%E6%9F%A5%E8%A1%A8"><span class="toc-number">1.5.4.4.</span> <span class="toc-text">索引建立决策速查表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%BB%BA%E7%AB%8B%E7%9A%84%E9%BB%84%E9%87%91%E6%B3%95%E5%88%99"><span class="toc-number">1.5.4.5.</span> <span class="toc-text">索引建立的黄金法则</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E7%B4%A2%E5%BC%95%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.5.</span> <span class="toc-text">5.2 索引的工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#B-%E6%A0%91%E7%BB%93%E6%9E%84"><span class="toc-number">1.5.5.1.</span> <span class="toc-text">B+ 树结构</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E7%B4%A2%E5%BC%95%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.5.6.</span> <span class="toc-text">5.3 索引的类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E7%B4%A2%E5%BC%95%EF%BC%88PRIMARY-KEY%EF%BC%89"><span class="toc-number">1.5.6.1.</span> <span class="toc-text">主键索引（PRIMARY KEY）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%EF%BC%88UNIQUE%EF%BC%89"><span class="toc-number">1.5.6.2.</span> <span class="toc-text">唯一索引（UNIQUE）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E7%B4%A2%E5%BC%95%EF%BC%88INDEX%EF%BC%89"><span class="toc-number">1.5.6.3.</span> <span class="toc-text">普通索引（INDEX）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E5%90%88%E7%B4%A2%E5%BC%95%EF%BC%88%E5%A4%9A%E5%88%97%E7%B4%A2%E5%BC%95%EF%BC%89"><span class="toc-number">1.5.6.4.</span> <span class="toc-text">复合索引（多列索引）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E6%96%87%E7%B4%A2%E5%BC%95%EF%BC%88FULLTEXT%EF%BC%89"><span class="toc-number">1.5.6.5.</span> <span class="toc-text">全文索引（FULLTEXT）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%BC%80%E7%B4%A2%E5%BC%95"><span class="toc-number">1.5.6.6.</span> <span class="toc-text">前缀索引</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E6%9F%A5%E7%9C%8B%E5%92%8C%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-number">1.5.7.</span> <span class="toc-text">5.4 查看和删除索引</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%B4%A2%E5%BC%95"><span class="toc-number">1.5.7.1.</span> <span class="toc-text">查看索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95-1"><span class="toc-number">1.5.7.2.</span> <span class="toc-text">删除索引</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-%E7%B4%A2%E5%BC%95%E7%9A%84%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="toc-number">1.5.8.</span> <span class="toc-text">5.5 索引的性能分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#EXPLAIN-%E6%9F%A5%E8%AF%A2%E5%88%86%E6%9E%90"><span class="toc-number">1.5.8.1.</span> <span class="toc-text">EXPLAIN 查询分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B"><span class="toc-number">1.5.8.2.</span> <span class="toc-text">常见的查询优化案例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-%E7%B4%A2%E5%BC%95%E7%9A%84%E7%BB%B4%E6%8A%A4"><span class="toc-number">1.5.9.</span> <span class="toc-text">5.6 索引的维护</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-7-%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E9%9C%80%E8%A6%81%E7%B4%A2%E5%BC%95"><span class="toc-number">1.5.10.</span> <span class="toc-text">5.7 什么情况下需要索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.6.</span> <span class="toc-text">六、数据类型详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E6%95%B4%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.6.1.</span> <span class="toc-text">6.1 整数类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E6%B5%AE%E7%82%B9%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.6.2.</span> <span class="toc-text">6.2 浮点数类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.6.3.</span> <span class="toc-text">6.3 字符串类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.6.4.</span> <span class="toc-text">6.4 日期时间类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-5-%E5%85%B6%E4%BB%96%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.6.5.</span> <span class="toc-text">6.5 其他类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ENUM%EF%BC%88%E6%9E%9A%E4%B8%BE%EF%BC%89"><span class="toc-number">1.6.5.1.</span> <span class="toc-text">ENUM（枚举）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BOOLEAN"><span class="toc-number">1.6.5.2.</span> <span class="toc-text">BOOLEAN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JSON"><span class="toc-number">1.6.5.3.</span> <span class="toc-text">JSON</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E7%BA%A6%E6%9D%9F%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.7.</span> <span class="toc-text">七、约束详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E5%B8%B8%E8%A7%81%E7%BA%A6%E6%9D%9F%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.7.1.</span> <span class="toc-text">7.1 常见约束类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#NOT-NULL%EF%BC%88%E9%9D%9E%E7%A9%BA%E7%BA%A6%E6%9D%9F%EF%BC%89"><span class="toc-number">1.7.1.1.</span> <span class="toc-text">NOT NULL（非空约束）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UNIQUE%EF%BC%88%E5%94%AF%E4%B8%80%E7%BA%A6%E6%9D%9F%EF%BC%89"><span class="toc-number">1.7.1.2.</span> <span class="toc-text">UNIQUE（唯一约束）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DEFAULT%EF%BC%88%E9%BB%98%E8%AE%A4%E5%80%BC%EF%BC%89"><span class="toc-number">1.7.1.3.</span> <span class="toc-text">DEFAULT（默认值）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CHECK%EF%BC%88%E6%A3%80%E6%9F%A5%E7%BA%A6%E6%9D%9F%EF%BC%89"><span class="toc-number">1.7.1.4.</span> <span class="toc-text">CHECK（检查约束）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E7%BA%A6%E6%9D%9F%EF%BC%88PRIMARY-KEY%EF%BC%89"><span class="toc-number">1.7.1.5.</span> <span class="toc-text">主键约束（PRIMARY KEY）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F%EF%BC%88FOREIGN-KEY%EF%BC%89"><span class="toc-number">1.7.1.6.</span> <span class="toc-text">外键约束（FOREIGN KEY）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E4%BA%8B%E5%8A%A1%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.8.</span> <span class="toc-text">八、事务详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E4%BB%80%E4%B9%88%E6%98%AF%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.8.1.</span> <span class="toc-text">8.1 什么是事务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-%E4%BA%8B%E5%8A%A1%E7%9A%84-ACID-%E7%89%B9%E6%80%A7"><span class="toc-number">1.8.2.</span> <span class="toc-text">8.2 事务的 ACID 特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.8.3.</span> <span class="toc-text">8.3 事务的基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E4%BE%8B%E5%AD%90%EF%BC%9A%E9%93%B6%E8%A1%8C%E8%BD%AC%E8%B4%A6"><span class="toc-number">1.8.3.1.</span> <span class="toc-text">实际例子：银行转账</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-%E8%87%AA%E5%8A%A8%E6%8F%90%E4%BA%A4%E6%8E%A7%E5%88%B6"><span class="toc-number">1.8.4.</span> <span class="toc-text">8.4 自动提交控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-5-%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">1.8.5.</span> <span class="toc-text">8.5 事务的隔离级别</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9B%E7%A7%8D%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">1.8.5.1.</span> <span class="toc-text">四种隔离级别</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-6-%E4%BF%9D%E5%AD%98%E7%82%B9%EF%BC%88Savepoint%EF%BC%89"><span class="toc-number">1.8.6.</span> <span class="toc-text">8.6 保存点（Savepoint）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E8%A7%86%E5%9B%BE%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.9.</span> <span class="toc-text">九、视图详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-%E4%BB%80%E4%B9%88%E6%98%AF%E8%A7%86%E5%9B%BE"><span class="toc-number">1.9.1.</span> <span class="toc-text">9.1 什么是视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-%E5%88%9B%E5%BB%BA%E5%92%8C%E4%BD%BF%E7%94%A8%E8%A7%86%E5%9B%BE"><span class="toc-number">1.9.2.</span> <span class="toc-text">9.2 创建和使用视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-%E4%BF%AE%E6%94%B9%E5%92%8C%E5%88%A0%E9%99%A4%E8%A7%86%E5%9B%BE"><span class="toc-number">1.9.3.</span> <span class="toc-text">9.3 修改和删除视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-%E8%A7%86%E5%9B%BE%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">1.9.4.</span> <span class="toc-text">9.4 视图的作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-5-%E5%8F%AF%E6%9B%B4%E6%96%B0%E8%A7%86%E5%9B%BE"><span class="toc-number">1.9.5.</span> <span class="toc-text">9.5 可更新视图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.10.</span> <span class="toc-text">十、性能优化建议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96"><span class="toc-number">1.10.1.</span> <span class="toc-text">10.1 查询优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96"><span class="toc-number">1.10.2.</span> <span class="toc-text">10.2 索引优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C%E4%BC%98%E5%8C%96"><span class="toc-number">1.10.3.</span> <span class="toc-text">10.3 批量操作优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-4-%E5%88%86%E9%A1%B5%E4%BC%98%E5%8C%96"><span class="toc-number">1.10.4.</span> <span class="toc-text">10.4 分页优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-5-%E8%BF%9E%E6%8E%A5%E4%BC%98%E5%8C%96"><span class="toc-number">1.10.5.</span> <span class="toc-text">10.5 连接优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-6-%E7%9B%91%E6%8E%A7%E5%92%8C%E5%88%86%E6%9E%90"><span class="toc-number">1.10.6.</span> <span class="toc-text">10.6 监控和分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%E3%80%81%E5%A4%87%E4%BB%BD%E5%92%8C%E6%81%A2%E5%A4%8D"><span class="toc-number">1.11.</span> <span class="toc-text">十一、备份和恢复</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-1-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%A4%87%E4%BB%BD"><span class="toc-number">1.11.1.</span> <span class="toc-text">11.1 为什么需要备份</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-%E4%BD%BF%E7%94%A8-mysqldump-%E5%A4%87%E4%BB%BD"><span class="toc-number">1.11.2.</span> <span class="toc-text">11.2 使用 mysqldump 备份</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-3-%E6%81%A2%E5%A4%8D%E6%95%B0%E6%8D%AE"><span class="toc-number">1.11.3.</span> <span class="toc-text">11.3 恢复数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-4-%E5%A4%87%E4%BB%BD%E7%AD%96%E7%95%A5"><span class="toc-number">1.11.4.</span> <span class="toc-text">11.4 备份策略</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.12.</span> <span class="toc-text">十二、常见问题和解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#12-1-%E5%B9%B6%E5%8F%91%E9%97%AE%E9%A2%98"><span class="toc-number">1.12.1.</span> <span class="toc-text">12.1 并发问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%EF%BC%9A%E8%84%8F%E8%AF%BB%E3%80%81%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E3%80%81%E5%B9%BB%E8%AF%BB"><span class="toc-number">1.12.1.1.</span> <span class="toc-text">问题：脏读、不可重复读、幻读</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%EF%BC%9A%E6%AD%BB%E9%94%81"><span class="toc-number">1.12.1.2.</span> <span class="toc-text">问题：死锁</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-2-%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98"><span class="toc-number">1.12.2.</span> <span class="toc-text">12.2 性能问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%EF%BC%9A%E6%9F%A5%E8%AF%A2%E5%BE%88%E6%85%A2"><span class="toc-number">1.12.2.1.</span> <span class="toc-text">问题：查询很慢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%EF%BC%9A%E6%8F%92%E5%85%A5%E5%BE%88%E6%85%A2"><span class="toc-number">1.12.2.2.</span> <span class="toc-text">问题：插入很慢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%EF%BC%9A%E8%A1%A8%E5%BE%88%E5%A4%A7%EF%BC%8C%E6%9F%A5%E8%AF%A2%E5%BE%88%E6%85%A2"><span class="toc-number">1.12.2.3.</span> <span class="toc-text">问题：表很大，查询很慢</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-3-%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7%E9%97%AE%E9%A2%98"><span class="toc-number">1.12.3.</span> <span class="toc-text">12.3 数据一致性问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%EF%BC%9A%E4%BA%A7%E7%94%9F%E5%AD%A4%E7%AB%8B%E6%95%B0%E6%8D%AE%EF%BC%88%E8%AE%A2%E5%8D%95%E7%9A%84%E7%94%A8%E6%88%B7%E8%A2%AB%E5%88%A0%E9%99%A4%EF%BC%89"><span class="toc-number">1.12.3.1.</span> <span class="toc-text">问题：产生孤立数据（订单的用户被删除）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%EF%BC%9A%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%AE%8C%E6%95%B4%EF%BC%88%E5%AD%97%E6%AE%B5%E4%B8%BA%E7%A9%BA%EF%BC%89"><span class="toc-number">1.12.3.2.</span> <span class="toc-text">问题：数据不完整（字段为空）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-4-%E5%AD%98%E5%82%A8%E7%A9%BA%E9%97%B4%E9%97%AE%E9%A2%98"><span class="toc-number">1.12.4.</span> <span class="toc-text">12.4 存储空间问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%EF%BC%9A%E8%A1%A8%E5%8D%A0%E7%94%A8%E7%A9%BA%E9%97%B4%E5%A4%AA%E5%A4%A7"><span class="toc-number">1.12.4.1.</span> <span class="toc-text">问题：表占用空间太大</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%EF%BC%9A%E6%9F%90%E4%B8%AA%E5%88%97%E5%8D%A0%E7%94%A8%E7%A9%BA%E9%97%B4%E5%A4%AA%E5%A4%A7"><span class="toc-number">1.12.4.2.</span> <span class="toc-text">问题：某个列占用空间太大</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-5-%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98"><span class="toc-number">1.12.5.</span> <span class="toc-text">12.5 乱码问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%EF%BC%9A%E5%AD%98%E5%85%A5%E5%92%8C%E6%9F%A5%E5%87%BA%E7%9A%84%E6%95%B0%E6%8D%AE%E4%B9%B1%E7%A0%81"><span class="toc-number">1.12.5.1.</span> <span class="toc-text">问题：存入和查出的数据乱码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%89%E3%80%81%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7"><span class="toc-number">1.13.</span> <span class="toc-text">十三、高级特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#13-1-%E8%A7%A6%E5%8F%91%E5%99%A8%EF%BC%88Trigger%EF%BC%89"><span class="toc-number">1.13.1.</span> <span class="toc-text">13.1 触发器（Trigger）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%EF%BC%88Stored-Procedure%EF%BC%89"><span class="toc-number">1.13.2.</span> <span class="toc-text">13.2 存储过程（Stored Procedure）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E5%9B%9B%E3%80%81%E7%81%BE%E9%9A%BE%E6%81%A2%E5%A4%8D"><span class="toc-number">1.14.</span> <span class="toc-text">十四、灾难恢复</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#14-1-%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D%E5%9C%BA%E6%99%AF"><span class="toc-number">1.14.1.</span> <span class="toc-text">14.1 数据恢复场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF-1%EF%BC%9A%E8%AF%AF%E5%88%A0%E6%95%B0%E6%8D%AE"><span class="toc-number">1.14.1.1.</span> <span class="toc-text">场景 1：误删数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF-2%EF%BC%9A%E8%A1%A8%E6%8D%9F%E5%9D%8F"><span class="toc-number">1.14.1.2.</span> <span class="toc-text">场景 2：表损坏</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF-3%EF%BC%9A%E7%A1%AC%E4%BB%B6%E6%95%85%E9%9A%9C%E5%AF%BC%E8%87%B4%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8D%E5%8F%AF%E7%94%A8"><span class="toc-number">1.14.1.3.</span> <span class="toc-text">场景 3：硬件故障导致数据库不可用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-2-%E4%BD%BF%E7%94%A8-binlog-%E5%AE%9E%E7%8E%B0-point-in-time-%E6%81%A2%E5%A4%8D"><span class="toc-number">1.14.2.</span> <span class="toc-text">14.2 使用 binlog 实现 point-in-time 恢复</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%BA%94%E3%80%81%E5%B8%B8%E7%94%A8%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4"><span class="toc-number">1.15.</span> <span class="toc-text">十五、常用系统命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#15-1-%E6%9F%A5%E7%9C%8B%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F"><span class="toc-number">1.15.1.</span> <span class="toc-text">15.1 查看系统变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-2-%E8%BF%9E%E6%8E%A5%E7%AE%A1%E7%90%86"><span class="toc-number">1.15.2.</span> <span class="toc-text">15.2 连接管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-3-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%A7%E5%B0%8F%E7%BB%9F%E8%AE%A1"><span class="toc-number">1.15.3.</span> <span class="toc-text">15.3 数据库大小统计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-4-%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7"><span class="toc-number">1.15.4.</span> <span class="toc-text">15.4 性能监控</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E5%85%AD%E3%80%81%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0%E9%80%9F%E6%9F%A5"><span class="toc-number">1.16.</span> <span class="toc-text">十六、常用函数速查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#16-1-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="toc-number">1.16.1.</span> <span class="toc-text">16.1 字符串函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16-2-%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0"><span class="toc-number">1.16.2.</span> <span class="toc-text">16.2 数学函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16-3-%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-number">1.16.3.</span> <span class="toc-text">16.3 日期函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16-4-%E6%9D%A1%E4%BB%B6%E5%87%BD%E6%95%B0"><span class="toc-number">1.16.4.</span> <span class="toc-text">16.4 条件函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%83%E3%80%81%E5%BF%AB%E9%80%9F%E7%B4%A2%E5%BC%95"><span class="toc-number">1.17.</span> <span class="toc-text">十七、快速索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C%E9%80%9F%E6%9F%A5%E8%A1%A8"><span class="toc-number">1.17.1.</span> <span class="toc-text">常见操作速查表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E9%80%9F%E6%9F%A5%E8%A1%A8"><span class="toc-number">1.17.2.</span> <span class="toc-text">常见问题速查表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E6%B8%85%E5%8D%95"><span class="toc-number">1.17.3.</span> <span class="toc-text">最佳实践清单</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/03/Kubernetes%E4%BA%86%E8%A7%A3%E4%B8%8E%E6%90%AD%E5%BB%BA/" title="Kubernetes了解与搭建">Kubernetes了解与搭建</a><time datetime="2025-12-03T06:44:22.000Z" title="Created 2025-12-03 14:44:22">2025-12-03</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/02/Prometheus%E7%9B%91%E6%8E%A7-%E9%92%89%E9%92%89%E8%AD%A6%E5%91%8A-%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/" title="Prometheus监控+钉钉警告 部署指南">Prometheus监控+钉钉警告 部署指南</a><time datetime="2025-12-02T05:39:16.000Z" title="Created 2025-12-02 13:39:16">2025-12-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/02/Prometheus/" title="Prometheus监控系统">Prometheus监控系统</a><time datetime="2025-12-02T00:55:58.000Z" title="Created 2025-12-02 08:55:58">2025-12-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/01/Ansible/" title="Ansible">Ansible</a><time datetime="2025-12-01T00:54:40.000Z" title="Created 2025-12-01 08:54:40">2025-12-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/27/Harbor%20%E7%A7%81%E6%9C%89%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E5%AE%8C%E6%95%B4%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/" title="Harbor 私有镜像仓库完整部署指南">Harbor 私有镜像仓库完整部署指南</a><time datetime="2025-11-27T10:54:40.000Z" title="Created 2025-11-27 18:54:40">2025-11-27</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/imgs/background_footer.jpg);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Felix</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.0.0</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.1</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.1"></script><script src="/js/main.js?v=5.5.1"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>