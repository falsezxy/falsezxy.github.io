<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Web服务相关知识 | Felix的个人博客</title><meta name="author" content="Felix"><meta name="copyright" content="Felix"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Web服务相关知识一、Web1.1 什么是WebWeb（万维网）是基于互联网构建的一个信息资源共享网络，通过HTTP&#x2F;HTTPS协议进行数据传输，允许用户通过浏览器访问服务器上的各种资源（网页、图片、视频等）。 访问Web服务的基本流程：浏览器发起请求 → 服务器处理 → 返回响应 → 浏览器渲染显示 1.2 两种经典架构模型① B&#x2F;S架构（Browser&#x2F;Serve">
<meta property="og:type" content="article">
<meta property="og:title" content="Web服务相关知识">
<meta property="og:url" content="http://example.com/2025/11/03/web%E6%9C%8D%E5%8A%A1%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/index.html">
<meta property="og:site_name" content="Felix的个人博客">
<meta property="og:description" content="Web服务相关知识一、Web1.1 什么是WebWeb（万维网）是基于互联网构建的一个信息资源共享网络，通过HTTP&#x2F;HTTPS协议进行数据传输，允许用户通过浏览器访问服务器上的各种资源（网页、图片、视频等）。 访问Web服务的基本流程：浏览器发起请求 → 服务器处理 → 返回响应 → 浏览器渲染显示 1.2 两种经典架构模型① B&#x2F;S架构（Browser&#x2F;Serve">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/imgs/adater.jpg">
<meta property="article:published_time" content="2025-11-03T10:17:19.000Z">
<meta property="article:modified_time" content="2025-11-26T10:19:34.450Z">
<meta property="article:author" content="Felix">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/imgs/adater.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Web服务相关知识",
  "url": "http://example.com/2025/11/03/web%E6%9C%8D%E5%8A%A1%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/",
  "image": "http://example.com/imgs/adater.jpg",
  "datePublished": "2025-11-03T10:17:19.000Z",
  "dateModified": "2025-11-26T10:19:34.450Z",
  "author": [
    {
      "@type": "Person",
      "name": "Felix",
      "url": "http://example.com"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2025/11/03/web%E6%9C%8D%E5%8A%A1%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Web服务相关知识',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 8.0.0"></head><body><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/imgs/background_header.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Felix的个人博客</span></a><a class="nav-page-title" href="/"><span class="site-name">Web服务相关知识</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">Web服务相关知识</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-11-03T10:17:19.000Z" title="Created 2025-11-03 18:17:19">2025-11-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-11-26T10:19:34.450Z" title="Updated 2025-11-26 18:19:34">2025-11-26</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="Web服务相关知识"><a href="#Web服务相关知识" class="headerlink" title="Web服务相关知识"></a>Web服务相关知识</h1><h2 id="一、Web"><a href="#一、Web" class="headerlink" title="一、Web"></a>一、Web</h2><h3 id="1-1-什么是Web"><a href="#1-1-什么是Web" class="headerlink" title="1.1 什么是Web"></a>1.1 什么是Web</h3><p>Web（万维网）是基于互联网构建的一个信息资源共享网络，通过HTTP&#x2F;HTTPS协议进行数据传输，允许用户通过浏览器访问服务器上的各种资源（网页、图片、视频等）。</p>
<p>访问Web服务的<strong>基本流程</strong>：浏览器发起请求 → 服务器处理 → 返回响应 → 浏览器渲染显示</p>
<h3 id="1-2-两种经典架构模型"><a href="#1-2-两种经典架构模型" class="headerlink" title="1.2 两种经典架构模型"></a>1.2 两种经典架构模型</h3><h4 id="①-B-S架构（Browser-Server浏览器-服务器）"><a href="#①-B-S架构（Browser-Server浏览器-服务器）" class="headerlink" title="① B&#x2F;S架构（Browser&#x2F;Server浏览器&#x2F;服务器）"></a>① B&#x2F;S架构（Browser&#x2F;Server浏览器&#x2F;服务器）</h4><ul>
<li><strong>特点</strong>：客户端使用浏览器访问，无需安装额外程序</li>
<li><strong>优势</strong>：跨平台性强、易维护、用户无需更新客户端</li>
<li><strong>应用场景</strong>：大多数互联网应用（百度、淘宝、Gmail等）</li>
<li><strong>工作流程</strong>：用户通过浏览器输入URL → DNS解析 → 三次握手建立连接 → 下载页面文件 → 浏览器本地渲染</li>
</ul>
<h4 id="②-C-S架构（Client-Server客户端-服务器）"><a href="#②-C-S架构（Client-Server客户端-服务器）" class="headerlink" title="② C&#x2F;S架构（Client&#x2F;Server客户端&#x2F;服务器）"></a>② C&#x2F;S架构（Client&#x2F;Server客户端&#x2F;服务器）</h4><ul>
<li><strong>特点</strong>：客户端需要安装专门的应用程序</li>
<li><strong>优势</strong>：交互性强、功能丰富、离线访问能力强</li>
<li><strong>应用场景</strong>：游戏客户端、企业内部系统、QQ等即时通讯工具</li>
<li><strong>工作流程</strong>：应用程序与服务器通过特定协议通信</li>
</ul>
<h3 id="1-3-协议、端口、功能的关系"><a href="#1-3-协议、端口、功能的关系" class="headerlink" title="1.3 协议、端口、功能的关系"></a>1.3 协议、端口、功能的关系</h3><table>
<thead>
<tr>
<th>协议</th>
<th>端口</th>
<th>功能（服务）</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>HTTP</td>
<td>80</td>
<td>超文本传输</td>
<td>明文传输，不加密</td>
</tr>
<tr>
<td>HTTPS</td>
<td>443</td>
<td>加密超文本传输</td>
<td>基于SSL&#x2F;TLS加密</td>
</tr>
<tr>
<td>SMTP</td>
<td>25</td>
<td>邮件发送传输</td>
<td>用于邮件服务</td>
</tr>
<tr>
<td>SSH</td>
<td>22</td>
<td>远程登录</td>
<td>加密的远程连接</td>
</tr>
</tbody></table>
<p>每种协议对应相应的功能服务，端口号是网络通信的标识符，用于区分不同的服务。</p>
<h3 id="1-4-连接建立过程TCP"><a href="#1-4-连接建立过程TCP" class="headerlink" title="1.4 连接建立过程TCP"></a>1.4 连接建立过程TCP</h3><p><strong>三次握手</strong>（建立TCP双向连接的过程）：</p>
<ol>
<li>客户端发送SYN包给服务器（我要连接）</li>
<li>服务器收到后回复SYN+ACK包（可以连接）</li>
<li>客户端收到后发送ACK包（确认连接）</li>
</ol>
<p>完成三次握手后，客户端和服务器之间建立了双向连接，可以开始数据传输。</p>
<p><img src="/./imgs/image-20251104190835691.png" alt="image-20251104190835691"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看网络情况</span></span><br><span class="line">netstat -natp | grep 80</span><br></pre></td></tr></table></figure>

<blockquote>
<p>-n:直接使用IP地址，而不通过域名服务器</p>
<p>-a:显示所有连线中的Socket</p>
<p>-t:显示TCP传输协议的连线状况。</p>
<p>-p:显示正在使用Socket的程序识别码和程序名称。</p>
</blockquote>
<p><img src="/./imgs/image-20251104191224743.png" alt="image-20251104191224743"></p>
<p>可以看见又两次established，是双向建立连接的过程</p>
<h3 id="1-5-访问数据流向"><a href="#1-5-访问数据流向" class="headerlink" title="1.5 访问数据流向"></a>1.5 访问数据流向</h3><p>访问百度的<strong>数据流向</strong>：</p>
<p>1、网页起始就是由多个文件组成<br>2、使用http&#x2F;https访问百度，就是从百度服务器那下载页面文件，在本地用浏览器打开<br>3、连接：(如果缓存中没有)先通过DNS 解析 —&gt; tcp3握 —&gt;下载页面相关文件 –&gt;本地浏览器打开</p>
<p><img src="/./imgs/image-20251103190542630.png" alt="image-20251103190542630"></p>
<p><img src="/./imgs/image-20251106094305512.png" alt="image-20251106094305512"></p>
<p><img src="/./imgs/image-20251104191705357.png" alt="image-20251104191705357"></p>
<h2 id="二、HTTP-HTTPS协议"><a href="#二、HTTP-HTTPS协议" class="headerlink" title="二、HTTP&#x2F;HTTPS协议"></a>二、HTTP&#x2F;HTTPS协议</h2><h3 id="2-1-HTTP协议基础"><a href="#2-1-HTTP协议基础" class="headerlink" title="2.1 HTTP协议基础"></a>2.1 HTTP协议基础</h3><p><strong>HTTP</strong>（HyperText Transfer Protocol 超文本传输协议）是应用层协议，基于请求-响应模型工作。</p>
<p><strong>特点</strong>：</p>
<ul>
<li>无状态协议：服务器不保存客户端状态信息</li>
<li>灵活可扩展：易于添加新的功能和特性</li>
<li>基于TCP&#x2F;IP：确保数据可靠传输</li>
<li>明文传输：安全性较低</li>
</ul>
<h3 id="2-2-HTTPS协议"><a href="#2-2-HTTPS协议" class="headerlink" title="2.2 HTTPS协议"></a>2.2 HTTPS协议</h3><p><strong>HTTPS</strong>（HyperText Transfer Protocol Secure 安全超文本传输协议）是安全版的HTTP，通过SSL&#x2F;TLS加密协议实现安全传输。</p>
<p><strong>区别对比</strong>：</p>
<table>
<thead>
<tr>
<th>特性</th>
<th>HTTP</th>
<th>HTTPS</th>
</tr>
</thead>
<tbody><tr>
<td>端口</td>
<td>80</td>
<td>443</td>
</tr>
<tr>
<td>加密</td>
<td>否</td>
<td>是（SSL&#x2F;TLS）</td>
</tr>
<tr>
<td>安全性</td>
<td>低</td>
<td>高</td>
</tr>
<tr>
<td>证书</td>
<td>无需</td>
<td>需要</td>
</tr>
<tr>
<td>性能</td>
<td>快</td>
<td>相对慢（加密开销）</td>
</tr>
</tbody></table>
<p><strong>HTTPS工作流程</strong>：</p>
<ol>
<li>客户端请求安全连接</li>
<li>服务器返回SSL证书</li>
<li>客户端验证证书并生成会话密钥</li>
<li>建立加密通道</li>
<li>数据通过加密通道传输</li>
</ol>
<p><strong>重定向行为</strong>：<br>网站常将HTTP请求自动重定向到HTTPS。例如访问 <code>http://www.baidu.com</code> 时，百度服务器会将请求重定向，用户最终访问的是 <code>https://www.baidu.com</code></p>
<h3 id="2-3-HTTP请求与响应"><a href="#2-3-HTTP请求与响应" class="headerlink" title="2.3 HTTP请求与响应"></a>2.3 HTTP请求与响应</h3><p><strong>HTTP请求结构</strong>：</p>
<ul>
<li>请求行：方法 + URL + 协议版本（如 <code>GET /index.html HTTP/1.1</code>）</li>
<li>请求头：包含客户端信息、浏览器类型等</li>
<li>请求体：POST请求中的数据（可选）</li>
</ul>
<p><strong>HTTP方法</strong>：</p>
<ul>
<li>GET：获取资源（幂等，无请求体）</li>
<li>POST：提交数据（非幂等）</li>
<li>PUT：更新资源</li>
<li>DELETE：删除资源</li>
<li>HEAD：获取资源元数据</li>
</ul>
<p><strong>HTTP响应结构</strong>：</p>
<ul>
<li>状态行：协议版本 + 状态码 + 状态信息</li>
<li>响应头：服务器信息、内容类型等</li>
<li>响应体：返回的资源内容</li>
</ul>
<h3 id="2-4-HTTP状态码"><a href="#2-4-HTTP状态码" class="headerlink" title="2.4 HTTP状态码"></a>2.4 HTTP状态码</h3><p>状态码用3位数字表示，分为5类，以下为常用状态码汇总：</p>
<table>
<thead>
<tr>
<th>状态码</th>
<th>类别</th>
<th>说明</th>
<th>场景举例</th>
</tr>
</thead>
<tbody><tr>
<td><strong>100</strong></td>
<td>1xx信息</td>
<td>Continue</td>
<td>客户端继续发送请求体</td>
</tr>
<tr>
<td><strong>200</strong></td>
<td>2xx成功</td>
<td>OK</td>
<td>请求成功，返回期望数据</td>
</tr>
<tr>
<td><strong>201</strong></td>
<td>2xx成功</td>
<td>Created</td>
<td>创建资源成功（如POST创建新用户）</td>
</tr>
<tr>
<td><strong>204</strong></td>
<td>2xx成功</td>
<td>No Content</td>
<td>请求成功但无返回内容（如DELETE成功）</td>
</tr>
<tr>
<td><strong>206</strong></td>
<td>2xx成功</td>
<td>Partial Content</td>
<td>部分内容（断点续传、视频分段请求）</td>
</tr>
<tr>
<td><strong>301</strong></td>
<td>3xx重定向</td>
<td>Moved Permanently</td>
<td>永久重定向（如HTTP→HTTPS）</td>
</tr>
<tr>
<td><strong>302</strong></td>
<td>3xx重定向</td>
<td>Found</td>
<td>临时重定向（登录后重定向到首页）</td>
</tr>
<tr>
<td><strong>304</strong></td>
<td>3xx重定向</td>
<td>Not Modified</td>
<td>资源未修改，使用缓存</td>
</tr>
<tr>
<td><strong>307</strong></td>
<td>3xx重定向</td>
<td>Temporary Redirect</td>
<td>临时重定向（保留请求方法）</td>
</tr>
<tr>
<td><strong>400</strong></td>
<td>4xx客户端错误</td>
<td>Bad Request</td>
<td>请求格式错误或参数非法</td>
</tr>
<tr>
<td><strong>401</strong></td>
<td>4xx客户端错误</td>
<td>Unauthorized</td>
<td>需要身份认证（未登录）</td>
</tr>
<tr>
<td><strong>403</strong></td>
<td>4xx客户端错误</td>
<td>Forbidden</td>
<td>禁止访问（无权限）</td>
</tr>
<tr>
<td><strong>404</strong></td>
<td>4xx客户端错误</td>
<td>Not Found</td>
<td>资源不存在</td>
</tr>
<tr>
<td><strong>405</strong></td>
<td>4xx客户端错误</td>
<td>Method Not Allowed</td>
<td>不支持该HTTP方法</td>
</tr>
<tr>
<td><strong>429</strong></td>
<td>4xx客户端错误</td>
<td>Too Many Requests</td>
<td>请求过于频繁（限流）</td>
</tr>
<tr>
<td><strong>500</strong></td>
<td>5xx服务器错误</td>
<td>Internal Server Error</td>
<td>服务器内部错误</td>
</tr>
<tr>
<td><strong>502</strong></td>
<td>5xx服务器错误</td>
<td>Bad Gateway</td>
<td>网关错误（反向代理后端出错）</td>
</tr>
<tr>
<td><strong>503</strong></td>
<td>5xx服务器错误</td>
<td>Service Unavailable</td>
<td>服务不可用（维护中或过载）</td>
</tr>
<tr>
<td><strong>504</strong></td>
<td>5xx服务器错误</td>
<td>Gateway Timeout</td>
<td>网关超时（后端响应超时）</td>
</tr>
</tbody></table>
<p><strong>状态码分类说明</strong>：</p>
<ul>
<li><strong>1xx（信息性）</strong>：请求已接收，继续处理</li>
<li><strong>2xx（成功）</strong>：请求成功处理</li>
<li><strong>3xx（重定向）</strong>：需要进一步操作完成请求</li>
<li><strong>4xx（客户端错误）</strong>：请求有问题，服务器拒绝处理</li>
<li><strong>5xx（服务器错误）</strong>：服务器处理请求时出错</li>
</ul>
<p>例如：</p>
<p><img src="/./imgs/image-20251104192231503.png" alt="image-20251104192231503"></p>
<p><strong>高频状态码：</strong></p>
<p><strong>301永久重定向</strong></p>
<p><strong>Moved Permanently永久搬家”这个页面永久换地址了”</strong></p>
<p><strong>302临时重定向</strong></p>
<p><strong>Moved Permanently永久搬家”这个页面永久换地址了”</strong></p>
<p><strong>403</strong></p>
<p><strong>如果用户访问的URL 路径可以找到匹配的location但是匹配不到具体的网页文件则会报403</strong></p>
<p><strong>404</strong> </p>
<p><strong>如果用户访问的URL 路径没有办法在nginx配置文件中找到能匹配的location 则会报404</strong></p>
<p><strong>503</strong></p>
<p><strong>服务器繁忙</strong></p>
<p><strong>面试题</strong>：503可能是哪些原因，怎么判断怎么做？</p>
<h2 id="三、Nginx服务"><a href="#三、Nginx服务" class="headerlink" title="三、Nginx服务"></a>三、Nginx服务</h2><h3 id="3-1-什么是Nginx"><a href="#3-1-什么是Nginx" class="headerlink" title="3.1 什么是Nginx"></a>3.1 什么是Nginx</h3><p><strong>Nginx</strong>是一款高性能、轻量级的开源Web服务器和<strong>反向代理</strong>服务器，具有以下特点：</p>
<ul>
<li><strong>高性能</strong>：采用事件驱动架构，支持高并发连接</li>
<li><strong>轻量级</strong>：占用资源少，内存占用低</li>
<li><strong>高可用</strong>：支持反向代理、负载均衡、故障转移</li>
<li><strong>模块化</strong>：功能通过模块系统灵活扩展</li>
<li><strong>跨平台</strong>：支持Linux、Windows、Mac等多个平台</li>
</ul>
<p><strong>主要用途</strong>：</p>
<ol>
<li>Web服务器：托管静态网站</li>
<li><strong>反向代理（用于接收客户端的请求并将其转发给内部的目标服务器）</strong>：后端服务隐藏，提升安全性</li>
<li>负载均衡：分散流量到多个后端服务器</li>
<li>缓存加速：提升访问速度</li>
</ol>
<h3 id="3-2-Nginx核心概念"><a href="#3-2-Nginx核心概念" class="headerlink" title="3.2 Nginx核心概念"></a>3.2 Nginx核心概念</h3><h4 id="版本号解读"><a href="#版本号解读" class="headerlink" title="版本号解读"></a>版本号解读</h4><p>如 <code>nginx-1.20.2</code></p>
<ul>
<li>第一位数字：大版本（功能迭代）</li>
<li>第二位数字：小版本（功能改进）</li>
<li>第三位数字：修订版本（补丁更新）</li>
</ul>
<p><img src="/./imgs/image-20251104192457951.png" alt="image-20251104192457951"></p>
<h4 id="边界设备"><a href="#边界设备" class="headerlink" title="边界设备"></a>边界设备</h4><p>与外界交互的设备，通常指Nginx在企业网络中的位置</p>
<p><img src="/./imgs/image-20251104193013021.png" alt="image-20251104193013021"></p>
<h4 id="工作进程模型"><a href="#工作进程模型" class="headerlink" title="工作进程模型"></a>工作进程模型</h4><p>Nginx采用<strong>Master-Worker进程模型</strong>：</p>
<ul>
<li><strong>Master进程</strong>：监听端口、管理Worker进程、处理信号</li>
<li><strong>Worker进程</strong>：实际处理客户端请求和响应</li>
</ul>
<p><img src="/./imgs/image-20251106091943151.png" alt="image-20251106091943151"></p>
<h4 id="并发处理能力"><a href="#并发处理能力" class="headerlink" title="并发处理能力"></a>并发处理能力</h4><p><strong>计算公式</strong>：最大同时处理请求数 &#x3D; <code>worker_processes</code> × <code>worker_connections</code></p>
<p><strong>示例</strong>：</p>
<ul>
<li>2个Worker进程，每个最大1024连接</li>
<li>最多可处理 2 × 1024 &#x3D; 2048个并发请求</li>
</ul>
<p><img src="/./imgs/image-20251106092130790.png" alt="image-20251106092130790"></p>
<h4 id="静态资源与动态资源"><a href="#静态资源与动态资源" class="headerlink" title="静态资源与动态资源"></a>静态资源与动态资源</h4><table>
<thead>
<tr>
<th>类型</th>
<th>定义</th>
<th>特点</th>
<th>例子</th>
<th>Nginx处理方式</th>
</tr>
</thead>
<tbody><tr>
<td><strong>静态资源</strong></td>
<td>内容不变的文件资源</td>
<td>不需要服务器处理，可直接返回</td>
<td>HTML、CSS、JavaScript、图片、视频</td>
<td>直接返回（高效）</td>
</tr>
<tr>
<td><strong>动态资源</strong></td>
<td>需要服务器实时计算的内容</td>
<td>每次请求可能返回不同内容</td>
<td>数据库查询结果、登录认证、用户信息</td>
<td>反向代理转发给后端应用处理</td>
</tr>
</tbody></table>
<p><strong>Nginx的角色</strong>：</p>
<ul>
<li>处理所有静态资源的请求，快速返回结果</li>
<li>遇到动态请求时，通过反向代理转发给后端应用（如Java、Python等）处理</li>
<li>这样充分发挥Nginx高性能的优势，同时让后端专注于业务逻辑</li>
</ul>
<h4 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h4><p>（默认安装在 <code>/usr/local/nginx</code>）：</p>
<ul>
<li><code>conf/</code>：配置文件目录（nginx.conf为核心配置）</li>
<li><code>html/</code>：存放网页文件</li>
<li><code>logs/</code>：日志文件（access.log、error.log）</li>
<li><code>sbin/</code>：可执行文件，一般存命令</li>
</ul>
<h4 id="⭐工作原理图（数据流向）"><a href="#⭐工作原理图（数据流向）" class="headerlink" title="⭐工作原理图（数据流向）"></a>⭐工作原理图（数据流向）</h4><p><img src="/./imgs/image-20251106094738827.png" alt="image-20251106094738827"></p>
<p><strong>① 在浏览器中输入URL</strong></p>
<p>用户在Windows系统的浏览器中输入URL地址（如<code>http://www.qidian.com/book/1046336776/</code>），这是整个访问流程的起点。</p>
<p><strong>② 三握（DNS解析和网络连接）</strong></p>
<ul>
<li>浏览器通过DNS服务器将域名解析为IP地址</li>
<li>建立TCP连接（三次握手）</li>
</ul>
<p><strong>③ 监听到请求</strong></p>
<ul>
<li>Nginx主进程（ng-master）监听80端口，接收客户端请求</li>
</ul>
<p><strong>④ fork子进程</strong></p>
<ul>
<li>主进程创建worker子进程来处理实际任务</li>
</ul>
<p><strong>⑤ 子进程匹配规则</strong></p>
<ul>
<li>worker进程根据Nginx配置文件中的规则进行匹配，决定如何处理请求（动静资源，ng处理静态，后端处理动态）</li>
</ul>
<p><strong>⑥ 处理数据</strong></p>
<ul>
<li>如果用户请求的数据过大，服务端会从磁盘读取、压缩、存放在缓存中</li>
</ul>
<p><strong>⑦ 用户下载页面文件及其他数据</strong></p>
<ul>
<li>服务器将响应数据返回给客户端</li>
</ul>
<p><strong>⑧ 浏览器缓存</strong></p>
<ul>
<li>浏览器将收到的页面和资源存储在本地缓存中，下次访问时可直接使用</li>
</ul>
<h3 id="3-3-Nginx源码编译安装"><a href="#3-3-Nginx源码编译安装" class="headerlink" title="3.3 Nginx源码编译安装"></a>3.3 Nginx源码编译安装</h3><h4 id="手工编译-源码编译安装一个服务的基本流程"><a href="#手工编译-源码编译安装一个服务的基本流程" class="headerlink" title="手工编译&#x2F;源码编译安装一个服务的基本流程"></a>手工编译&#x2F;源码编译安装一个服务的基本流程</h4><p>1、关闭防火墙、核心防护 (DNS解析需要配置)</p>
<p>2、安装依赖环境</p>
<p>3、上传并解压缩源码包tar.gz</p>
<p>4、进入解压后的目录，执行configure 的配置动作</p>
<p>5、make &amp;&amp; make install 执行编译与编译安装动作</p>
<p>6、检查是否安装完成(到&#x2F;usr&#x2F;local&#x2F;nginx的工作目录中查看一下)</p>
<p>7、添加给systemd工具识别，让我们&#x2F;系统可以使用systemctl start&#x2F;stop&#x2F;status 管理服务</p>
<p>8、使用浏览器访问页面，验证是否成功</p>
<h5 id="安装前准备"><a href="#安装前准备" class="headerlink" title="安装前准备"></a>安装前准备</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.关闭防火墙</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line">setenforce 0</span><br></pre></td></tr></table></figure>

<p><img src="/./imgs/image-20251104193742793.png" alt="image-20251104193742793"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2.安装依赖包</span></span><br><span class="line"><span class="comment"># nginx的配置及运行需要pcre、zlib等软件包支持，用于提供库和头文件</span></span><br><span class="line">yum install -y gcc gcc-c++ make pcre pcre-devel zlib zlib-devel openssl openssl-devel</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建运行用户（Nginx默认以nobody身份运行，建议创建专门的用户账号以控制权限）</span></span><br><span class="line">useradd -M -s /sbin/nologin nginx</span><br></pre></td></tr></table></figure>

<h5 id="下载与配置"><a href="#下载与配置" class="headerlink" title="下载与配置"></a>下载与配置</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3.下载Nginx源码包</span></span><br><span class="line"><span class="comment"># 方法一 wget网上下载</span></span><br><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line">wget https://nginx.org/download/nginx-1.20.2.tar.gz</span><br><span class="line">tar zxvf nginx-1.20.2.tar.gz</span><br><span class="line"><span class="comment"># 方法二 自行准备</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.进入源码目录并配置</span></span><br><span class="line"><span class="built_in">cd</span> nginx-1.20.2/</span><br><span class="line">./configure \</span><br><span class="line">  --prefix=/usr/local/nginx \                <span class="comment"># 指定安装路径</span></span><br><span class="line">  --user=nginx \                             <span class="comment"># 指定运行用户</span></span><br><span class="line">  --group=nginx \                            <span class="comment"># 指定运行用户组</span></span><br><span class="line">  --with-http_stub_status_module \           <span class="comment"># 启用状态统计模块</span></span><br><span class="line">  --with-http_ssl_module                     <span class="comment"># 启用HTTPS支持</span></span><br></pre></td></tr></table></figure>

<p><img src="/./imgs/image-20251104194028945.png" alt="image-20251104194028945"></p>
<h5 id="编译与安装"><a href="#编译与安装" class="headerlink" title="编译与安装"></a>编译与安装</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 5.编译并安装</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建软连接，让系统识别nginx命令</span></span><br><span class="line"><span class="built_in">ln</span> -s /usr/local/nginx/sbin/nginx /usr/local/sbin/</span><br></pre></td></tr></table></figure>

<blockquote>
<p>创建软连接命令是为了让系统能识别nginx的命令</p>
<p>which从$PATH目录中去寻找可执行文件</p>
</blockquote>
<p><img src="/./imgs/image-20251104194142084.png" alt="image-20251104194142084"></p>
<h5 id="验证与启动"><a href="#验证与启动" class="headerlink" title="验证与启动"></a>验证与启动</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 6.检查配置文件是否正确</span></span><br><span class="line">nginx -t</span><br><span class="line"><span class="comment"># 启动Nginx</span></span><br><span class="line">nginx</span><br><span class="line"><span class="comment"># 查看版本/编译参数</span></span><br><span class="line">nginx -v</span><br></pre></td></tr></table></figure>

<p><img src="/./imgs/image-20251104194443707.png" alt="image-20251104194443707"></p>
<h4 id="企业级完整配置参考"><a href="#企业级完整配置参考" class="headerlink" title="企业级完整配置参考"></a>企业级完整配置参考</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">./configure \</span><br><span class="line">  --prefix=/usr/local/nginx \                   <span class="comment"># 安装目录</span></span><br><span class="line">  --user=nginx \                                <span class="comment"># 运行用户</span></span><br><span class="line">  --group=nginx \                               <span class="comment"># 运行用户组</span></span><br><span class="line">  --with-http_ssl_module \                      <span class="comment"># HTTPS支持</span></span><br><span class="line">  --with-http_v2_module \                       <span class="comment"># HTTP/2协议（提升性能）</span></span><br><span class="line">  --with-http_gzip_static_module \              <span class="comment"># 静态gzip压缩</span></span><br><span class="line">  --with-http_stub_status_module \              <span class="comment"># 状态监控模块</span></span><br><span class="line">  --with-pcre \                                 <span class="comment"># PCRE正则支持</span></span><br><span class="line">  --with-stream \                               <span class="comment"># TCP代理模块</span></span><br><span class="line">  --with-stream_ssl_module \                    <span class="comment"># TCP代理SSL支持</span></span><br><span class="line">  --http-log-path=/var/log/nginx/access.log \   <span class="comment"># 访问日志路径</span></span><br><span class="line">  --error-log-path=/var/log/nginx/error.log \   <span class="comment"># 错误日志路径</span></span><br><span class="line">  --pid-path=/var/run/nginx/nginx.pid \         <span class="comment"># PID文件路径</span></span><br><span class="line">  --lock-path=/var/lock/nginx.lock              <span class="comment"># 锁文件路径</span></span><br></pre></td></tr></table></figure>

<h3 id="拓展：添加为系统服务"><a href="#拓展：添加为系统服务" class="headerlink" title="拓展：添加为系统服务"></a>拓展：添加为系统服务</h3><p><strong>方法一：使用init.d脚本(较老，不推荐)</strong></p>
<p>创建文件 <code>/etc/init.d/nginx</code>，使用 <code>service</code> 命令管理</p>
<p><strong>方法二：使用systemd服务（推荐）</strong></p>
<p>创建文件 <code>/lib/systemd/system/nginx.service</code>：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=nginx</span><br><span class="line"><span class="attr">After</span>=network.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=forking</span><br><span class="line"><span class="attr">PIDFile</span>=/usr/local/nginx/logs/nginx.pid</span><br><span class="line"><span class="attr">ExecStart</span>=/usr/local/nginx/sbin/nginx</span><br><span class="line"><span class="attr">ExecReload</span>=/bin/kill -s HUP <span class="variable">$MAINPID</span></span><br><span class="line"><span class="attr">ExecStop</span>=/bin/kill -s QUIT <span class="variable">$MAINPID</span></span><br><span class="line"><span class="attr">PrivateTmp</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure>

<p>启用服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 754 /lib/systemd/system/nginx.service</span><br><span class="line">systemctl start nginx.service</span><br><span class="line">systemctl <span class="built_in">enable</span> nginx.service      <span class="comment"># 开机自启</span></span><br><span class="line">systemctl restart nginx.service</span><br></pre></td></tr></table></figure>

<p><img src="/./imgs/image-20251104194835197.png" alt="image-20251104194835197"></p>
<p><strong>注意</strong>：nginx和systemd的运作方式不同，所以可能会出现nginx启动后，systemd现实不一致的问题</p>
<p><img src="/./imgs/image-20251104195000501.png" alt="image-20251104195000501"></p>
<h3 id="3-4-⭐Nginx配置文件详解"><a href="#3-4-⭐Nginx配置文件详解" class="headerlink" title="3.4 ⭐Nginx配置文件详解"></a>3.4 ⭐Nginx配置文件详解</h3><p><strong>nginx.conf核心配置文件位置</strong>：<code>/usr/local/nginx/conf/nginx.conf</code></p>
<p><img src="/./imgs/image-20251104195044539.png" alt="image-20251104195044539"></p>
<h4 id="一、全局块（Global-Context）"><a href="#一、全局块（Global-Context）" class="headerlink" title="一、全局块（Global Context）"></a>一、全局块（Global Context）</h4><p>处理Nginx全局相关的配置参数：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">user</span> nginx;                    <span class="comment"># 运行用户（影响文件访问权限）</span></span><br><span class="line"><span class="attribute">worker_processes</span> <span class="number">2</span>;            <span class="comment"># 工作进程数（建议设为CPU核心数的2倍）</span></span><br><span class="line"><span class="attribute">error_log</span> logs/<span class="literal">error</span>.log <span class="literal">warn</span>; <span class="comment"># 错误日志路径和级别</span></span><br><span class="line"><span class="attribute">pid</span> logs/nginx.pid;            <span class="comment"># PID文件路径</span></span><br></pre></td></tr></table></figure>

<p><strong>日志级别</strong>（从低到高）：debug → info → notice → warn → error → crit → alert → emerg</p>
<h4 id="二、events块（Events-Context）"><a href="#二、events块（Events-Context）" class="headerlink" title="二、events块（Events Context）"></a>二、events块（Events Context）</h4><p>配置Nginx如何处理连接：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span> <span class="number">1024</span>;   <span class="comment"># 单个工作进程最大连接数</span></span><br><span class="line">    <span class="attribute">use</span> <span class="literal">epoll</span>;                 <span class="comment"># Linux上推荐使用epoll模型</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>说明</strong>：</p>
<ul>
<li><code>worker_connections</code> 决定单个Worker进程能同时处理的连接数</li>
<li>总并发数 &#x3D; worker_processes × worker_connections</li>
</ul>
<h4 id="三、http块（HTTP-Context）"><a href="#三、http块（HTTP-Context）" class="headerlink" title="三、http块（HTTP Context）"></a>三、http块（HTTP Context）</h4><p>定义HTTP服务的全局参数，包含server块和upstream块：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span> mime.types;                    <span class="comment"># 引入MIME类型定义</span></span><br><span class="line">    <span class="attribute">default_type</span> application/octet-stream; <span class="comment"># 默认类型</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 日志格式定义（内置变量）</span></span><br><span class="line">    <span class="attribute">log_format</span> main <span class="string">&#x27;<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] &quot;<span class="variable">$request</span>&quot; &#x27;</span></span><br><span class="line">                    <span class="string">&#x27;<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> &quot;<span class="variable">$http_referer</span>&quot; &#x27;</span></span><br><span class="line">                    <span class="string">&#x27;&quot;<span class="variable">$http_user_agent</span>&quot; &quot;<span class="variable">$http_x_forwarded_for</span>&quot;&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">access_log</span> logs/access.log main;  <span class="comment"># 访问日志</span></span><br><span class="line">    </span><br><span class="line">    <span class="attribute">sendfile</span> <span class="literal">on</span>;               <span class="comment"># 启用零复制发送文件（提高性能）</span></span><br><span class="line">    <span class="attribute">keepalive_timeout</span> <span class="number">65</span>;      <span class="comment"># 长连接保活时间</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>常用内置变量</strong>：</p>
<table>
<thead>
<tr>
<th>变量</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>$remote_addr</code></td>
<td>客户端IP地址</td>
</tr>
<tr>
<td><code>$remote_user</code></td>
<td>客户端用户名</td>
</tr>
<tr>
<td><code>$time_local</code></td>
<td>请求的本地时间</td>
</tr>
<tr>
<td><code>$request</code></td>
<td>完整的HTTP请求行</td>
</tr>
<tr>
<td><code>$status</code></td>
<td>HTTP响应状态码</td>
</tr>
<tr>
<td><code>$body_bytes_sent</code></td>
<td>发送给客户端的字节数</td>
</tr>
<tr>
<td><code>$http_referer</code></td>
<td>HTTP请求来源页面</td>
</tr>
<tr>
<td><code>$http_user_agent</code></td>
<td>客户端浏览器信息</td>
</tr>
</tbody></table>
<h4 id="四、server块（Server-Context）"><a href="#四、server块（Server-Context）" class="headerlink" title="四、server块（Server Context）"></a>四、server块（Server Context）</h4><p>定义虚拟主机，处理特定的客户端请求：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;                       <span class="comment"># 监听的端口号</span></span><br><span class="line">    <span class="attribute">server_name</span> www.example.com;     <span class="comment"># 虚拟主机名称（域名）</span></span><br><span class="line">    <span class="attribute">charset</span> utf-<span class="number">8</span>;                   <span class="comment"># 字符编码（防止中文乱码）</span></span><br><span class="line">    </span><br><span class="line">    <span class="section">location</span> / &#123;                     <span class="comment"># 路由配置（匹配URL路径）</span></span><br><span class="line">        <span class="attribute">root</span> html;                   <span class="comment"># 文档根目录（相对路径：./nginx/html）</span></span><br><span class="line">        <span class="attribute">index</span> index.html index.htm;  <span class="comment"># 默认文件</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">error_page</span> <span class="number">404</span> /<span class="number">404</span>.html;        <span class="comment"># 自定义错误页面</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>location匹配规则</strong>： 匹配URL路径—》① proxy_pass路径的跳转 ② 页面文件的匹配 ③ 功能的使用（例如stub_status_module）</p>
<ul>
<li><code>location /</code> ：匹配所有请求的根路径</li>
<li><code>location /app</code> ：匹配以&#x2F;app开头的路径</li>
<li><code>location /status</code> ：精确匹配&#x2F;status路径</li>
</ul>
<p><strong>location的一般三种匹配用途</strong></p>
<p>① 首页（根）匹配</p>
<p>② 静态匹配</p>
<p>③ 动态匹配</p>
<p><strong>实际网站使用建议</strong></p>
<p><strong>一、根目录首页匹配</strong></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> = / &#123;</span><br><span class="line">    <span class="attribute">root</span> html;</span><br><span class="line">    <span class="attribute">index</span> index.html index.htm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>加速处理官网首页访问。<br><strong>二、静态文件请求处理</strong></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span><span class="regexp"> ^~</span> /static/ &#123;</span><br><span class="line">    <span class="attribute">root</span> /webroot/;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">location</span> <span class="regexp">~* \.(gif|jpg|jpeg|png|css|js|ico)$</span> &#123;</span><br><span class="line">    <span class="attribute">root</span> /webroot/res/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>利用 Nginx 处理静态文件的优势。<br><strong>三、动态页面请求转发</strong></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">    <span class="attribute">fastcgi_pass</span> php_server:<span class="number">9000</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">location</span> <span class="regexp">~ \.jsp$</span> &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://tomcat_server;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将动态请求转发至后端应用服务器处理。</p>
<p><strong>URL访问解析</strong>：</p>
<p>以 <code>http://192.168.110.128/index2.html</code> 为例：</p>
<ul>
<li><code>http://</code> ：固定格式（协议）</li>
<li><code>192.168.110.128</code> ：访问的IP或域名</li>
<li><code>/</code> ：网页文件根路径（表示以 <code>./nginx/html/</code> 为起始）</li>
<li><code>index2.html</code> ：网页文件路径</li>
</ul>
<h4 id="配置文件完整分析表"><a href="#配置文件完整分析表" class="headerlink" title="配置文件完整分析表"></a>配置文件完整分析表</h4><table>
<thead>
<tr>
<th>配置项</th>
<th>所在块</th>
<th>说明</th>
<th>参数示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>user</code></td>
<td>全局块</td>
<td>运行Nginx的用户，影响文件访问权限</td>
<td><code>nginx</code></td>
</tr>
<tr>
<td>⭐<code>worker_processes</code></td>
<td>全局块</td>
<td>工作进程数，建议设为CPU核心数的2倍</td>
<td><code>2</code> 或 <code>auto</code></td>
</tr>
<tr>
<td><code>error_log</code></td>
<td>全局块</td>
<td>错误日志路径和级别</td>
<td><code>logs/error.log warn</code></td>
</tr>
<tr>
<td><code>worker_connections</code></td>
<td>events块</td>
<td>单个进程最大连接数</td>
<td><code>1024</code></td>
</tr>
<tr>
<td><code>use</code></td>
<td>events块</td>
<td>连接处理模型</td>
<td><code>epoll</code></td>
</tr>
<tr>
<td><code>log_format</code></td>
<td>http块</td>
<td>日志格式定义</td>
<td>-</td>
</tr>
<tr>
<td><code>access_log</code></td>
<td>http块</td>
<td>访问日志文件</td>
<td><code>logs/access.log main</code></td>
</tr>
<tr>
<td><code>sendfile</code></td>
<td>http块</td>
<td>是否启用零复制</td>
<td><code>on</code> 或 <code>off</code></td>
</tr>
<tr>
<td><code>listen</code></td>
<td>server块</td>
<td>监听的端口号</td>
<td><code>80</code></td>
</tr>
<tr>
<td><code>server_name</code></td>
<td>server块</td>
<td>虚拟主机名称</td>
<td><code>www.example.com</code></td>
</tr>
<tr>
<td><code>charset</code></td>
<td>server块</td>
<td>字符编码</td>
<td><code>utf-8</code></td>
</tr>
<tr>
<td><code>location</code></td>
<td>server块</td>
<td>路由规则</td>
<td><code>location /api</code></td>
</tr>
<tr>
<td><code>root</code></td>
<td>location块</td>
<td>文档根目录</td>
<td><code>html</code></td>
</tr>
<tr>
<td><code>index</code></td>
<td>location块</td>
<td>默认文件</td>
<td><code>index.html</code></td>
</tr>
<tr>
<td><code>proxy_pass</code></td>
<td>location块</td>
<td>反向代理目标</td>
<td><code>http://127.0.0.1:8080</code></td>
</tr>
</tbody></table>
<hr>
<h3 id="3-5-Nginx反向代理和负载均衡"><a href="#3-5-Nginx反向代理和负载均衡" class="headerlink" title="3.5 Nginx反向代理和负载均衡"></a>3.5 Nginx反向代理和负载均衡</h3><h4 id="什么是代理"><a href="#什么是代理" class="headerlink" title="什么是代理"></a>什么是代理</h4><p><strong>代理</strong>是指一个服务充当中介，代表另一方进行通信。在网络中，代理服务器位于客户端和服务器之间，转发双方的请求和响应。</p>
<h4 id="什么是反向代理"><a href="#什么是反向代理" class="headerlink" title="什么是反向代理"></a>什么是反向代理</h4><p><strong>反向代理</strong>是指Nginx代理后端服务器，接收客户端请求并转发给后端，再将响应返回给客户端。客户端不知道真实的后端服务器地址。</p>
<p><strong>反向代理的作用</strong>：</p>
<ul>
<li>隐藏后端服务器真实IP和架构</li>
<li>提升安全性（后端服务器不直接暴露）</li>
<li>可以实现负载均衡</li>
<li>可以进行请求过滤和转发</li>
</ul>
<p><strong>与正向代理的区别</strong>：</p>
<ul>
<li><strong>正向代理</strong>：代理客户端，服务器不知道真实客户端（如VPN）</li>
<li><strong>反向代理</strong>：代理服务器，客户端不知道真实服务器</li>
</ul>
<h4 id="基础反向代理配置"><a href="#基础反向代理配置" class="headerlink" title="基础反向代理配置"></a>基础反向代理配置</h4><blockquote>
<p>http块中设置upstream后端地址池</p>
<p>server块location中设置proxy_pass代理_地址池</p>
</blockquote>
<p>使用 <code>proxy_pass</code> 指令将请求转发到后端服务器：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> www.example.com;</span><br><span class="line">    </span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="comment"># 将请求转发到后端服务器</span></span><br><span class="line">        <span class="attribute">proxy_pass</span> http://192.168.110.101:8080;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 保留原始客户端IP信息</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/./imgs/image-20251106184805740.png" alt="image-20251106184805740"></p>
<p><strong>常用proxy相关指令</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">指令说明示例</span><br><span class="line">proxy_pass转发请求到后端服务器proxy_pass http://backend:8080;</span><br><span class="line">proxy_set_header设置转发时的请求头proxy_set_header Host $host;</span><br><span class="line">proxy_connect_timeout连接后端超时时间proxy_connect_timeout 60s;</span><br><span class="line">proxy_send_timeout向后端发送数据的超时时间proxy_send_timeout 60s;</span><br><span class="line">proxy_read_timeout接收后端数据的超时时间proxy_read_timeout 60s;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="什么是负载均衡"><a href="#什么是负载均衡" class="headerlink" title="什么是负载均衡"></a>什么是负载均衡</h4><p><strong>负载均衡</strong>是将客户端请求分散到多个后端服务器处理，提高系统整体性能和可用性。</p>
<p><strong>负载均衡的作用</strong>：</p>
<ul>
<li>分散流量，避免单个服务器过载</li>
<li>提高系统容错能力（某个服务器故障不影响整体）</li>
<li>提升响应速度和用户体验</li>
<li>实现高可用架构</li>
</ul>
<h4 id="upstream块配置"><a href="#upstream块配置" class="headerlink" title="upstream块配置"></a>upstream块配置</h4><p>使用 <code>upstream</code> 定义后端服务器集群，结合 <code>proxy_pass</code> 实现负载均衡：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="comment"># 定义后端服务器集群</span></span><br><span class="line">    <span class="section">upstream</span> backend_servers &#123;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">192.168.110.101:8080</span>;  <span class="comment"># 后端服务器1</span></span><br><span class="line">        <span class="attribute">server</span> <span class="number">192.168.110.102:8080</span>;  <span class="comment"># 后端服务器2</span></span><br><span class="line">        <span class="attribute">server</span> <span class="number">192.168.110.103:8080</span>;  <span class="comment"># 后端服务器3</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span> www.example.com;</span><br><span class="line">        </span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="comment"># 使用proxy_pass转发请求到upstream定义的服务器组</span></span><br><span class="line">            <span class="attribute">proxy_pass</span> http://backend_servers;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 反向代理相关配置</span></span><br><span class="line">            <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="负载均衡调度算法"><a href="#负载均衡调度算法" class="headerlink" title="负载均衡调度算法"></a>负载均衡调度算法</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">算法说明应用场景</span><br><span class="line">轮询（默认）按顺序轮流转发请求服务器性能相同</span><br><span class="line">权重（weight）根据权重比例转发服务器性能不同</span><br><span class="line">IP哈希（ip_hash）同一客户端IP总是转发到同一服务器需要会话保持</span><br><span class="line">最少连接（least_conn）优先转发到连接数少的服务器长连接应用</span><br></pre></td></tr></table></figure>

<h4 id="调度算法配置示例"><a href="#调度算法配置示例" class="headerlink" title="调度算法配置示例"></a>调度算法配置示例</h4><p><strong>轮询配置</strong>（默认）：<strong>Round Robin</strong></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> backend_servers &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.110.101:8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.110.102:8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.110.103:8080</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>权重配置</strong>（服务器性能不同）：<strong>Weighted Round Robin</strong></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> backend_servers &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.110.101:8080</span> weight=<span class="number">5</span>;  <span class="comment"># 该服务器处理5份请求</span></span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.110.102:8080</span> weight=<span class="number">3</span>;  <span class="comment"># 该服务器处理3份请求</span></span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.110.103:8080</span> weight=<span class="number">2</span>;  <span class="comment"># 该服务器处理2份请求</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>IP哈希配置</strong>（会话保持）：</p>
<p>是实现会话保持的一种机制，减轻压力和给用户更好的体验，没有做到负载均衡</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> backend_servers &#123;</span><br><span class="line">    ip_hash;  <span class="comment"># 启用IP哈希算法，同一客户端IP的请求总是转发到同一服务器</span></span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.110.101:8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.110.102:8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.110.103:8080</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>最少连接配置</strong>：<strong>Least Connections</strong></p>
<p>谁活少给谁多分配</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> backend_servers &#123;</span><br><span class="line">    least_conn;  <span class="comment"># 启用最少连接算法，优先转发到连接数少的服务器</span></span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.110.101:8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.110.102:8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.110.103:8080</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="故障转移与健康检测"><a href="#故障转移与健康检测" class="headerlink" title="故障转移与健康检测"></a>故障转移与健康检测</h4><p>Nginx可以自动检测后端服务器故障并转移流量：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> backend_servers &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.110.101:8080</span> max_fails=<span class="number">3</span> fail_timeout=<span class="number">30s</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.110.102:8080</span> max_fails=<span class="number">3</span> fail_timeout=<span class="number">30s</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.110.103:8080</span> backup;  <span class="comment"># 备用服务器（其他服务器都不可用时才使用）</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>参数说明</strong>：</p>
<ul>
<li><code>max_fails</code>：最大失败次数，超过该次数则标记为不可用（默认1）</li>
<li><code>fail_timeout</code>：失败次数计数的时间窗口（默认10s）</li>
<li><code>backup</code>：备用服务器标记，仅当其他服务器都不可用时才使用</li>
</ul>
<h4 id="完整的反向代理-负载均衡配置示例"><a href="#完整的反向代理-负载均衡配置示例" class="headerlink" title="完整的反向代理+负载均衡配置示例"></a>完整的反向代理+负载均衡配置示例</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="comment"># 定义后端服务器集群（带权重和故障转移）</span></span><br><span class="line">    <span class="section">upstream</span> backend_servers &#123;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">192.168.110.101:8080</span> weight=<span class="number">5</span> max_fails=<span class="number">3</span> fail_timeout=<span class="number">30s</span>;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">192.168.110.102:8080</span> weight=<span class="number">3</span> max_fails=<span class="number">3</span> fail_timeout=<span class="number">30s</span>;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">192.168.110.103:8080</span> weight=<span class="number">2</span> backup;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span> www.example.com;</span><br><span class="line">        </span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="comment"># 反向代理转发</span></span><br><span class="line">            <span class="attribute">proxy_pass</span> http://backend_servers;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 保留原始客户端信息</span></span><br><span class="line">            <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 超时配置</span></span><br><span class="line">            <span class="attribute">proxy_connect_timeout</span> <span class="number">60s</span>;</span><br><span class="line">            <span class="attribute">proxy_send_timeout</span> <span class="number">60s</span>;</span><br><span class="line">            <span class="attribute">proxy_read_timeout</span> <span class="number">60s</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-6-Nginx虚拟主机配置"><a href="#3-6-Nginx虚拟主机配置" class="headerlink" title="3.6 Nginx虚拟主机配置"></a>3.6 Nginx虚拟主机配置</h3><p>Nginx支持多种虚拟主机方式，实现在一台服务器上运行多个网站：</p>
<h4 id="3-6-1-基于域名的虚拟主机（最常用）"><a href="#3-6-1-基于域名的虚拟主机（最常用）" class="headerlink" title="3.6.1 基于域名的虚拟主机（最常用）"></a>3.6.1 基于域名的虚拟主机（最常用）</h4><p>通过不同的 <code>server_name</code> 区分不同网站：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> www.baozi.com;</span><br><span class="line">    <span class="attribute">root</span> /var/www/baozi;</span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">index</span> index.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> www.cat.com;</span><br><span class="line">    <span class="attribute">root</span> /var/www/cat;</span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">index</span> index.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>客户端配置</strong>：需要在 <code>/etc/hosts</code> 中添加映射关系：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">192.168.110.128 www.baozi.com</span><br><span class="line">192.168.110.128 www.cat.com</span><br></pre></td></tr></table></figure>

<p><img src="/./imgs/image-20251106093145778.png" alt="image-20251106093145778"></p>
<p><img src="/./imgs/image-20251106093152307.png" alt="image-20251106093152307"></p>
<h4 id="3-6-2-基于IP的虚拟主机"><a href="#3-6-2-基于IP的虚拟主机" class="headerlink" title="3.6.2 基于IP的虚拟主机"></a>3.6.2 基于IP的虚拟主机</h4><p>通过不同的IP地址区分不同网站，需要服务器配置<strong>多块网卡或虚拟IP</strong>：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">192.168.110.128:80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> www.baozi.com;</span><br><span class="line">    <span class="attribute">root</span> /var/www/baozi;</span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">index</span> index.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">192.168.110.129:80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> www.cat.com;</span><br><span class="line">    <span class="attribute">root</span> /var/www/cat;</span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">index</span> index.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/./imgs/image-20251106093203250.png" alt="image-20251106093203250"></p>
<p><img src="/./imgs/image-20251106093213769.png" alt="image-20251106093213769"></p>
<p><img src="/./imgs/image-20251106093221633.png" alt="image-20251106093221633"></p>
<h4 id="3-6-3-基于端口的虚拟主机"><a href="#3-6-3-基于端口的虚拟主机" class="headerlink" title="3.6.3 基于端口的虚拟主机"></a>3.6.3 基于端口的虚拟主机</h4><p>通过不同的<strong>端口号</strong>区分不同网站：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> www.baozi.com;</span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">index</span> index.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">server_name</span> www.cat.com;</span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">index</span> index.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-6-4-动静分离配置"><a href="#3-6-4-动静分离配置" class="headerlink" title="3.6.4 动静分离配置"></a>3.6.4 动静分离配置</h4><p>Nginx处理静态资源，后端服务处理动态资源的完整配置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    upstream php_backend &#123;</span><br><span class="line">        server 192.168.110.101:8080;</span><br><span class="line">        server 192.168.110.102:8080;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name www.example.com;</span><br><span class="line">        </span><br><span class="line">        # 首页加速处理</span><br><span class="line">        location = / &#123;</span><br><span class="line">            root html;</span><br><span class="line">            index index.html;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        # 静态文件直接返回</span><br><span class="line">        location ^~ /static/ &#123;</span><br><span class="line">            root /webroot/;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        # 图片等资源设置缓存</span><br><span class="line">        location ~* \.(gif|jpg|jpeg|png|css|js|ico)$ &#123;</span><br><span class="line">            root /webroot/res/;</span><br><span class="line">            expires 1d;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        # 动态请求转发到后端</span><br><span class="line">        location ~ \.php$ &#123;</span><br><span class="line">            proxy_pass http://php_backend;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关键点：Nginx只负责转发+静态，业务逻辑交给后端处理</p>
<p>这里后端使用tomcat，tomcat是动态任务处理的一个服务端，主要作用是提供iava语言的运行环境，对前与nginx进行写作完成动-静分离,对后可以连接数据库，读&#x2F;写数据记录。</p>
<blockquote>
<p>配置文件在&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;conf&#x2F;server.xml</p>
<p>网页文件在&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps中</p>
</blockquote>
<h3 id="3-7-拓展配置"><a href="#3-7-拓展配置" class="headerlink" title="3.7 拓展配置"></a>3.7 拓展配置</h3><h4 id="3-7-1-访问控制"><a href="#3-7-1-访问控制" class="headerlink" title="3.7.1 访问控制"></a>3.7.1 访问控制</h4><p>Nginx可以通过 <code>allow</code> 和 <code>deny</code> 指令限制客户端访问：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">allow</span> <span class="number">192.168.110.91</span>;      <span class="comment"># 允许该IP访问</span></span><br><span class="line">    <span class="attribute">deny</span> <span class="number">192.168.110.90</span>;       <span class="comment"># 禁止该IP访问</span></span><br><span class="line">    <span class="attribute">deny</span> all;                  <span class="comment"># 其他IP都禁止</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/./imgs/image-20251106093524016.png" alt="image-20251106093524016"></p>
<p>90ip无法访问</p>
<p><img src="/./imgs/image-20251105161315922.png" alt="image-20251105161315922"></p>
<p>91ip可以</p>
<p><img src="/./imgs/image-20251105161344424.png" alt="image-20251105161344424"></p>
<h4 id="3-7-2-状态监控模块"><a href="#3-7-2-状态监控模块" class="headerlink" title="3.7.2 状态监控模块"></a>3.7.2 状态监控模块</h4><p>利用状态统计模块查看Nginx运行状态：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> www.cat.com;</span><br><span class="line">    </span><br><span class="line">    <span class="section">location</span> /status &#123;</span><br><span class="line">        <span class="attribute">stub_status</span> <span class="literal">on</span>;        <span class="comment"># 启用状态监控</span></span><br><span class="line">        <span class="attribute">access_log</span> <span class="literal">off</span>;        <span class="comment"># 不记录状态查询日志</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>访问 <code>http://www.cat.com/status</code> 可查看Nginx当前连接数、请求数等信息。</p>
<p><img src="/./imgs/image-20251106094018365.png" alt="image-20251106094018365"></p>
<h3 id="3-8-Nginx常用命令"><a href="#3-8-Nginx常用命令" class="headerlink" title="3.8 Nginx常用命令"></a>3.8 Nginx常用命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查配置</span></span><br><span class="line">nginx -t</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动</span></span><br><span class="line">nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止（优雅停止，等待现有连接完成）</span></span><br><span class="line"><span class="built_in">kill</span> -s QUIT $(<span class="built_in">cat</span> /usr/local/nginx/logs/nginx.pid)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 快速停止</span></span><br><span class="line"><span class="built_in">kill</span> -3 $(<span class="built_in">cat</span> /usr/local/nginx/logs/nginx.pid)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新加载配置（不中断服务）</span></span><br><span class="line"><span class="built_in">kill</span> -s HUP $(<span class="built_in">cat</span> /usr/local/nginx/logs/nginx.pid)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Nginx进程</span></span><br><span class="line">ps aux | grep nginx</span><br></pre></td></tr></table></figure>

<p><strong>常用信号说明</strong>：</p>
<table>
<thead>
<tr>
<th>信号</th>
<th>编号</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>QUIT</td>
<td>3</td>
<td>优雅退出</td>
</tr>
<tr>
<td>HUP</td>
<td>1</td>
<td>重新加载配置</td>
</tr>
<tr>
<td>USR1</td>
<td>10</td>
<td>日志分割，重新打开日志文件</td>
</tr>
<tr>
<td>USR2</td>
<td>12</td>
<td>平滑升级Nginx</td>
</tr>
<tr>
<td>TERM</td>
<td>15</td>
<td>正常终止进程</td>
</tr>
<tr>
<td>KILL</td>
<td>9</td>
<td>强制杀死进程</td>
</tr>
</tbody></table>
<h3 id="3-9-实战案例：搭建包子铺官网"><a href="#3-9-实战案例：搭建包子铺官网" class="headerlink" title="3.9 实战案例：搭建包子铺官网"></a>3.9 实战案例：搭建包子铺官网</h3><h4 id="业务需求"><a href="#业务需求" class="headerlink" title="业务需求"></a>业务需求</h4><p>某连锁包子店老板需要搭建官网，通过 <code>www.baozi.com</code> 访问公司官网，显示”505包子铺”，同时需要通过 <code>/status</code> 查看网站访问情况。</p>
<h4 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h4><p><strong>步骤1：创建网站文件目录</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /var/www/baozi</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;505包子铺&quot;</span> &gt; /var/www/baozi/index.html</span><br></pre></td></tr></table></figure>

<p><strong>步骤2：编辑Nginx配置文件</strong></p>
<p>编辑 <code>/usr/local/nginx/conf/nginx.conf</code>，添加server块：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> www.baozi.com;</span><br><span class="line">    <span class="attribute">charset</span> utf-<span class="number">8</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">root</span> /var/www/baozi;</span><br><span class="line">    </span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">index</span> index.html;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="section">location</span> /status &#123;</span><br><span class="line">        <span class="attribute">stub_status</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">access_log</span> <span class="literal">off</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>步骤3：在客户端配置域名解析</strong></p>
<p>编辑客户端 <code>/etc/hosts</code> 文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.110.128 www.baozi.com</span><br></pre></td></tr></table></figure>

<p><strong>步骤4：检查配置文件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -t</span><br></pre></td></tr></table></figure>

<p><strong>步骤5：重启Nginx服务</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart nginx.service</span><br></pre></td></tr></table></figure>

<p><strong>步骤6：访问验证</strong></p>
<ul>
<li>访问 <code>http://www.baozi.com</code> 显示”505包子铺”</li>
<li>访问 <code>http://www.baozi.com/status</code> 查看访问统计</li>
</ul>
<p><strong>步骤7：查看服务状态</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep nginx</span><br><span class="line">netstat -natp | grep 80</span><br></pre></td></tr></table></figure>

<h3 id="拓展：版本升级"><a href="#拓展：版本升级" class="headerlink" title="拓展：版本升级"></a>拓展：版本升级</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载新版本</span></span><br><span class="line">tar -zxvf nginx-1.22.0.tar.gz</span><br><span class="line"><span class="built_in">cd</span> nginx-1.22.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置新版本</span></span><br><span class="line">./configure [相同的配置参数]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只编译不安装</span></span><br><span class="line">make</span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份旧版本</span></span><br><span class="line"><span class="built_in">mv</span> /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx_old</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用新版本</span></span><br><span class="line"><span class="built_in">cp</span> objs/nginx /usr/local/nginx/sbin/nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证新版本</span></span><br><span class="line">nginx -V</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">systemctl restart nginx.service</span><br></pre></td></tr></table></figure>

<h2 id="四、Nignx优化"><a href="#四、Nignx优化" class="headerlink" title="四、Nignx优化"></a>四、Nignx优化</h2><h3 id="4-1-安全加固"><a href="#4-1-安全加固" class="headerlink" title="4.1 安全加固"></a>4.1 安全加固</h3><h4 id="4-1-1-隐藏版本号"><a href="#4-1-1-隐藏版本号" class="headerlink" title="4.1.1 隐藏版本号"></a>4.1.1 隐藏版本号</h4><p><strong>背景</strong>：版本号暴露会让攻击者识别特定漏洞，增加被针对性攻击的风险。</p>
<p><strong>目的</strong>：增强安全性。隐藏Nginx版本号可以防止攻击者通过版本信息识别特定的安全漏洞，降低被针对性攻击的风险。</p>
<p><strong>方法一：配置文件修改（推荐）</strong></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /usr/local/nginx/conf/nginx.conf</span></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">server_tokens</span> <span class="literal">off</span>;  <span class="comment"># 关闭版本号显示</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务验证</span></span><br><span class="line"><span class="attribute">systemctl</span> restart nginx</span><br><span class="line">curl -I http://192.168.110.128</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果对比</span></span><br><span class="line"><span class="comment"># 修改前：Server: nginx/1.20.2</span></span><br><span class="line"><span class="comment"># 修改后：Server: nginx</span></span><br></pre></td></tr></table></figure>

<p><img src="/./imgs/image-20251107194543156.png" alt="image-20251107194543156"></p>
<p><strong>方法二：源码级修改（深度隐藏）</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改源码中的版本声明</span></span><br><span class="line">vim /opt/nginx-1.20.2/src/core/nginx.h</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改以下行</span></span><br><span class="line"><span class="comment">#define NGINX_VERSION &quot;1.1.1&quot;        # 改为虚假版本</span></span><br><span class="line"><span class="comment">#define NGINX_VER &quot;IIS&quot; NGINX_VERSION # 改为其他服务器名称</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新编译安装</span></span><br><span class="line"><span class="built_in">cd</span> /opt/nginx-1.20.2/</span><br><span class="line">./configure --prefix=/usr/local/nginx --user=nginx --group=nginx \</span><br><span class="line">    --with-http_stub_status_module --with-http_ssl_module</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">systemctl restart nginx</span><br><span class="line">curl -I http://192.168.110.128</span><br><span class="line"><span class="comment"># 结果：Server: IIS 1.1.1</span></span><br></pre></td></tr></table></figure>

<p><img src="/./imgs/image-20251107194557332.png" alt="image-20251107194557332"></p>
<p><img src="/./imgs/image-20251107194601816.png" alt="image-20251107194601816"></p>
<h4 id="4-1-2-运行权限最小化"><a href="#4-1-2-运行权限最小化" class="headerlink" title="4.1.2 运行权限最小化"></a>4.1.2 运行权限最小化</h4><p><strong>背景</strong>：以低权限用户运行Nginx，即使进程被攻击也能限制权限损害。</p>
<p><strong>目的</strong>：提高系统安全性。让Nginx子进程以低权限用户（nginx）运行，而不是root用户，即使Nginx进程被攻击也能限制权限损害。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /usr/local/nginx/conf/nginx.conf</span></span><br><span class="line"><span class="attribute">user</span> nginx nginx;  <span class="comment"># 第一个是用户，第二个是用户组</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证</span></span><br><span class="line"><span class="attribute">systemctl</span> restart nginx</span><br><span class="line">ps aux | grep nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出示例</span></span><br><span class="line"><span class="comment"># root     1234  0.0  0.1 46952 1104 ?  Ss 10:00 0.00 nginx: master process</span></span><br><span class="line"><span class="comment"># nginx    1235  0.0  0.2 47380 2380 ?  S  10:00 0.00 nginx: worker process</span></span><br></pre></td></tr></table></figure>

<p><img src="/./imgs/image-20251107194630806.png" alt="image-20251107194630806"></p>
<p><strong>权限分层</strong>：</p>
<ul>
<li>Master进程：root用户创建（需要绑定80端口）</li>
<li>Worker进程：nginx用户运行（业务处理，权限有限）</li>
</ul>
<hr>
<h3 id="4-2-性能优化"><a href="#4-2-性能优化" class="headerlink" title="4.2 性能优化"></a>4.2 性能优化</h3><h4 id="4-2-1-静态资源缓存"><a href="#4-2-1-静态资源缓存" class="headerlink" title="4.2.1 静态资源缓存"></a>4.2.1 静态资源缓存</h4><p><strong>背景</strong>：设置缓存时间，浏览器直接使用本地缓存，减少服务器压力和带宽消耗。</p>
<p><strong>目的</strong>：提高访问速度，减少服务器压力。设置静态资源缓存后，浏览器可以直接使用缓存数据，避免重复请求，节省服务器带宽。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /usr/local/nginx/conf/nginx.conf</span></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="comment"># 图片类资源：缓存1天</span></span><br><span class="line">        <span class="section">location</span> <span class="regexp">~* \.(gif|jpg|jpeg|png|bmp|ico)$</span> &#123;</span><br><span class="line">            <span class="attribute">root</span> html;</span><br><span class="line">            <span class="attribute">expires</span> <span class="number">1d</span>;  <span class="comment"># 也可用 1h, 7d, 30d 等</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># CSS/JS：缓存7天</span></span><br><span class="line">        <span class="section">location</span> <span class="regexp">~* \.(css|js)$</span> &#123;</span><br><span class="line">            <span class="attribute">root</span> html;</span><br><span class="line">            <span class="attribute">expires</span> <span class="number">7d</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># HTML页面：不缓存（或缓存较短时间）</span></span><br><span class="line">        <span class="section">location</span> <span class="regexp">~* \.html$</span> &#123;</span><br><span class="line">            <span class="attribute">root</span> html;</span><br><span class="line">            <span class="attribute">expires</span> <span class="number">1h</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">systemctl</span> restart nginx</span><br></pre></td></tr></table></figure>

<p><strong>验证方法</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用浏览器开发者工具查看响应头</span></span><br><span class="line"><span class="comment"># 访问 http://192.168.110.128/image.jpg</span></span><br><span class="line"><span class="comment"># 查看 Network → image.jpg → Response Headers</span></span><br><span class="line"><span class="comment"># 看到 Cache-Control: max-age=86400 (秒数)，表示缓存1天</span></span><br></pre></td></tr></table></figure>

<p><img src="/./imgs/image-20251107194705515.png" alt="image-20251107194705515"></p>
<p><img src="/./imgs/image-20251107194709212.png" alt="image-20251107194709212"></p>
<p><strong>缓存时间转换</strong>：</p>
<ul>
<li>1h &#x3D; 3600秒</li>
<li>1d &#x3D; 86400秒</li>
<li>7d &#x3D; 604800秒</li>
</ul>
<hr>
<h4 id="4-2-2-网页压缩（Gzip）"><a href="#4-2-2-网页压缩（Gzip）" class="headerlink" title="4.2.2 网页压缩（Gzip）"></a>4.2.2 网页压缩（Gzip）</h4><p><strong>背景</strong>：压缩文本文件（HTML&#x2F;CSS&#x2F;JS），减少传输体积，加快加载速度。</p>
<p><strong>带宽浪费</strong>：未压缩和缓存导致流量消耗过大，成本上升</p>
<p><strong>目的</strong>：节约网站带宽，加快用户访问速度。压缩后的文件体积更小，传输更快。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /usr/local/nginx/conf/nginx.conf</span></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">gzip</span> <span class="literal">on</span>;                          <span class="comment"># 启用gzip压缩</span></span><br><span class="line">    <span class="attribute">gzip_min_length</span> <span class="number">1k</span>;               <span class="comment"># 文件小于1KB不压缩</span></span><br><span class="line">    <span class="attribute">gzip_buffers</span> <span class="number">4</span> <span class="number">64k</span>;               <span class="comment"># 压缩缓冲区大小</span></span><br><span class="line">    <span class="attribute">gzip_http_version</span> <span class="number">1</span>.<span class="number">1</span>;            <span class="comment"># HTTP版本</span></span><br><span class="line">    <span class="attribute">gzip_comp_level</span> <span class="number">6</span>;                <span class="comment"># 压缩级别（1-9，级别越高压缩率越高但CPU消耗越大）</span></span><br><span class="line">    <span class="attribute">gzip_vary</span> <span class="literal">on</span>;                     <span class="comment"># 支持缓存服务器存储压缩页面</span></span><br><span class="line">    <span class="attribute">gzip_types</span> text/plain text/css text/xml text/javascript </span><br><span class="line">               application/x-javascript application/javascript </span><br><span class="line">               application/json;      <span class="comment"># 压缩这些类型的文件</span></span><br><span class="line">    </span><br><span class="line">    <span class="attribute">sendfile</span> <span class="literal">on</span>;                      <span class="comment"># 启用零复制发送文件</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">systemctl</span> restart nginx</span><br></pre></td></tr></table></figure>

<p><strong>验证方法</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 访问 http://192.168.110.128</span></span><br><span class="line"><span class="comment"># 浏览器开发者工具 → Network → 查看响应头</span></span><br><span class="line"><span class="comment"># 看到 Content-Encoding: gzip 表示启用了压缩</span></span><br></pre></td></tr></table></figure>

<p><strong>性能对比</strong>：</p>
<ul>
<li>未压缩的HTML文件：约100KB</li>
<li>压缩后：约10-15KB</li>
<li>传输速度提升：8-10倍</li>
</ul>
<hr>
<h4 id="4-2-3-连接超时管理"><a href="#4-2-3-连接超时管理" class="headerlink" title="4.2.3 连接超时管理"></a>4.2.3 连接超时管理</h4><p><strong>背景</strong>：HTTP KeepAlive机制保持连接，但长连接占用资源。合理设置超时防止资源浪费。</p>
<p><strong>连接堆积</strong>：Keepalive连接占用过多资源，新请求无法建立连接，导致服务响应缓慢甚至宕机</p>
<p><strong>目的</strong>：合理管理连接资源。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /usr/local/nginx/conf/nginx.conf</span></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span> <span class="number">65</span> <span class="number">180</span>;    <span class="comment"># 保持连接时间（65秒），响应头中声明180秒</span></span><br><span class="line">    <span class="attribute">client_header_timeout</span> <span class="number">80</span>;     <span class="comment"># 等待请求头超时，返回408</span></span><br><span class="line">    <span class="attribute">client_body_timeout</span> <span class="number">80</span>;       <span class="comment"># 等待请求体超时，返回408</span></span><br><span class="line">    </span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">proxy_connect_timeout</span> <span class="number">60s</span>;   <span class="comment"># 连接后端服务超时</span></span><br><span class="line">        <span class="attribute">proxy_send_timeout</span> <span class="number">60s</span>;      <span class="comment"># 向后端发送数据超时</span></span><br><span class="line">        <span class="attribute">proxy_read_timeout</span> <span class="number">60s</span>;      <span class="comment"># 接收后端数据超时</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">systemctl</span> restart nginx</span><br></pre></td></tr></table></figure>

<p><strong>参数说明</strong>：</p>
<ul>
<li><code>keepalive_timeout</code>：TCP连接最多保持多久（防止僵尸连接）</li>
<li><code>client_header_timeout</code>：客户端必须在指定时间内发送完请求头</li>
<li><code>client_body_timeout</code>：客户端必须在指定时间内发送完请求体</li>
</ul>
<hr>
<h4 id="4-2-4-工作进程优化"><a href="#4-2-4-工作进程优化" class="headerlink" title="4.2.4 工作进程优化"></a>4.2.4 工作进程优化</h4><p><strong>背景</strong>：在高并发场景，增加worker进程充分利用多核CPU。</p>
<p><strong>进程阻塞</strong>：进程数不足导致请求排队等待，用户体验极差</p>
<p><strong>目的</strong>：提高并发处理能力。在高并发场景中，增加worker进程数可以充分利用多核CPU，提高快速响应能力。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看CPU核数</span></span><br><span class="line"><span class="built_in">cat</span> /proc/cpuinfo | grep -c <span class="string">&quot;physical id&quot;</span></span><br><span class="line"><span class="comment"># 输出：4（表示4核CPU）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vim /usr/local/nginx/conf/nginx.conf</span></span><br><span class="line">worker_processes 8;              <span class="comment"># 建议设为核数的2倍（如4核则设8）</span></span><br><span class="line">worker_cpu_affinity 00000001 00000010 00000100 00001000 </span><br><span class="line">                   00010000 00100000 01000000 10000000;  <span class="comment"># 绑定CPU</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看最大连接数</span></span><br><span class="line">worker_connections 2048;         <span class="comment"># 单个进程最大连接数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 总并发数 = worker_processes × worker_connections</span></span><br><span class="line"><span class="comment"># 示例：8 × 2048 = 16384个并发</span></span><br><span class="line"></span><br><span class="line">systemctl restart nginx</span><br><span class="line">ps aux | grep nginx  <span class="comment"># 查看进程数</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="4-2-5-日志切割"><a href="#4-2-5-日志切割" class="headerlink" title="4.2.5 日志切割"></a>4.2.5 日志切割</h4><p><strong>背景</strong>：Nginx日志文件无限增长会导致磁盘满，需要定期轮转和清理。</p>
<p><strong>资源耗尽</strong>：日志文件无限增长导致磁盘满，服务中断</p>
<p><strong>目的</strong>：防止日志文件过大占用磁盘空间，便于日志管理和分析。定期清理过期日志防止磁盘满。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建日志切割脚本</span></span><br><span class="line">vim /opt/nginx_logcut.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">day=$(<span class="built_in">date</span> -d <span class="string">&quot;-1 day&quot;</span> <span class="string">&quot;+%Y%m%d&quot;</span>)</span><br><span class="line">logs_path=<span class="string">&quot;/var/log/nginx&quot;</span></span><br><span class="line">pid_path=<span class="string">&quot;/usr/local/nginx/logs/nginx.pid&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建日志目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$logs_path</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 移动并重命名日志文件</span></span><br><span class="line"><span class="built_in">mv</span> /usr/local/nginx/logs/access.log <span class="variable">$&#123;logs_path&#125;</span>/access.log-<span class="variable">$day</span></span><br><span class="line"><span class="built_in">mv</span> /usr/local/nginx/logs/error.log <span class="variable">$&#123;logs_path&#125;</span>/error.log-<span class="variable">$day</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新打开日志文件（USR1信号告诉Nginx重建日志）</span></span><br><span class="line"><span class="built_in">kill</span> -USR1 $(<span class="built_in">cat</span> <span class="variable">$pid_path</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除30天前的日志</span></span><br><span class="line">find <span class="variable">$logs_path</span> -mtime +30 -<span class="built_in">exec</span> <span class="built_in">rm</span> -rf &#123;&#125; \;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 授予执行权限</span></span><br><span class="line"><span class="built_in">chmod</span> +x /opt/nginx_logcut.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 手动测试</span></span><br><span class="line">/opt/nginx_logcut.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证</span></span><br><span class="line"><span class="built_in">ls</span> /var/log/nginx</span><br><span class="line"><span class="built_in">ls</span> /usr/local/nginx/logs/</span><br></pre></td></tr></table></figure>

<p><strong>配置定时任务</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每天凌晨1点自动执行</span></span><br><span class="line">crontab -e</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加以下行</span></span><br><span class="line">0 1 * * * /opt/nginx_logcut.sh</span><br></pre></td></tr></table></figure>

<p><strong>常用信号</strong>：</p>
<ul>
<li><code>HUP (1)</code>：重新加载配置</li>
<li><code>USR1 (10)</code>：日志分割，重新打开日志文件</li>
<li><code>QUIT (3)</code>：优雅关闭</li>
</ul>
<hr>
<h3 id="4-3-防盗链配置"><a href="#4-3-防盗链配置" class="headerlink" title="4.3 防盗链配置"></a>4.3 防盗链配置</h3><h4 id="4-3-1-原理说明"><a href="#4-3-1-原理说明" class="headerlink" title="4.3.1 原理说明"></a>4.3.1 原理说明</h4><p><strong>HTTP Referer机制</strong>：</p>
<ul>
<li>当用户通过链接访问资源时，HTTP请求会携带 <code>Referer</code> 字段</li>
<li><code>Referer</code> 表示请求来源，通过检查它可以判断资源是否被盗用</li>
</ul>
<p><strong>目的</strong>：保护资源，防止其他网站盗用图片等资源，减少服务器带宽消耗。</p>
<p><img src="/./imgs/image-20251107194913310.png" alt="image-20251107194913310"></p>
<p><strong>盗链示例</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">合法访问：访问 www.example.com/image.jpg → Referer: www.example.com</span><br><span class="line">盗链访问：在 www.hack.com/index.html 中&lt;img src=&quot;www.example.com/image.jpg&quot;&gt; </span><br><span class="line">          → Referer: www.hack.com（来源非法）</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="4-3-2-基础防盗链配置"><a href="#4-3-2-基础防盗链配置" class="headerlink" title="4.3.2 基础防盗链配置"></a>4.3.2 基础防盗链配置</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /usr/local/nginx/conf/nginx.conf</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> www.example.com;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 对图片资源进行防盗链</span></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~* \.(jpg|gif|swf|png|jpeg)$</span> &#123;</span><br><span class="line">        <span class="comment"># 设置允许的来源</span></span><br><span class="line">        <span class="attribute">valid_referers</span> <span class="literal">none</span> <span class="literal">blocked</span> <span class="regexp">*.example.com</span> example.com;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 如果来源非法</span></span><br><span class="line">        <span class="attribute">if</span> (<span class="variable">$invalid_referer</span>) &#123;</span><br><span class="line">            <span class="comment"># 方案一：返回403禁止访问</span></span><br><span class="line">            <span class="attribute">return</span> <span class="number">403</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 方案二：重写到错误图片</span></span><br><span class="line">            <span class="comment"># rewrite ^/ http://www.example.com/error.png;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="attribute">root</span> /var/www/html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">systemctl</span> restart nginx</span><br></pre></td></tr></table></figure>

<p><strong>参数说明</strong>：</p>
<ul>
<li><code>~* \.(jpg|gif|...)$</code>：匹配图片文件（不区分大小写）</li>
<li><code>valid_referers</code>：允许的来源列表<ul>
<li><code>none</code>：允许直接在地址栏输入（无Referer）</li>
<li><code>blocked</code>：允许非http:&#x2F;&#x2F;开头的请求</li>
<li><code>*.example.com</code>：允许该域名及其子域名</li>
<li><code>example.com</code>：允许该具体域名</li>
</ul>
</li>
<li><code>$invalid_referer</code>：来源非法时为true</li>
</ul>
<hr>
<h4 id="4-3-3-防盗链实战配置"><a href="#4-3-3-防盗链实战配置" class="headerlink" title="4.3.3 防盗链实战配置"></a>4.3.3 防盗链实战配置</h4><p><strong>场景</strong>：资源站点允许自己访问，禁止其他网站盗链</p>
<p>比如：</p>
<p><img src="/./imgs/image-20251107195008007.png" alt="image-20251107195008007"></p>
<p>只有*.dog.com相关的连接访问才能正常访问</p>
<p>其他的都会跳转至403</p>
<p><img src="/./imgs/image-20251107195028185.png" alt="image-20251107195028185"></p>
<p>案例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 准备环境</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /var/www/html</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;资源服务器图片&quot;</span> &gt; /var/www/html/game.jpg</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建错误提示图片</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;403-禁止盗链&quot;</span> &gt; /var/www/html/error.png</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置hosts解析</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;192.168.110.128 www.example.com&quot;</span> &gt;&gt; /etc/hosts</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;192.168.110.130 www.hack.com&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure>

<p><strong>配置nginx</strong>：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 资源服务器配置（192.168.110.128）</span></span><br><span class="line"><span class="comment"># vim /usr/local/nginx/conf/nginx.conf</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> www.example.com;</span><br><span class="line">    </span><br><span class="line">    <span class="section">location</span> <span class="regexp">~* \.(jpg|gif|png)$</span> &#123;</span><br><span class="line">        <span class="attribute">valid_referers</span> <span class="literal">none</span> <span class="literal">blocked</span> <span class="regexp">*.example.com</span>;</span><br><span class="line">        <span class="attribute">if</span> (<span class="variable">$invalid_referer</span>) &#123;</span><br><span class="line">            <span class="attribute">rewrite</span><span class="regexp"> ^/</span> http://www.example.com/error.png;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attribute">root</span> /var/www/html;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">root</span> /var/www/html;</span><br><span class="line">        <span class="attribute">index</span> index.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">systemctl</span> restart nginx</span><br></pre></td></tr></table></figure>

<p><strong>验证方法</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 合法访问（直接访问图片）</span></span><br><span class="line">curl -I http://www.example.com/game.jpg</span><br><span class="line"><span class="comment"># 返回 200 OK</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 盗链访问（模拟来自其他网站）</span></span><br><span class="line">curl -e <span class="string">&quot;http://www.hack.com&quot;</span> http://www.example.com/game.jpg</span><br><span class="line"><span class="comment"># 返回 404 或 302 重定向</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在盗链网站（192.168.110.130）访问</span></span><br><span class="line"><span class="comment"># 创建 /var/www/html/index.html</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&lt;img src=&quot;http://www.example.com/game.jpg&quot;/&gt;&#x27;</span> &gt; /var/www/html/index.html</span><br><span class="line"></span><br><span class="line"><span class="comment"># 浏览器访问 http://www.hack.com</span></span><br><span class="line"><span class="comment"># 看到的是 error.png 而不是真实的 game.jpg</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="4-3-4-高级防盗链配置"><a href="#4-3-4-高级防盗链配置" class="headerlink" title="4.3.4 高级防盗链配置"></a>4.3.4 高级防盗链配置</h4><p><strong>允许搜索引擎爬虫访问</strong>：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> <span class="regexp">~* \.(jpg|gif|png)$</span> &#123;</span><br><span class="line">    <span class="attribute">valid_referers</span> <span class="literal">none</span> <span class="literal">blocked</span> <span class="regexp">*.example.com</span> </span><br><span class="line">                   <span class="regexp">*.google.com</span> <span class="regexp">*.baidu.com</span>  <span class="comment"># 允许搜索引擎</span></span><br><span class="line">                   <span class="regexp">*.bing.com</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">if</span> (<span class="variable">$invalid_referer</span>) &#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">403</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">root</span> /var/www/html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>白名单模式（只允许特定来源）</strong>：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> <span class="regexp">~* \.(jpg|gif|png)$</span> &#123;</span><br><span class="line">    <span class="attribute">valid_referers</span> <span class="regexp">*.example.com</span> partner.com;  <span class="comment"># 只允许这两个</span></span><br><span class="line">    </span><br><span class="line">    <span class="attribute">if</span> (<span class="variable">$invalid_referer</span>) &#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">403</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">root</span> /var/www/html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="4-4-优化效果对比"><a href="#4-4-优化效果对比" class="headerlink" title="4.4 优化效果对比"></a>4.4 优化效果对比</h3><table>
<thead>
<tr>
<th>优化项</th>
<th>优化前</th>
<th>优化后</th>
<th>提升</th>
</tr>
</thead>
<tbody><tr>
<td>版本隐藏</td>
<td>暴露1.20.2</td>
<td>隐藏&#x2F;伪装</td>
<td>安全性↑</td>
</tr>
<tr>
<td>缓存设置</td>
<td>每次请求</td>
<td>1天缓存</td>
<td>请求减少↓</td>
</tr>
<tr>
<td>网页压缩</td>
<td>100KB</td>
<td>10-15KB</td>
<td>传输速度↑8倍</td>
</tr>
<tr>
<td>连接超时</td>
<td>无限占用</td>
<td>自动释放</td>
<td>资源消耗↓</td>
</tr>
<tr>
<td>工作进程</td>
<td>1个进程</td>
<td>8个进程</td>
<td>并发能力↑8倍</td>
</tr>
<tr>
<td>防盗链</td>
<td>资源被盗</td>
<td>禁止盗链</td>
<td>带宽节省↑</td>
</tr>
</tbody></table>
<hr>
<h3 id="4-5-企业级优化配置模板"><a href="#4-5-企业级优化配置模板" class="headerlink" title="4.5 企业级优化配置模板"></a>4.5 企业级优化配置模板</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="comment"># 安全加固</span></span><br><span class="line">    <span class="attribute">server_tokens</span> <span class="literal">off</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 性能优化</span></span><br><span class="line">    <span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">gzip_min_length</span> <span class="number">1k</span>;</span><br><span class="line">    <span class="attribute">gzip_comp_level</span> <span class="number">6</span>;</span><br><span class="line">    <span class="attribute">gzip_types</span> text/plain text/css application/json application/javascript;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">sendfile</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span> <span class="number">65</span>;</span><br><span class="line">    <span class="attribute">client_header_timeout</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">client_body_timeout</span> <span class="number">80</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 日志格式</span></span><br><span class="line">    <span class="attribute">log_format</span> main <span class="string">&#x27;<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] &quot;<span class="variable">$request</span>&quot; &#x27;</span></span><br><span class="line">                    <span class="string">&#x27;<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> &quot;<span class="variable">$http_referer</span>&quot; &#x27;</span></span><br><span class="line">                    <span class="string">&#x27;&quot;<span class="variable">$http_user_agent</span>&quot; &quot;<span class="variable">$http_x_forwarded_for</span>&quot;&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">access_log</span> /var/log/nginx/access.log main;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 工作进程</span></span><br><span class="line">    <span class="section">upstream</span> backend_servers &#123;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">192.168.110.101:8080</span> weight=<span class="number">5</span>;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">192.168.110.102:8080</span> weight=<span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span> www.example.com;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 首页快速处理</span></span><br><span class="line">        <span class="section">location</span> = / &#123;</span><br><span class="line">            <span class="attribute">root</span> html;</span><br><span class="line">            <span class="attribute">index</span> index.html;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 静态资源缓存</span></span><br><span class="line">        <span class="section">location</span> <span class="regexp">~* \.(gif|jpg|jpeg|png|css|js|ico)$</span> &#123;</span><br><span class="line">            <span class="attribute">root</span> html;</span><br><span class="line">            <span class="attribute">expires</span> <span class="number">7d</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 防盗链</span></span><br><span class="line">        <span class="section">location</span> <span class="regexp">~* \.(jpg|png|gif)$</span> &#123;</span><br><span class="line">            <span class="attribute">valid_referers</span> <span class="literal">none</span> <span class="literal">blocked</span> <span class="regexp">*.example.com</span>;</span><br><span class="line">            <span class="attribute">if</span> (<span class="variable">$invalid_referer</span>) &#123; <span class="attribute">return</span> <span class="number">403</span>; &#125;</span><br><span class="line">            <span class="attribute">root</span> /var/www/html;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 动态请求转发</span></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://backend_servers;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">worker_processes</span> <span class="number">8</span>;</span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span> <span class="number">2048</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="4-6-面试高频问题"><a href="#4-6-面试高频问题" class="headerlink" title="4.6 面试高频问题"></a>4.6 面试高频问题</h3><p><strong>Q1: Nginx有哪些优化方向？</strong></p>
<ul>
<li>安全加固（隐藏版本、最小权限）</li>
<li>性能优化（缓存、压缩、超时、进程数）</li>
<li>资源保护（防盗链）</li>
<li>日志管理（定期切割清理）</li>
</ul>
<p><strong>Q2: 503错误通常是什么原因？</strong></p>
<ul>
<li>后端服务宕机</li>
<li>连接数上限（max_fails配置）</li>
<li>Worker进程数不足</li>
<li>内存&#x2F;CPU不足</li>
</ul>
<p><strong>Q3: 缓存和防盗链的区别？</strong></p>
<ul>
<li>缓存：减少客户端请求频率</li>
<li>防盗链：防止非法来源访问资源</li>
</ul>
<p><strong>Q4: gzip压缩的缺点？</strong></p>
<ul>
<li>增加CPU消耗</li>
<li>并非所有文件都适合压缩（图片已压缩）</li>
<li>需要客户端支持</li>
</ul>
<h2 id="五、Docker进行Nginx的手动编译镜像构建"><a href="#五、Docker进行Nginx的手动编译镜像构建" class="headerlink" title="五、Docker进行Nginx的手动编译镜像构建"></a>五、Docker进行Nginx的手动编译镜像构建</h2><h3 id="dockerfile部署nginx手动编译"><a href="#dockerfile部署nginx手动编译" class="headerlink" title="dockerfile部署nginx手动编译"></a>dockerfile部署nginx手动编译</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i <span class="string">&#x27;s/^#baseurl=http:\/\/mirror.centos.org/baseurl=https:\/\/mirrors.aliyun.com/g&#x27;</span> /etc/yum.repos.d/CentOS-Base.repo &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    sed -i <span class="string">&#x27;s/^mirrorlist=http:\/\/mirrorlist.centos.org/#mirrorlist=http:\/\/mirrorlist.centos.org/g&#x27;</span> /etc/yum.repos.d/CentOS-Base.repo &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    yum clean all &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    yum makecache &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    yum install -y gcc pcre-devel zlib-devel openssl-devel make &amp;&amp; yum clean all &amp;&amp;\</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">rm</span> -rf /var/cache/yum/* /var/lib/yum/* /tmp/* /var/tmp/*</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /usr/src</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> nginx-1.20.1.tar.gz /opt/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">cd</span> /opt/nginx-1.20.1 &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    ./configure --prefix=/usr/local/nginx &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    make &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    make install &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">rm</span> -rf /opt/nignx-1.20.1 /opt/nginx-1.20.1.tar.gz</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> index.html /usr/local/nginx/html/index.html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;/usr/local/nginx/sbin/nginx&quot;</span>, <span class="string">&quot;-g&quot;</span>, <span class="string">&quot;daemon off;&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<h3 id="多阶段构筑优化"><a href="#多阶段构筑优化" class="headerlink" title="多阶段构筑优化"></a>多阶段构筑优化</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7</span> as builder</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i <span class="string">&#x27;s/^#baseurl=http:\/\/mirror.centos.org/baseurl=https:\/\/mirrors.aliyun.com/g&#x27;</span> /etc/yum.repos.d/CentOS-Base.repo &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    sed -i <span class="string">&#x27;s/^mirrorlist=http:\/\/mirrorlist.centos.org/#mirrorlist=http:\/\/mirrorlist.centos.org/g&#x27;</span> /etc/yum.repos.d/CentOS-Base.repo &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    yum clean all &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    yum install -y gcc pcre-devel zlib-devel openssl-devel make &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    yum clean all</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /opt</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> nginx-1.20.1.tar.gz .</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> tar xf nginx-1.20.1.tar.gz &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">cd</span> nginx-1.20.1 &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    ./configure --prefix=/usr/local/nginx &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    make &amp;&amp; make install</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ------------------------------</span></span><br><span class="line"><span class="comment"># 生产环境镜像（非常干净）</span></span><br><span class="line"><span class="comment"># ------------------------------</span></span><br><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /usr/local/nginx</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /usr/local/nginx /usr/local/nginx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> index.html /usr/local/nginx/html/index.html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;/usr/local/nginx/sbin/nginx&quot;</span>, <span class="string">&quot;-g&quot;</span>, <span class="string">&quot;daemon off;&quot;</span>]</span></span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://example.com">Felix</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://example.com/2025/11/03/web%E6%9C%8D%E5%8A%A1%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/">http://example.com/2025/11/03/web%E6%9C%8D%E5%8A%A1%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/imgs/adater.jpg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/11/07/Kubernetes/" title="Kubernetes"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Kubernetes</div></div><div class="info-2"><div class="info-item-1">Kubernetes一、初识Kubernetes1.1 启动 Kubernetes 集群使用 Minikube 启动并验证本地 Kubernetes 集群。Minikube 提供了一种简单方式来设置用于学习和开发的单节点 Kubernetes 环境。 启动minikube 1minikube start   查看集群状态 1minikube status   检查集群节点 1kubectl get nodes     Minikube 启动成功 本地 Kubernetes 集群正在运行 集群已准备就绪 您有一个具有控制平面功能的单节点集群   Minikube 集群在本地机器上提供了完整的 Kubernetes 环境，允许在不需要多节点集群的情况下开发和测试应用程序。 1.2 Kubernetes架构概述核心模型Kubernetes 采用客户端-服务器模型运行：  开发者 通过 kubectl 命令行工具与集群交互 控制平面 是集群的大脑，做出决策和管理状态 工作节点 运行实际的应用程序容器   控制平面（集群的”大脑”）控制平面由四个关键组件组成：    组件 简称 职责   ...</div></div></div></a><a class="pagination-related" href="/2025/10/29/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%92%8C%E6%96%87%E6%9C%AC%E4%B8%89%E5%89%91%E5%AE%A2/" title="正则表达式和文本三剑客"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">正则表达式和文本三剑客</div></div><div class="info-2"><div class="info-item-1">正则表达式和文本三剑客一、正则表达式基础1.1 正则表达式概念正则表达式是一种强大的文本模式匹配工具，用来描述、匹配和查找符合某种规则的文本内容。 重要概念：  正则表达式用于模式匹配和文本搜索 不同工具支持的正则表达式语法有所差异 基础正则表达式（BRE）和扩展正则表达式（ERE）   ⚠️ 重要区别：正则表达式的元字符与 Shell 通配符不同  通配符：用于文件名匹配（*、?、[]） 元字符：用于文本内容匹配（在 grep、sed、awk 中使用）   1.2 基础正则表达式元字符（BRE）   元字符 含义 示例 匹配情况    . 匹配任意单个字符（除换行符） g.d god、gad、g3d   * 匹配前面的子表达式 0 次或多次 go*d gd、god、gooood   ^ 匹配行的开始 ^root 行首为 root   $ 匹配行的结束 bash$ 行尾为 bash   [] 字符集，匹配其中任意一个字符 [abc] a、b 或 c   [^] 否定字符集，匹配不在其中的字符 [^abc] 除 a、b、c 外的字符   \ 转义符，使特殊字符失去特殊含义 \. 实...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/imgs/adater.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Felix</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">37</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/falsezxy"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Web%E6%9C%8D%E5%8A%A1%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">Web服务相关知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81Web"><span class="toc-number">1.1.</span> <span class="toc-text">一、Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AFWeb"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 什么是Web</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E4%B8%A4%E7%A7%8D%E7%BB%8F%E5%85%B8%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 两种经典架构模型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0-B-S%E6%9E%B6%E6%9E%84%EF%BC%88Browser-Server%E6%B5%8F%E8%A7%88%E5%99%A8-%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%89"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">① B&#x2F;S架构（Browser&#x2F;Server浏览器&#x2F;服务器）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1-C-S%E6%9E%B6%E6%9E%84%EF%BC%88Client-Server%E5%AE%A2%E6%88%B7%E7%AB%AF-%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%89"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">② C&#x2F;S架构（Client&#x2F;Server客户端&#x2F;服务器）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E5%8D%8F%E8%AE%AE%E3%80%81%E7%AB%AF%E5%8F%A3%E3%80%81%E5%8A%9F%E8%83%BD%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.3 协议、端口、功能的关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E8%BF%9E%E6%8E%A5%E5%BB%BA%E7%AB%8B%E8%BF%87%E7%A8%8BTCP"><span class="toc-number">1.1.4.</span> <span class="toc-text">1.4 连接建立过程TCP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E6%B5%81%E5%90%91"><span class="toc-number">1.1.5.</span> <span class="toc-text">1.5 访问数据流向</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81HTTP-HTTPS%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.2.</span> <span class="toc-text">二、HTTP&#x2F;HTTPS协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-HTTP%E5%8D%8F%E8%AE%AE%E5%9F%BA%E7%A1%80"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 HTTP协议基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-HTTPS%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 HTTPS协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-HTTP%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3 HTTP请求与响应</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-HTTP%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-number">1.2.4.</span> <span class="toc-text">2.4 HTTP状态码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Nginx%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.3.</span> <span class="toc-text">三、Nginx服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E4%BB%80%E4%B9%88%E6%98%AFNginx"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 什么是Nginx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-Nginx%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 Nginx核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E5%8F%B7%E8%A7%A3%E8%AF%BB"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">版本号解读</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BE%B9%E7%95%8C%E8%AE%BE%E5%A4%87"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">边界设备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">工作进程模型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%E5%A4%84%E7%90%86%E8%83%BD%E5%8A%9B"><span class="toc-number">1.3.2.4.</span> <span class="toc-text">并发处理能力</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E4%B8%8E%E5%8A%A8%E6%80%81%E8%B5%84%E6%BA%90"><span class="toc-number">1.3.2.5.</span> <span class="toc-text">静态资源与动态资源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.2.6.</span> <span class="toc-text">目录结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%AD%90%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%9B%BE%EF%BC%88%E6%95%B0%E6%8D%AE%E6%B5%81%E5%90%91%EF%BC%89"><span class="toc-number">1.3.2.7.</span> <span class="toc-text">⭐工作原理图（数据流向）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-Nginx%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.3 Nginx源码编译安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91-%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85%E4%B8%80%E4%B8%AA%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">手工编译&#x2F;源码编译安装一个服务的基本流程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%89%8D%E5%87%86%E5%A4%87"><span class="toc-number">1.3.3.1.1.</span> <span class="toc-text">安装前准备</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.3.1.2.</span> <span class="toc-text">下载与配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E4%B8%8E%E5%AE%89%E8%A3%85"><span class="toc-number">1.3.3.1.3.</span> <span class="toc-text">编译与安装</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E4%B8%8E%E5%90%AF%E5%8A%A8"><span class="toc-number">1.3.3.1.4.</span> <span class="toc-text">验证与启动</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%AE%8C%E6%95%B4%E9%85%8D%E7%BD%AE%E5%8F%82%E8%80%83"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">企业级完整配置参考</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E5%B1%95%EF%BC%9A%E6%B7%BB%E5%8A%A0%E4%B8%BA%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.3.4.</span> <span class="toc-text">拓展：添加为系统服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E2%AD%90Nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.3.5.</span> <span class="toc-text">3.4 ⭐Nginx配置文件详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%85%A8%E5%B1%80%E5%9D%97%EF%BC%88Global-Context%EF%BC%89"><span class="toc-number">1.3.5.1.</span> <span class="toc-text">一、全局块（Global Context）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E3%80%81events%E5%9D%97%EF%BC%88Events-Context%EF%BC%89"><span class="toc-number">1.3.5.2.</span> <span class="toc-text">二、events块（Events Context）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E3%80%81http%E5%9D%97%EF%BC%88HTTP-Context%EF%BC%89"><span class="toc-number">1.3.5.3.</span> <span class="toc-text">三、http块（HTTP Context）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9B%E3%80%81server%E5%9D%97%EF%BC%88Server-Context%EF%BC%89"><span class="toc-number">1.3.5.4.</span> <span class="toc-text">四、server块（Server Context）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%AE%8C%E6%95%B4%E5%88%86%E6%9E%90%E8%A1%A8"><span class="toc-number">1.3.5.5.</span> <span class="toc-text">配置文件完整分析表</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-Nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%92%8C%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">1.3.6.</span> <span class="toc-text">3.5 Nginx反向代理和负载均衡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E4%BB%A3%E7%90%86"><span class="toc-number">1.3.6.1.</span> <span class="toc-text">什么是代理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">1.3.6.2.</span> <span class="toc-text">什么是反向代理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.6.3.</span> <span class="toc-text">基础反向代理配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">1.3.6.4.</span> <span class="toc-text">什么是负载均衡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#upstream%E5%9D%97%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.6.5.</span> <span class="toc-text">upstream块配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95"><span class="toc-number">1.3.6.6.</span> <span class="toc-text">负载均衡调度算法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.3.6.7.</span> <span class="toc-text">调度算法配置示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E4%B8%8E%E5%81%A5%E5%BA%B7%E6%A3%80%E6%B5%8B"><span class="toc-number">1.3.6.8.</span> <span class="toc-text">故障转移与健康检测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E7%9A%84%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.3.6.9.</span> <span class="toc-text">完整的反向代理+负载均衡配置示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-Nginx%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.7.</span> <span class="toc-text">3.6 Nginx虚拟主机配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-1-%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%90%8D%E7%9A%84%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%EF%BC%88%E6%9C%80%E5%B8%B8%E7%94%A8%EF%BC%89"><span class="toc-number">1.3.7.1.</span> <span class="toc-text">3.6.1 基于域名的虚拟主机（最常用）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-2-%E5%9F%BA%E4%BA%8EIP%E7%9A%84%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA"><span class="toc-number">1.3.7.2.</span> <span class="toc-text">3.6.2 基于IP的虚拟主机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-3-%E5%9F%BA%E4%BA%8E%E7%AB%AF%E5%8F%A3%E7%9A%84%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA"><span class="toc-number">1.3.7.3.</span> <span class="toc-text">3.6.3 基于端口的虚拟主机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-4-%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.7.4.</span> <span class="toc-text">3.6.4 动静分离配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-%E6%8B%93%E5%B1%95%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.8.</span> <span class="toc-text">3.7 拓展配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-1-%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-number">1.3.8.1.</span> <span class="toc-text">3.7.1 访问控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-2-%E7%8A%B6%E6%80%81%E7%9B%91%E6%8E%A7%E6%A8%A1%E5%9D%97"><span class="toc-number">1.3.8.2.</span> <span class="toc-text">3.7.2 状态监控模块</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-Nginx%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.9.</span> <span class="toc-text">3.8 Nginx常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-9-%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%EF%BC%9A%E6%90%AD%E5%BB%BA%E5%8C%85%E5%AD%90%E9%93%BA%E5%AE%98%E7%BD%91"><span class="toc-number">1.3.10.</span> <span class="toc-text">3.9 实战案例：搭建包子铺官网</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%9C%80%E6%B1%82"><span class="toc-number">1.3.10.1.</span> <span class="toc-text">业务需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.3.10.2.</span> <span class="toc-text">实现步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E5%B1%95%EF%BC%9A%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7"><span class="toc-number">1.3.11.</span> <span class="toc-text">拓展：版本升级</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Nignx%E4%BC%98%E5%8C%96"><span class="toc-number">1.4.</span> <span class="toc-text">四、Nignx优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 安全加固</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-1-%E9%9A%90%E8%97%8F%E7%89%88%E6%9C%AC%E5%8F%B7"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">4.1.1 隐藏版本号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-2-%E8%BF%90%E8%A1%8C%E6%9D%83%E9%99%90%E6%9C%80%E5%B0%8F%E5%8C%96"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">4.1.2 运行权限最小化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 性能优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-1-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%BC%93%E5%AD%98"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">4.2.1 静态资源缓存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-2-%E7%BD%91%E9%A1%B5%E5%8E%8B%E7%BC%A9%EF%BC%88Gzip%EF%BC%89"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">4.2.2 网页压缩（Gzip）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-3-%E8%BF%9E%E6%8E%A5%E8%B6%85%E6%97%B6%E7%AE%A1%E7%90%86"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">4.2.3 连接超时管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-4-%E5%B7%A5%E4%BD%9C%E8%BF%9B%E7%A8%8B%E4%BC%98%E5%8C%96"><span class="toc-number">1.4.2.4.</span> <span class="toc-text">4.2.4 工作进程优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-5-%E6%97%A5%E5%BF%97%E5%88%87%E5%89%B2"><span class="toc-number">1.4.2.5.</span> <span class="toc-text">4.2.5 日志切割</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E9%98%B2%E7%9B%97%E9%93%BE%E9%85%8D%E7%BD%AE"><span class="toc-number">1.4.3.</span> <span class="toc-text">4.3 防盗链配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-1-%E5%8E%9F%E7%90%86%E8%AF%B4%E6%98%8E"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">4.3.1 原理说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-2-%E5%9F%BA%E7%A1%80%E9%98%B2%E7%9B%97%E9%93%BE%E9%85%8D%E7%BD%AE"><span class="toc-number">1.4.3.2.</span> <span class="toc-text">4.3.2 基础防盗链配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-3-%E9%98%B2%E7%9B%97%E9%93%BE%E5%AE%9E%E6%88%98%E9%85%8D%E7%BD%AE"><span class="toc-number">1.4.3.3.</span> <span class="toc-text">4.3.3 防盗链实战配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-4-%E9%AB%98%E7%BA%A7%E9%98%B2%E7%9B%97%E9%93%BE%E9%85%8D%E7%BD%AE"><span class="toc-number">1.4.3.4.</span> <span class="toc-text">4.3.4 高级防盗链配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E4%BC%98%E5%8C%96%E6%95%88%E6%9E%9C%E5%AF%B9%E6%AF%94"><span class="toc-number">1.4.4.</span> <span class="toc-text">4.4 优化效果对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-%E4%BC%81%E4%B8%9A%E7%BA%A7%E4%BC%98%E5%8C%96%E9%85%8D%E7%BD%AE%E6%A8%A1%E6%9D%BF"><span class="toc-number">1.4.5.</span> <span class="toc-text">4.5 企业级优化配置模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-%E9%9D%A2%E8%AF%95%E9%AB%98%E9%A2%91%E9%97%AE%E9%A2%98"><span class="toc-number">1.4.6.</span> <span class="toc-text">4.6 面试高频问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81Docker%E8%BF%9B%E8%A1%8CNginx%E7%9A%84%E6%89%8B%E5%8A%A8%E7%BC%96%E8%AF%91%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA"><span class="toc-number">1.5.</span> <span class="toc-text">五、Docker进行Nginx的手动编译镜像构建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dockerfile%E9%83%A8%E7%BD%B2nginx%E6%89%8B%E5%8A%A8%E7%BC%96%E8%AF%91"><span class="toc-number">1.5.1.</span> <span class="toc-text">dockerfile部署nginx手动编译</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E9%98%B6%E6%AE%B5%E6%9E%84%E7%AD%91%E4%BC%98%E5%8C%96"><span class="toc-number">1.5.2.</span> <span class="toc-text">多阶段构筑优化</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/15/Kubernetes%20%E9%85%8D%E7%BD%AE%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/" title="Kubernetes 配置资源管理">Kubernetes 配置资源管理</a><time datetime="2025-12-15T02:54:40.000Z" title="Created 2025-12-15 10:54:40">2025-12-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/12/%E9%98%BF%E9%87%8C%E4%BA%91-%E8%AE%BE%E5%A4%87%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2/" title="阿里云-设备管理平台部署">阿里云-设备管理平台部署</a><time datetime="2025-12-12T00:54:40.000Z" title="Created 2025-12-12 08:54:40">2025-12-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/10/Kubernetes-Pod%E7%9A%84%E5%8D%87%E7%BA%A7%E4%B8%8E%E6%9B%B4%E6%96%B0/" title="Kubernetes Pod的升级与更新">Kubernetes Pod的升级与更新</a><time datetime="2025-12-10T12:13:46.000Z" title="Created 2025-12-10 20:13:46">2025-12-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/10/Kubernetes%20Controller%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="Kubernetes Controller 学习笔记">Kubernetes Controller 学习笔记</a><time datetime="2025-12-10T10:34:40.000Z" title="Created 2025-12-10 18:34:40">2025-12-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/09/kubernetes%E9%9B%86%E7%BE%A4%E8%B0%83%E5%BA%A6%E7%AE%A1%E7%90%86/" title="Kubernetes集群调度机制">Kubernetes集群调度机制</a><time datetime="2025-12-09T08:54:40.000Z" title="Created 2025-12-09 16:54:40">2025-12-09</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/imgs/background_footer.jpg);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Felix</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.0.0</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.1</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.1"></script><script src="/js/main.js?v=5.5.1"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>